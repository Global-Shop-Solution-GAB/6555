Program.Sub.Preflight.Start
v.Global.sQuote.Declare
v.Global.sSQL.Declare
v.Global.sQuoteLineColumnTitle.Declare(String,"QUOTE_NO*!*RECORD_NO*!*PART*!*QTY_QUOTED*!*PRICE*!*AMT_DISCOUNT")
v.Global.sQuoteHeaderColumnTitle.Declare(String,"QUOTE_NO*!*AMT_TOTAL")
Program.Sub.Preflight.End

Program.Sub.Main.Start

f.ODBC.Connection!con.OpenConnection(v.Ambient.PDSN,v.Ambient.PUser,v.Ambient.PPass)
	
f.Intrinsic.Control.SelectCase(v.Caller.Hook)
	f.Intrinsic.Control.Case(10710)
		'Populate Quote Header screen
		f.Intrinsic.Control.CallSub(Hook10710)
	f.Intrinsic.Control.Case(10260)
		'Open Quote Line Screen
		f.Intrinsic.Control.CallSub(Hook10260)
	f.Intrinsic.Control.Case(10660)
		'Exit Quote Line Screen
		f.Intrinsic.Control.CallSub(Hook10660)
	f.Intrinsic.Control.Case(10721)
		'Change Quote Number
		f.Intrinsic.Control.CallSub(Hook10721)
	f.Intrinsic.Control.Case(10775)
		'Won/Loss button
		f.Intrinsic.Control.CallSub(Hook10775)
	f.Intrinsic.Control.Case(10850)
		'Email Quote
		f.Intrinsic.Control.CallSub(Hook10850)	
	f.Intrinsic.Control.Case(10940)
		'Print button
		f.Intrinsic.Control.CallSub(Hook10940)
	f.Intrinsic.Control.Case(10920)		
		'Save Quote Header button
		f.Intrinsic.Control.CallSub(Hook10920)
	f.Intrinsic.Control.Case(17330)
		'Estimate > Transactions > Won/Loss
		f.Intrinsic.Control.CallSub(Hook17330)
	f.Intrinsic.Control.Case(28301)
		'BOM > Files > BOM > New/Open > Create Router > Quote > Print
		f.Intrinsic.Control.CallSub(Hook28301)		
	'TDjohan - Begin      11/22/2022
	f.Intrinsic.Control.Case(10923)
		'Quote Header Post Save Button Hook
		f.Intrinsic.Control.CallSub(Hook10923)
	f.Intrinsic.Control.Case(10950)
		'Quote Header Exit Hook
		f.Intrinsic.Control.CallSub(Hook10950)
	f.Intrinsic.Control.Case(10532)
		'Quote Line Post Save Hook
		f.Intrinsic.Control.CallSub(Hook10532)
	'TDjohan - End      11/22/2022
f.Intrinsic.Control.EndSelect

f.Intrinsic.Control.CallSub(End)

Program.Sub.Main.End


Program.Sub.Hook10710.Start
'Approver Label
f.Intrinsic.Variable.SetProperty("GAB-LBL-1","PL",680)
f.Intrinsic.Variable.SetProperty("GAB-LBL-1","PT",515)
f.Intrinsic.Variable.SetProperty("GAB-LBL-1","PW",50)
f.Intrinsic.Variable.SetProperty("GAB-LBL-1","PH",15)
V.Passed.GAB-LBL-1.Set("Approver")

'Approver TextBox
F.Intrinsic.Variable.SetProperty("GAB-TEXT-1","PL",680)
F.Intrinsic.Variable.SetProperty("GAB-TEXT-1","PT",530)
F.Intrinsic.Variable.SetProperty("GAB-TEXT-1","PW",700)

'Approved Date Label
F.Intrinsic.Variable.SetProperty("GAB-LBL-2","PL",780)
F.Intrinsic.Variable.SetProperty("GAB-LBL-2","PT",515)
F.Intrinsic.Variable.SetProperty("GAB-LBL-2","PW",70)
F.Intrinsic.Variable.SetProperty("GAB-LBL-2","PH",15)
V.Passed.GAB-LBL-2.Set("Approved Date")

'Approved Date Label
F.Intrinsic.Variable.SetProperty("GAB-TEXT-2","PL",780)
F.Intrinsic.Variable.SetProperty("GAB-TEXT-2","PT",530)
F.Intrinsic.Variable.SetProperty("GAB-TEXT-2","PW",70)
Program.Sub.Hook10710.End

Program.Sub.Hook10260.Start
v.Local.sSQL.Declare
v.Local.sDate.Declare
v.Local.sFileName.Declare
v.Local.sFile.Declare
v.Local.bExists.Declare
v.Local.i1.Declare
v.Local.fRate.Declare
v.Local.fTax.Declare
v.Local.fTotal.Declare
v.Local.sTempValue.Declare

f.Intrinsic.String.Format(v.Ambient.Date,"YYYYMMDD",v.Local.sDate)
f.Intrinsic.String.Concat(v.System.Temp,"\GSS\GAB_6555_",v.Caller.User.Trim,"_",v.Local.sDate,".txt",v.Local.sFileName)
v.Local.sFile.Set("")

f.Intrinsic.File.Exists(v.Local.sFileName,v.Local.bExists)
f.Intrinsic.Control.If(v.Local.bExists,=,True)
	f.Intrinsic.File.DeleteFile(v.Local.sFileName)
f.Intrinsic.Control.EndIf

f.Intrinsic.String.LPad(v.Passed.000060,"0",7,v.Global.sQuote)

f.Intrinsic.String.Build("SELECT A.CUSTOMER, B.DATE_QUOTE, B.DATE_DUE, A.RECORD_NO, A.PART, A.QTY_QUOTED, A.PRICE, A.AMT_DISCOUNT, A.Extension, A.Extension_Quote, A.Tax_1, A.Tax_2, A.Tax_3, A.Tax_4, A.Tax_5, A.Tax_6, A.Tax_7, A.Tax_8, A.Tax_9, A.Tax_10, A.Tax_Apply_1, A.Tax_Apply_2, A.Tax_Apply_3, A.Tax_Apply_4, A.Tax_Apply_5, A.Tax_Apply_6, A.Tax_Apply_7, A.Tax_Apply_8, A.Tax_Apply_9, A.Tax_Apply_10, A.Tax_Zone_1, A.Tax_Zone_2, A.Tax_Zone_3, A.Tax_Zone_4, A.Tax_Zone_5, A.Tax_Zone_6, A.Tax_Zone_7, A.Tax_Zone_8, A.Tax_Zone_9, A.Tax_Zone_10 FROM V_QUOTE_LINES A LEFT JOIN V_QUOTE_HEADER B ON A.QUOTE_NO = B.QUOTE_NO WHERE A.QUOTE_NO='{0}' ORDER BY A.QUOTE_NO, A.RECORD_NO;",v.Global.sQuote,v.Local.sSQL)
f.Data.DataTable.CreateFromSQL("dtQuote","con",v.Local.sSQL,True)
f.Intrinsic.Control.If(v.DataTable.dtQuote.RowCount,>,0)
	f.Intrinsic.Control.For(v.Local.i1,0,v.DataTable.dtQuote.RowCount--,1)
		'Get Tax 1 Amount
		f.Intrinsic.Control.If(v.DataTable.dtQuote(v.Local.i1).Tax_Apply_1!FieldValTrim,=,"Y")
			f.Intrinsic.String.Build("SELECT RATE FROM V_AR_TAX_TABLES WHERE ZONE = '{0}' AND AUTH = '{1}'",v.DataTable.dtQuote(v.Local.i1).Tax_Zone_1!FieldValTrim, v.DataTable.dtQuote(v.Local.i1).Tax_1!FieldValTrim, v.Local.sSQL)
			f.ODBC.Connection!con.ExecuteAndReturn(v.Local.sSQL,v.Local.fRate)
			f.Intrinsic.Math.Mult(v.DataTable.dtQuote(v.Local.i1).Extension!FieldValFloat,v.Local.fRate,v.Local.fTax)
			f.Intrinsic.Math.Round(v.Local.fTax,2,v.Local.fTax)
			f.Intrinsic.Math.Add(v.Local.fTotal, v.Local.fTax, v.Local.fTotal)
		f.Intrinsic.Control.EndIf
		
		'Get Tax 2 Amount
		f.Intrinsic.Control.If(v.DataTable.dtQuote(v.Local.i1).Tax_Apply_2!FieldValTrim,=,"Y")
			f.Intrinsic.String.Build("SELECT RATE FROM V_AR_TAX_TABLES WHERE ZONE = '{0}' AND AUTH = '{1}'",v.DataTable.dtQuote(v.Local.i1).Tax_Zone_2!FieldValTrim, v.DataTable.dtQuote(v.Local.i1).Tax_2!FieldValTrim, v.Local.sSQL)
			f.ODBC.Connection!con.ExecuteAndReturn(v.Local.sSQL,v.Local.fRate)
			f.Intrinsic.Math.Mult(v.DataTable.dtQuote(v.Local.i1).Extension!FieldValFloat,v.Local.fRate,v.Local.fTax)
			f.Intrinsic.Math.Round(v.Local.fTax,2,v.Local.fTax)
			f.Intrinsic.Math.Add(v.Local.fTotal, v.Local.fTax, v.Local.fTotal)
		f.Intrinsic.Control.EndIf
		
		'Get Tax 3 Amount
		f.Intrinsic.Control.If(v.DataTable.dtQuote(v.Local.i1).Tax_Apply_3!FieldValTrim,=,"Y")
			f.Intrinsic.String.Build("SELECT RATE FROM V_AR_TAX_TABLES WHERE ZONE = '{0}' AND AUTH = '{1}'",v.DataTable.dtQuote(v.Local.i1).Tax_Zone_3!FieldValTrim, v.DataTable.dtQuote(v.Local.i1).Tax_3!FieldValTrim, v.Local.sSQL)
			f.ODBC.Connection!con.ExecuteAndReturn(v.Local.sSQL,v.Local.fRate)
			f.Intrinsic.Math.Mult(v.DataTable.dtQuote(v.Local.i1).Extension!FieldValFloat,v.Local.fRate,v.Local.fTax)
			f.Intrinsic.Math.Round(v.Local.fTax,2,v.Local.fTax)
			f.Intrinsic.Math.Add(v.Local.fTotal, v.Local.fTax, v.Local.fTotal)
		f.Intrinsic.Control.EndIf

		'Get Tax 4 Amount
		f.Intrinsic.Control.If(v.DataTable.dtQuote(v.Local.i1).Tax_Apply_4!FieldValTrim,=,"Y")
			f.Intrinsic.String.Build("SELECT RATE FROM V_AR_TAX_TABLES WHERE ZONE = '{0}' AND AUTH = '{1}'",v.DataTable.dtQuote(v.Local.i1).Tax_Zone_4!FieldValTrim, v.DataTable.dtQuote(v.Local.i1).Tax_4!FieldValTrim, v.Local.sSQL)
			f.ODBC.Connection!con.ExecuteAndReturn(v.Local.sSQL,v.Local.fRate)
			f.Intrinsic.Math.Mult(v.DataTable.dtQuote(v.Local.i1).Extension!FieldValFloat,v.Local.fRate,v.Local.fTax)
			f.Intrinsic.Math.Round(v.Local.fTax,2,v.Local.fTax)
			f.Intrinsic.Math.Add(v.Local.fTotal, v.Local.fTax, v.Local.fTotal)
		f.Intrinsic.Control.EndIf
		
		'Get Tax 5 Amount
		f.Intrinsic.Control.If(v.DataTable.dtQuote(v.Local.i1).Tax_Apply_5!FieldValTrim,=,"Y")
			f.Intrinsic.String.Build("SELECT RATE FROM V_AR_TAX_TABLES WHERE ZONE = '{0}' AND AUTH = '{1}'",v.DataTable.dtQuote(v.Local.i1).Tax_Zone_5!FieldValTrim, v.DataTable.dtQuote(v.Local.i1).Tax_5!FieldValTrim, v.Local.sSQL)
			f.ODBC.Connection!con.ExecuteAndReturn(v.Local.sSQL,v.Local.fRate)
			f.Intrinsic.Math.Mult(v.DataTable.dtQuote(v.Local.i1).Extension!FieldValFloat,v.Local.fRate,v.Local.fTax)
			f.Intrinsic.Math.Round(v.Local.fTax,2,v.Local.fTax)
			f.Intrinsic.Math.Add(v.Local.fTotal, v.Local.fTax, v.Local.fTotal)
		f.Intrinsic.Control.EndIf
		
		'Get Tax 6 Amount
		f.Intrinsic.Control.If(v.DataTable.dtQuote(v.Local.i1).Tax_Apply_6!FieldValTrim,=,"Y")
			f.Intrinsic.String.Build("SELECT RATE FROM V_AR_TAX_TABLES WHERE ZONE = '{0}' AND AUTH = '{1}'",v.DataTable.dtQuote(v.Local.i1).Tax_Zone_6!FieldValTrim, v.DataTable.dtQuote(v.Local.i1).Tax_6!FieldValTrim, v.Local.sSQL)
			f.ODBC.Connection!con.ExecuteAndReturn(v.Local.sSQL,v.Local.fRate)
			f.Intrinsic.Math.Mult(v.DataTable.dtQuote(v.Local.i1).Extension!FieldValFloat,v.Local.fRate,v.Local.fTax)
			f.Intrinsic.Math.Round(v.Local.fTax,2,v.Local.fTax)
			f.Intrinsic.Math.Add(v.Local.fTotal, v.Local.fTax, v.Local.fTotal)
		f.Intrinsic.Control.EndIf
		
		'Get Tax 7 Amount
		f.Intrinsic.Control.If(v.DataTable.dtQuote(v.Local.i1).Tax_Apply_7!FieldValTrim,=,"Y")
			f.Intrinsic.String.Build("SELECT RATE FROM V_AR_TAX_TABLES WHERE ZONE = '{0}' AND AUTH = '{1}'",v.DataTable.dtQuote(v.Local.i1).Tax_Zone_7!FieldValTrim, v.DataTable.dtQuote(v.Local.i1).Tax_7!FieldValTrim, v.Local.sSQL)
			f.ODBC.Connection!con.ExecuteAndReturn(v.Local.sSQL,v.Local.fRate)
			f.Intrinsic.Math.Mult(v.DataTable.dtQuote(v.Local.i1).Extension!FieldValFloat,v.Local.fRate,v.Local.fTax)
			f.Intrinsic.Math.Round(v.Local.fTax,2,v.Local.fTax)
			f.Intrinsic.Math.Add(v.Local.fTotal, v.Local.fTax, v.Local.fTotal)
		f.Intrinsic.Control.EndIf
		
		'Get Tax 8 Amount
		f.Intrinsic.Control.If(v.DataTable.dtQuote(v.Local.i1).Tax_Apply_8!FieldValTrim,=,"Y")
			f.Intrinsic.String.Build("SELECT RATE FROM V_AR_TAX_TABLES WHERE ZONE = '{0}' AND AUTH = '{1}'",v.DataTable.dtQuote(v.Local.i1).Tax_Zone_8!FieldValTrim, v.DataTable.dtQuote(v.Local.i1).Tax_8!FieldValTrim, v.Local.sSQL)
			f.ODBC.Connection!con.ExecuteAndReturn(v.Local.sSQL,v.Local.fRate)
			f.Intrinsic.Math.Mult(v.DataTable.dtQuote(v.Local.i1).Extension!FieldValFloat,v.Local.fRate,v.Local.fTax)
			f.Intrinsic.Math.Round(v.Local.fTax,2,v.Local.fTax)
			f.Intrinsic.Math.Add(v.Local.fTotal, v.Local.fTax, v.Local.fTotal)
		f.Intrinsic.Control.EndIf
		
		'Get Tax 9 Amount
		f.Intrinsic.Control.If(v.DataTable.dtQuote(v.Local.i1).Tax_Apply_9!FieldValTrim,=,"Y")
			f.Intrinsic.String.Build("SELECT RATE FROM V_AR_TAX_TABLES WHERE ZONE = '{0}' AND AUTH = '{1}'",v.DataTable.dtQuote(v.Local.i1).Tax_Zone_9!FieldValTrim, v.DataTable.dtQuote(v.Local.i1).Tax_9!FieldValTrim, v.Local.sSQL)
			f.ODBC.Connection!con.ExecuteAndReturn(v.Local.sSQL,v.Local.fRate)
			f.Intrinsic.Math.Mult(v.DataTable.dtQuote(v.Local.i1).Extension!FieldValFloat,v.Local.fRate,v.Local.fTax)
			f.Intrinsic.Math.Round(v.Local.fTax,2,v.Local.fTax)
			f.Intrinsic.Math.Add(v.Local.fTotal, v.Local.fTax, v.Local.fTotal)
		f.Intrinsic.Control.EndIf
		
		'Get Tax 10 Amount
		f.Intrinsic.Control.If(v.DataTable.dtQuote(v.Local.i1).Tax_Apply_10!FieldValTrim,=,"Y")
			f.Intrinsic.String.Build("SELECT RATE FROM V_AR_TAX_TABLES WHERE ZONE = '{0}' AND AUTH = '{1}'",v.DataTable.dtQuote(v.Local.i1).Tax_Zone_10!FieldValTrim, v.DataTable.dtQuote(v.Local.i1).Tax_10!FieldValTrim, v.Local.sSQL)
			f.ODBC.Connection!con.ExecuteAndReturn(v.Local.sSQL,v.Local.fRate)
			f.Intrinsic.Math.Mult(v.DataTable.dtQuote(v.Local.i1).Extension!FieldValFloat,v.Local.fRate,v.Local.fTax)
			f.Intrinsic.Math.Round(v.Local.fTax,2,v.Local.fTax)
			f.Intrinsic.Math.Add(v.Local.fTotal, v.Local.fTax, v.Local.fTotal)
		f.Intrinsic.Control.EndIf
		
		f.Intrinsic.Math.Add(v.DataTable.dtQuote(v.Local.i1).Extension!FieldValFloat, v.Local.fTotal, v.Local.fTotal)
		
		'Write the QuoteLine information to file
		'Write the QuoteLine Column Title if it is the first line
		f.Intrinsic.Control.If(v.Local.i1,=,0)
			f.Intrinsic.String.Build("{0}#!#{1}",v.Global.sQuoteLineColumnTitle,v.Ambient.NewLine,v.Local.sFile)		
		f.Intrinsic.Control.EndIf
		
		f.Intrinsic.String.Build("{1}{0}{2}{0}{3}{0}{4}{0}{5}{0}{6}","*!*",v.Global.sQuote,v.DataTable.dtQuote(v.Local.i1).RECORD_NO!FieldValTrim,v.DataTable.dtQuote(v.Local.i1).PART!FieldValTrim,v.DataTable.dtQuote(v.Local.i1).QTY_QUOTED!FieldValFloat,v.DataTable.dtQuote(v.Local.i1).PRICE!FieldValFloat,v.DataTable.dtQuote(v.Local.i1).AMT_DISCOUNT!FieldValFloat,v.Local.sTempValue)
		f.Intrinsic.String.Build("{0}{1}{2}",v.Local.sFile,v.Local.sTempValue,v.Ambient.NewLine,v.Local.sFile)				
	f.Intrinsic.Control.Next(v.Local.i1)
	
	'Write the QuoteHeader information to file
	f.Intrinsic.String.Build("&!&{0}#!#{1}",v.Global.sQuoteHeaderColumnTitle,v.Ambient.NewLine,v.Local.sTempValue)		
	f.Intrinsic.String.Build("{0}{1}",v.Local.sFile,v.Local.sTempValue,v.Local.sFile)		
	f.Intrinsic.String.Build("{0}{1}*!*{2}",v.Local.sFile,v.Global.sQuote,v.Local.fTotal,v.Local.sFile)
	
f.Intrinsic.Control.Else
	'Write the Empty QuoteLine information to file
	f.Intrinsic.String.Build("{0}#!#{1}{1}",v.Global.sQuoteLineColumnTitle,v.Ambient.NewLine,v.Local.sFile)

	'Write the QuoteHeader information to file
	f.Intrinsic.String.Build("&!&{0}#!#{1}",v.Global.sQuoteHeaderColumnTitle,v.Ambient.NewLine,v.Local.sTempValue)		
	f.Intrinsic.String.Build("{0}{1}",v.Local.sFile,v.Local.sTempValue,v.Local.sFile)		
	f.Intrinsic.String.Build("{0}{1}*!*{2}",v.Local.sFile,v.Global.sQuote,0,v.Local.sFile)
f.Intrinsic.Control.EndIf

f.Intrinsic.File.String2File(v.Local.sFileName,v.Local.sFile)
f.Intrinsic.Control.If(v.DataTable.dtQuote.Exists)
	f.Data.DataTable.Close("dtQuote")
f.Intrinsic.Control.EndIf
Program.Sub.Hook10260.End

Program.Sub.Hook10660.Start
v.Local.sSQL.Declare
v.Local.sDate.Declare
v.Local.sFileName.Declare
v.Local.sFile.Declare
v.Local.fAmount.Declare
v.Local.sTemp.Declare
v.Local.i1.Declare
v.Local.fRate.Declare
v.Local.fTax.Declare
v.Local.fTotal.Declare
v.Local.fTotalCust.Declare
v.Local.sSplitString.Declare
v.Local.sQuoteHeader.Declare
v.Local.sQuoteHeaderInfo.Declare
v.Local.sQuoteLine.Declare
v.Local.sQuoteLineInfo.Declare
v.Local.bQuoteChanged.Declare
v.Local.sFilter.Declare
v.Local.sRet.Declare
v.Local.iRowIndex.Declare
v.Local.fMaxDiscPct.Declare
v.Local.fDiscPct.Declare
v.Local.fTotalAmtQuoteLine.Declare
v.Local.sCurrCo.Declare
V.Local.sTempValue.Declare
V.Local.bExists.Declare

f.Intrinsic.String.LPad(v.Passed.000060,"0",7,v.Global.sQuote)
f.Intrinsic.String.Format(v.Ambient.Date,"YYYYMMDD",v.Local.sDate)
f.Intrinsic.String.Concat(v.System.Temp,"\GSS\GAB_6555_",v.Caller.User.Trim,"_",v.Local.sDate,".txt",v.Local.sFileName)
f.Intrinsic.File.File2String(v.Local.sFileName,v.Local.sFile)

'The temp file will look like this
'QUOTE_NO*!*RECORD_NO*!*PART*!*QTY*!*PRICE*!*AMT_DISCOUNT#!#
'0000017*!*0010*!*3000-A*!*10*!*9.0909*!*-27.27
'0000017*!*0020*!*8X10STGNK*!*2*!*90.909*!*-18.18
'&!&QUOTE_NO*!*AMT_TOTAL#!#
'0000017*!*243.18

'Split the Quote Header and Quote Line
f.Intrinsic.String.Build("{0}{1}",v.Ambient.NewLine,"&!&",v.Local.sSplitString)
f.Intrinsic.String.Split(v.Local.sFile,v.Local.sSplitString,v.Local.sFile)

'0 is Quote Line, 1 is Quote Header
'Process Quote Header
f.Intrinsic.String.Build("{0}{1}","#!#",v.Ambient.NewLine,v.Local.sSplitString)
f.Intrinsic.String.Split(v.Local.sFile(1),v.Local.sSplitString,v.Local.sQuoteHeader)
'The first line is the Quote Header Column Title
'The second line is the Quote Header information
f.Intrinsic.String.Split(v.Local.sQuoteHeader(1),"*!*",v.Local.sQuoteHeaderInfo)
f.Intrinsic.Math.ConvertToFloat(v.Local.sQuoteHeaderInfo(1),v.Local.fAmount)

'Process Quote Line
f.Intrinsic.String.Build("{0}{1}","#!#",v.Ambient.NewLine,v.Local.sSplitString)
f.Intrinsic.String.Split(v.Local.sFile(0),v.Local.sSplitString,v.Local.sQuoteLine)

'Convert to Datatable if the Quote Line exists
f.Intrinsic.Control.If(v.Local.sQuoteLine(1).Trim,<>,"")
	f.Data.DataTable.CreateFromString("dtOriginalQuoteLines",v.Local.sQuoteLine(1),v.Local.sQuoteLine(0),"String*!*String*!*String*!*Float*!*Float*!*Float","*!*",v.Ambient.NewLine,True)
f.Intrinsic.Control.Else
	f.Data.DataTable.Create("dtOriginalQuoteLines",True)
f.Intrinsic.Control.EndIf

'f.Intrinsic.String.Build("SELECT A.CUSTOMER, B.DATE_QUOTE, B.DATE_DUE, A.RECORD_NO, A.PART, A.QTY_QUOTED, A.PRICE, A.AMT_DISCOUNT, A.Extension, A.Extension_Quote, A.Tax_1, A.Tax_2, A.Tax_3, A.Tax_4, A.Tax_5, A.Tax_6, A.Tax_7, A.Tax_8, A.Tax_9, A.Tax_10, A.Tax_Apply_1, A.Tax_Apply_2, A.Tax_Apply_3, A.Tax_Apply_4, A.Tax_Apply_5, A.Tax_Apply_6, A.Tax_Apply_7, A.Tax_Apply_8, A.Tax_Apply_9, A.Tax_Apply_10, A.Tax_Zone_1, A.Tax_Zone_2, A.Tax_Zone_3, A.Tax_Zone_4, A.Tax_Zone_5, A.Tax_Zone_6, A.Tax_Zone_7, A.Tax_Zone_8, A.Tax_Zone_9, A.Tax_Zone_10 FROM V_QUOTE_LINES A LEFT JOIN V_QUOTE_HEADER B ON A.QUOTE_NO = B.QUOTE_NO WHERE A.QUOTE_NO='{0}' order by A.QUOTE_NO, A.RECORD_NO;",v.Global.sQuote,v.Local.sSQL)
f.Intrinsic.String.Build("SELECT A.QUOTE_CURR_CD, A.CUSTOMER, B.DATE_QUOTE, B.DATE_DUE, A.RECORD_NO, A.PART, A.QTY_QUOTED, A.PRICE, A.AMT_DISCOUNT, A.Extension, A.Extension_Quote, A.Tax_1, A.Tax_2, A.Tax_3, A.Tax_4, A.Tax_5, A.Tax_6, A.Tax_7, A.Tax_8, A.Tax_9, A.Tax_10, A.Tax_Apply_1, A.Tax_Apply_2, A.Tax_Apply_3, A.Tax_Apply_4, A.Tax_Apply_5, A.Tax_Apply_6, A.Tax_Apply_7, A.Tax_Apply_8, A.Tax_Apply_9, A.Tax_Apply_10, A.Tax_Zone_1, A.Tax_Zone_2, A.Tax_Zone_3, A.Tax_Zone_4, A.Tax_Zone_5, A.Tax_Zone_6, A.Tax_Zone_7, A.Tax_Zone_8, A.Tax_Zone_9, A.Tax_Zone_10 FROM V_QUOTE_LINES A LEFT JOIN V_QUOTE_HEADER B ON A.QUOTE_NO = B.QUOTE_NO WHERE A.QUOTE_NO='{0}' order by A.QUOTE_NO, A.RECORD_NO;",v.Global.sQuote,v.Local.sSQL)
f.Data.DataTable.CreateFromSQL("dtQuote","con",v.Local.sSQL,True)

'Get Base Currency
F.Global.General.ReadOption("000000",1,"","0000",V.Local.sCurrCo)

v.Local.bQuoteChanged.Set(False)

'If the total quote lines are different then there are changes to the Quote Lines
f.Intrinsic.Control.If(v.DataTable.dtOriginalQuoteLines.Exists)
	f.Intrinsic.Control.If(v.DataTable.dtOriginalQuoteLines.RowCount,<>,v.DataTable.dtQuote.RowCount)
		v.Local.bQuoteChanged.Set(True)
	f.Intrinsic.Control.EndIf
f.Intrinsic.Control.EndIf

f.Intrinsic.Control.If(v.DataTable.dtQuote.RowCount,>,0)
	V.Local.fTotal.Set(0)
	V.Local.fTotalCust.Set(0)
	f.Intrinsic.Control.For(v.Local.i1,0,v.DataTable.dtQuote.RowCount--,1)
		'Get Tax 1 Amount
		f.Intrinsic.Control.If(v.DataTable.dtQuote(v.Local.i1).Tax_Apply_1!FieldValTrim,=,"Y")
			f.Intrinsic.String.Build("SELECT RATE FROM V_AR_TAX_TABLES WHERE ZONE = '{0}' AND AUTH = '{1}'",v.DataTable.dtQuote(v.Local.i1).Tax_Zone_1!FieldValTrim, v.DataTable.dtQuote(v.Local.i1).Tax_1!FieldValTrim, v.Local.sSQL)
			f.ODBC.Connection!con.ExecuteAndReturn(v.Local.sSQL,v.Local.fRate)
			f.Intrinsic.Math.Mult(v.DataTable.dtQuote(v.Local.i1).Extension!FieldValFloat,v.Local.fRate,v.Local.fTax)
			f.Intrinsic.Math.Round(v.Local.fTax,2,v.Local.fTax)
			f.Intrinsic.Math.Add(v.Local.fTotal, v.Local.fTax, v.Local.fTotal)
			f.Intrinsic.Math.Mult(v.DataTable.dtQuote(v.Local.i1).Extension_Quote!FieldValFloat,v.Local.fRate,v.Local.fTax)
			f.Intrinsic.Math.Round(v.Local.fTax,2,v.Local.fTax)
			f.Intrinsic.Math.Add(v.Local.fTotalCust, v.Local.fTax, v.Local.fTotalCust)			
		f.Intrinsic.Control.EndIf
		
		'Get Tax 2 Amount
		f.Intrinsic.Control.If(v.DataTable.dtQuote(v.Local.i1).Tax_Apply_2!FieldValTrim,=,"Y")
			f.Intrinsic.String.Build("SELECT RATE FROM V_AR_TAX_TABLES WHERE ZONE = '{0}' AND AUTH = '{1}'",v.DataTable.dtQuote(v.Local.i1).Tax_Zone_2!FieldValTrim, v.DataTable.dtQuote(v.Local.i1).Tax_2!FieldValTrim, v.Local.sSQL)
			f.ODBC.Connection!con.ExecuteAndReturn(v.Local.sSQL,v.Local.fRate)
			f.Intrinsic.Math.Mult(v.DataTable.dtQuote(v.Local.i1).Extension!FieldValFloat,v.Local.fRate,v.Local.fTax)
			f.Intrinsic.Math.Round(v.Local.fTax,2,v.Local.fTax)
			f.Intrinsic.Math.Add(v.Local.fTotal, v.Local.fTax, v.Local.fTotal)
			f.Intrinsic.Math.Mult(v.DataTable.dtQuote(v.Local.i1).Extension_Quote!FieldValFloat,v.Local.fRate,v.Local.fTax)
			f.Intrinsic.Math.Round(v.Local.fTax,2,v.Local.fTax)
			f.Intrinsic.Math.Add(v.Local.fTotalCust, v.Local.fTax, v.Local.fTotalCust)			
		f.Intrinsic.Control.EndIf
		
		'Get Tax 3 Amount
		f.Intrinsic.Control.If(v.DataTable.dtQuote(v.Local.i1).Tax_Apply_3!FieldValTrim,=,"Y")
			f.Intrinsic.String.Build("SELECT RATE FROM V_AR_TAX_TABLES WHERE ZONE = '{0}' AND AUTH = '{1}'",v.DataTable.dtQuote(v.Local.i1).Tax_Zone_3!FieldValTrim, v.DataTable.dtQuote(v.Local.i1).Tax_3!FieldValTrim, v.Local.sSQL)
			f.ODBC.Connection!con.ExecuteAndReturn(v.Local.sSQL,v.Local.fRate)
			f.Intrinsic.Math.Mult(v.DataTable.dtQuote(v.Local.i1).Extension!FieldValFloat,v.Local.fRate,v.Local.fTax)
			f.Intrinsic.Math.Round(v.Local.fTax,2,v.Local.fTax)
			f.Intrinsic.Math.Add(v.Local.fTotal, v.Local.fTax, v.Local.fTotal)
			f.Intrinsic.Math.Mult(v.DataTable.dtQuote(v.Local.i1).Extension_Quote!FieldValFloat,v.Local.fRate,v.Local.fTax)
			f.Intrinsic.Math.Round(v.Local.fTax,2,v.Local.fTax)
			f.Intrinsic.Math.Add(v.Local.fTotalCust, v.Local.fTax, v.Local.fTotalCust)			
		f.Intrinsic.Control.EndIf

		'Get Tax 4 Amount
		f.Intrinsic.Control.If(v.DataTable.dtQuote(v.Local.i1).Tax_Apply_4!FieldValTrim,=,"Y")
			f.Intrinsic.String.Build("SELECT RATE FROM V_AR_TAX_TABLES WHERE ZONE = '{0}' AND AUTH = '{1}'",v.DataTable.dtQuote(v.Local.i1).Tax_Zone_4!FieldValTrim, v.DataTable.dtQuote(v.Local.i1).Tax_4!FieldValTrim, v.Local.sSQL)
			f.ODBC.Connection!con.ExecuteAndReturn(v.Local.sSQL,v.Local.fRate)
			f.Intrinsic.Math.Mult(v.DataTable.dtQuote(v.Local.i1).Extension!FieldValFloat,v.Local.fRate,v.Local.fTax)
			f.Intrinsic.Math.Round(v.Local.fTax,2,v.Local.fTax)
			f.Intrinsic.Math.Add(v.Local.fTotal, v.Local.fTax, v.Local.fTotal)
			f.Intrinsic.Math.Mult(v.DataTable.dtQuote(v.Local.i1).Extension_Quote!FieldValFloat,v.Local.fRate,v.Local.fTax)
			f.Intrinsic.Math.Round(v.Local.fTax,2,v.Local.fTax)
			f.Intrinsic.Math.Add(v.Local.fTotalCust, v.Local.fTax, v.Local.fTotalCust)			
		f.Intrinsic.Control.EndIf
		
		'Get Tax 5 Amount
		f.Intrinsic.Control.If(v.DataTable.dtQuote(v.Local.i1).Tax_Apply_5!FieldValTrim,=,"Y")
			f.Intrinsic.String.Build("SELECT RATE FROM V_AR_TAX_TABLES WHERE ZONE = '{0}' AND AUTH = '{1}'",v.DataTable.dtQuote(v.Local.i1).Tax_Zone_5!FieldValTrim, v.DataTable.dtQuote(v.Local.i1).Tax_5!FieldValTrim, v.Local.sSQL)
			f.ODBC.Connection!con.ExecuteAndReturn(v.Local.sSQL,v.Local.fRate)
			f.Intrinsic.Math.Mult(v.DataTable.dtQuote(v.Local.i1).Extension!FieldValFloat,v.Local.fRate,v.Local.fTax)
			f.Intrinsic.Math.Round(v.Local.fTax,2,v.Local.fTax)
			f.Intrinsic.Math.Add(v.Local.fTotal, v.Local.fTax, v.Local.fTotal)
			f.Intrinsic.Math.Mult(v.DataTable.dtQuote(v.Local.i1).Extension_Quote!FieldValFloat,v.Local.fRate,v.Local.fTax)
			f.Intrinsic.Math.Round(v.Local.fTax,2,v.Local.fTax)
			f.Intrinsic.Math.Add(v.Local.fTotalCust, v.Local.fTax, v.Local.fTotalCust)			
		f.Intrinsic.Control.EndIf
		
		'Get Tax 6 Amount
		f.Intrinsic.Control.If(v.DataTable.dtQuote(v.Local.i1).Tax_Apply_6!FieldValTrim,=,"Y")
			f.Intrinsic.String.Build("SELECT RATE FROM V_AR_TAX_TABLES WHERE ZONE = '{0}' AND AUTH = '{1}'",v.DataTable.dtQuote(v.Local.i1).Tax_Zone_6!FieldValTrim, v.DataTable.dtQuote(v.Local.i1).Tax_6!FieldValTrim, v.Local.sSQL)
			f.ODBC.Connection!con.ExecuteAndReturn(v.Local.sSQL,v.Local.fRate)
			f.Intrinsic.Math.Mult(v.DataTable.dtQuote(v.Local.i1).Extension!FieldValFloat,v.Local.fRate,v.Local.fTax)
			f.Intrinsic.Math.Round(v.Local.fTax,2,v.Local.fTax)
			f.Intrinsic.Math.Add(v.Local.fTotal, v.Local.fTax, v.Local.fTotal)
			f.Intrinsic.Math.Mult(v.DataTable.dtQuote(v.Local.i1).Extension_Quote!FieldValFloat,v.Local.fRate,v.Local.fTax)
			f.Intrinsic.Math.Round(v.Local.fTax,2,v.Local.fTax)
			f.Intrinsic.Math.Add(v.Local.fTotalCust, v.Local.fTax, v.Local.fTotalCust)			
		f.Intrinsic.Control.EndIf
		
		'Get Tax 7 Amount
		f.Intrinsic.Control.If(v.DataTable.dtQuote(v.Local.i1).Tax_Apply_7!FieldValTrim,=,"Y")
			f.Intrinsic.String.Build("SELECT RATE FROM V_AR_TAX_TABLES WHERE ZONE = '{0}' AND AUTH = '{1}'",v.DataTable.dtQuote(v.Local.i1).Tax_Zone_7!FieldValTrim, v.DataTable.dtQuote(v.Local.i1).Tax_7!FieldValTrim, v.Local.sSQL)
			f.ODBC.Connection!con.ExecuteAndReturn(v.Local.sSQL,v.Local.fRate)
			f.Intrinsic.Math.Mult(v.DataTable.dtQuote(v.Local.i1).Extension!FieldValFloat,v.Local.fRate,v.Local.fTax)
			f.Intrinsic.Math.Round(v.Local.fTax,2,v.Local.fTax)
			f.Intrinsic.Math.Add(v.Local.fTotal, v.Local.fTax, v.Local.fTotal)
			f.Intrinsic.Math.Mult(v.DataTable.dtQuote(v.Local.i1).Extension_Quote!FieldValFloat,v.Local.fRate,v.Local.fTax)
			f.Intrinsic.Math.Round(v.Local.fTax,2,v.Local.fTax)
			f.Intrinsic.Math.Add(v.Local.fTotalCust, v.Local.fTax, v.Local.fTotalCust)			
		f.Intrinsic.Control.EndIf
		
		'Get Tax 8 Amount
		f.Intrinsic.Control.If(v.DataTable.dtQuote(v.Local.i1).Tax_Apply_8!FieldValTrim,=,"Y")
			f.Intrinsic.String.Build("SELECT RATE FROM V_AR_TAX_TABLES WHERE ZONE = '{0}' AND AUTH = '{1}'",v.DataTable.dtQuote(v.Local.i1).Tax_Zone_8!FieldValTrim, v.DataTable.dtQuote(v.Local.i1).Tax_8!FieldValTrim, v.Local.sSQL)
			f.ODBC.Connection!con.ExecuteAndReturn(v.Local.sSQL,v.Local.fRate)
			f.Intrinsic.Math.Mult(v.DataTable.dtQuote(v.Local.i1).Extension!FieldValFloat,v.Local.fRate,v.Local.fTax)
			f.Intrinsic.Math.Round(v.Local.fTax,2,v.Local.fTax)
			f.Intrinsic.Math.Add(v.Local.fTotal, v.Local.fTax, v.Local.fTotal)
			f.Intrinsic.Math.Mult(v.DataTable.dtQuote(v.Local.i1).Extension_Quote!FieldValFloat,v.Local.fRate,v.Local.fTax)
			f.Intrinsic.Math.Round(v.Local.fTax,2,v.Local.fTax)
			f.Intrinsic.Math.Add(v.Local.fTotalCust, v.Local.fTax, v.Local.fTotalCust)			
		f.Intrinsic.Control.EndIf
		
		'Get Tax 9 Amount
		f.Intrinsic.Control.If(v.DataTable.dtQuote(v.Local.i1).Tax_Apply_9!FieldValTrim,=,"Y")
			f.Intrinsic.String.Build("SELECT RATE FROM V_AR_TAX_TABLES WHERE ZONE = '{0}' AND AUTH = '{1}'",v.DataTable.dtQuote(v.Local.i1).Tax_Zone_9!FieldValTrim, v.DataTable.dtQuote(v.Local.i1).Tax_9!FieldValTrim, v.Local.sSQL)
			f.ODBC.Connection!con.ExecuteAndReturn(v.Local.sSQL,v.Local.fRate)
			f.Intrinsic.Math.Mult(v.DataTable.dtQuote(v.Local.i1).Extension!FieldValFloat,v.Local.fRate,v.Local.fTax)
			f.Intrinsic.Math.Round(v.Local.fTax,2,v.Local.fTax)
			f.Intrinsic.Math.Add(v.Local.fTotal, v.Local.fTax, v.Local.fTotal)
			f.Intrinsic.Math.Mult(v.DataTable.dtQuote(v.Local.i1).Extension_Quote!FieldValFloat,v.Local.fRate,v.Local.fTax)
			f.Intrinsic.Math.Round(v.Local.fTax,2,v.Local.fTax)
			f.Intrinsic.Math.Add(v.Local.fTotalCust, v.Local.fTax, v.Local.fTotalCust)			
		f.Intrinsic.Control.EndIf
		
		'Get Tax 10 Amount
		f.Intrinsic.Control.If(v.DataTable.dtQuote(v.Local.i1).Tax_Apply_10!FieldValTrim,=,"Y")
			f.Intrinsic.String.Build("SELECT RATE FROM V_AR_TAX_TABLES WHERE ZONE = '{0}' AND AUTH = '{1}'",v.DataTable.dtQuote(v.Local.i1).Tax_Zone_10!FieldValTrim, v.DataTable.dtQuote(v.Local.i1).Tax_10!FieldValTrim, v.Local.sSQL)
			f.ODBC.Connection!con.ExecuteAndReturn(v.Local.sSQL,v.Local.fRate)
			f.Intrinsic.Math.Mult(v.DataTable.dtQuote(v.Local.i1).Extension!FieldValFloat,v.Local.fRate,v.Local.fTax)
			f.Intrinsic.Math.Round(v.Local.fTax,2,v.Local.fTax)
			f.Intrinsic.Math.Add(v.Local.fTotal, v.Local.fTax, v.Local.fTotal)
			f.Intrinsic.Math.Mult(v.DataTable.dtQuote(v.Local.i1).Extension_Quote!FieldValFloat,v.Local.fRate,v.Local.fTax)
			f.Intrinsic.Math.Round(v.Local.fTax,2,v.Local.fTax)
			f.Intrinsic.Math.Add(v.Local.fTotalCust, v.Local.fTax, v.Local.fTotalCust)			
		f.Intrinsic.Control.EndIf
		
		f.Intrinsic.Math.Add(v.DataTable.dtQuote(v.Local.i1).Extension!FieldValFloat, v.Local.fTotal, v.Local.fTotal)
		f.Intrinsic.Control.If(v.DataTable.dtQuote(v.Local.i1).QUOTE_CURR_CD!FieldValTrim,=,v.Local.sCurrCo)
			v.Local.fTotalCust.Set(0.00)
		f.Intrinsic.Control.Else
			f.Intrinsic.Math.Add(v.DataTable.dtQuote(v.Local.i1).Extension_Quote!FieldValFloat, v.Local.fTotalCust, v.Local.fTotalCust)
		f.Intrinsic.Control.EndIf
		
		'Checked & Compare the Quote Line data if no change is detected yet
		f.Intrinsic.Control.If(v.Local.bQuoteChanged.Not)
			f.Intrinsic.Control.If(v.DataTable.dtOriginalQuoteLines.Exists)
				f.Intrinsic.String.Build("RECORD_NO = '{0}'",v.DataTable.dtQuote(v.Local.i1).RECORD_NO!FieldValTrim,v.Local.sFilter)
				f.Data.DataTable.Select("dtOriginalQuoteLines",v.Local.sFilter,v.Local.sRet)
				f.Intrinsic.Control.If(v.Local.sRet,=,"***NORETURN***")
					v.Local.bQuoteChanged.Set(True)
				f.Intrinsic.Control.Else
					f.Intrinsic.String.Split(v.Local.sRet,"*!*",v.Local.sRet)
					v.Local.iRowIndex.Set(v.Local.sRet(0).Long)
					f.Intrinsic.Control.If(v.DataTable.dtQuote(v.Local.i1).PART!FieldValTrim,<>,v.DataTable.dtOriginalQuoteLines(v.Local.iRowIndex).PART!FieldValTrim)
						v.Local.bQuoteChanged.Set(True)
					f.Intrinsic.Control.ElseIf(v.DataTable.dtQuote(v.Local.i1).QTY_QUOTED!FieldValFloat,<>,v.DataTable.dtOriginalQuoteLines(v.Local.iRowIndex).QTY_QUOTED!FieldValFloat)
						v.Local.bQuoteChanged.Set(True)
					f.Intrinsic.Control.ElseIf(v.DataTable.dtQuote(v.Local.i1).PRICE!FieldValFloat,<>,v.DataTable.dtOriginalQuoteLines(v.Local.iRowIndex).PRICE!FieldValFloat)
						v.Local.bQuoteChanged.Set(True)
					f.Intrinsic.Control.ElseIf(v.DataTable.dtQuote(v.Local.i1).AMT_DISCOUNT!FieldValFloat,<>,v.DataTable.dtOriginalQuoteLines(v.Local.iRowIndex).AMT_DISCOUNT!FieldValFloat)
						v.Local.bQuoteChanged.Set(True)
					f.Intrinsic.Control.EndIf
				f.Intrinsic.Control.EndIf
			f.Intrinsic.Control.EndIf
		f.Intrinsic.Control.EndIf
		
		'Calculate the Disc Pct for the Quote Line
		'Set it as the Max Disc Pct for the Quote if it is greater than the Max Disc Pct
		f.Intrinsic.Math.Mult(v.DataTable.dtQuote(v.Local.i1).QTY_QUOTED!FieldValFloat,v.DataTable.dtQuote(v.Local.i1).PRICE!FieldValFloat,v.Local.fTotalAmtQuoteLine)
		f.Intrinsic.Control.If(v.Local.fTotalAmtQuoteLine,>,0)
			f.Intrinsic.Math.Div(v.DataTable.dtQuote(v.Local.i1).AMT_DISCOUNT!FieldValFloat,v.Local.fTotalAmtQuoteLine,v.Local.fDiscPct)
			f.Intrinsic.Math.Round(v.Local.fDiscPct,4,v.Local.fDiscPct)
			f.Intrinsic.Math.Abs(v.Local.fDiscPct,v.Local.fDiscPct)
			f.Intrinsic.Control.If(v.Local.fMaxDiscPct,<,v.Local.fDiscPct)
				v.Local.fMaxDiscPct.Set(v.Local.fDiscPct)
			f.Intrinsic.Control.EndIf
		f.Intrinsic.Control.EndIf
	f.Intrinsic.Control.Next(v.Local.i1)
f.Intrinsic.Control.Else
'	f.Intrinsic.UI.Msgbox("This Quote is not added into quote approval. Please add at least one quote line.","Quote Approval (6555)")
	'TDjohan - BEGIN    11/22/2022
	'f.Intrinsic.File.DeleteFile(v.Local.sFileName)
	'TDjohan - END    11/22/2022
	'TDjohan - BEGIN    11/22/2022
	f.Intrinsic.Control.If(V.Local.bQuoteChanged)
		f.Intrinsic.File.Exists(v.Local.sFileName,v.Local.bExists)
		f.Intrinsic.Control.If(v.Local.bExists,=,True)
			f.Intrinsic.File.DeleteFile(v.Local.sFileName)
		f.Intrinsic.Control.EndIf
		
		f.Intrinsic.Control.If(v.DataTable.dtQuote.Exists)
			f.Data.DataTable.Close("dtQuote")
		f.Intrinsic.Control.EndIf
		
		f.Intrinsic.String.Build("SELECT A.CUSTOMER, B.DATE_QUOTE, B.DATE_DUE, A.RECORD_NO, A.PART, A.QTY_QUOTED, A.PRICE, A.AMT_DISCOUNT, A.Extension, A.Extension_Quote, A.Tax_1, A.Tax_2, A.Tax_3, A.Tax_4, A.Tax_5, A.Tax_6, A.Tax_7, A.Tax_8, A.Tax_9, A.Tax_10, A.Tax_Apply_1, A.Tax_Apply_2, A.Tax_Apply_3, A.Tax_Apply_4, A.Tax_Apply_5, A.Tax_Apply_6, A.Tax_Apply_7, A.Tax_Apply_8, A.Tax_Apply_9, A.Tax_Apply_10, A.Tax_Zone_1, A.Tax_Zone_2, A.Tax_Zone_3, A.Tax_Zone_4, A.Tax_Zone_5, A.Tax_Zone_6, A.Tax_Zone_7, A.Tax_Zone_8, A.Tax_Zone_9, A.Tax_Zone_10 FROM V_QUOTE_LINES A LEFT JOIN V_QUOTE_HEADER B ON A.QUOTE_NO = B.QUOTE_NO WHERE A.QUOTE_NO='{0}' ORDER BY A.QUOTE_NO, A.RECORD_NO;",v.Global.sQuote,v.Local.sSQL)
		f.Data.DataTable.CreateFromSQL("dtQuote","con",v.Local.sSQL,True)
		f.Intrinsic.Control.If(v.DataTable.dtQuote.RowCount,>,0)
			V.Local.fTotal.Set(0)
			f.Intrinsic.Control.For(v.Local.i1,0,v.DataTable.dtQuote.RowCount--,1)
				'Get Tax 1 Amount
				f.Intrinsic.Control.If(v.DataTable.dtQuote(v.Local.i1).Tax_Apply_1!FieldValTrim,=,"Y")
					f.Intrinsic.String.Build("SELECT RATE FROM V_AR_TAX_TABLES WHERE ZONE = '{0}' AND AUTH = '{1}'",v.DataTable.dtQuote(v.Local.i1).Tax_Zone_1!FieldValTrim, v.DataTable.dtQuote(v.Local.i1).Tax_1!FieldValTrim, v.Local.sSQL)
					f.ODBC.Connection!con.ExecuteAndReturn(v.Local.sSQL,v.Local.fRate)
					f.Intrinsic.Math.Mult(v.DataTable.dtQuote(v.Local.i1).Extension!FieldValFloat,v.Local.fRate,v.Local.fTax)
					f.Intrinsic.Math.Round(v.Local.fTax,2,v.Local.fTax)
					f.Intrinsic.Math.Add(v.Local.fTotal, v.Local.fTax, v.Local.fTotal)
				f.Intrinsic.Control.EndIf
				
				'Get Tax 2 Amount
				f.Intrinsic.Control.If(v.DataTable.dtQuote(v.Local.i1).Tax_Apply_2!FieldValTrim,=,"Y")
					f.Intrinsic.String.Build("SELECT RATE FROM V_AR_TAX_TABLES WHERE ZONE = '{0}' AND AUTH = '{1}'",v.DataTable.dtQuote(v.Local.i1).Tax_Zone_2!FieldValTrim, v.DataTable.dtQuote(v.Local.i1).Tax_2!FieldValTrim, v.Local.sSQL)
					f.ODBC.Connection!con.ExecuteAndReturn(v.Local.sSQL,v.Local.fRate)
					f.Intrinsic.Math.Mult(v.DataTable.dtQuote(v.Local.i1).Extension!FieldValFloat,v.Local.fRate,v.Local.fTax)
					f.Intrinsic.Math.Round(v.Local.fTax,2,v.Local.fTax)
					f.Intrinsic.Math.Add(v.Local.fTotal, v.Local.fTax, v.Local.fTotal)
				f.Intrinsic.Control.EndIf
				
				'Get Tax 3 Amount
				f.Intrinsic.Control.If(v.DataTable.dtQuote(v.Local.i1).Tax_Apply_3!FieldValTrim,=,"Y")
					f.Intrinsic.String.Build("SELECT RATE FROM V_AR_TAX_TABLES WHERE ZONE = '{0}' AND AUTH = '{1}'",v.DataTable.dtQuote(v.Local.i1).Tax_Zone_3!FieldValTrim, v.DataTable.dtQuote(v.Local.i1).Tax_3!FieldValTrim, v.Local.sSQL)
					f.ODBC.Connection!con.ExecuteAndReturn(v.Local.sSQL,v.Local.fRate)
					f.Intrinsic.Math.Mult(v.DataTable.dtQuote(v.Local.i1).Extension!FieldValFloat,v.Local.fRate,v.Local.fTax)
					f.Intrinsic.Math.Round(v.Local.fTax,2,v.Local.fTax)
					f.Intrinsic.Math.Add(v.Local.fTotal, v.Local.fTax, v.Local.fTotal)
				f.Intrinsic.Control.EndIf
		
				'Get Tax 4 Amount
				f.Intrinsic.Control.If(v.DataTable.dtQuote(v.Local.i1).Tax_Apply_4!FieldValTrim,=,"Y")
					f.Intrinsic.String.Build("SELECT RATE FROM V_AR_TAX_TABLES WHERE ZONE = '{0}' AND AUTH = '{1}'",v.DataTable.dtQuote(v.Local.i1).Tax_Zone_4!FieldValTrim, v.DataTable.dtQuote(v.Local.i1).Tax_4!FieldValTrim, v.Local.sSQL)
					f.ODBC.Connection!con.ExecuteAndReturn(v.Local.sSQL,v.Local.fRate)
					f.Intrinsic.Math.Mult(v.DataTable.dtQuote(v.Local.i1).Extension!FieldValFloat,v.Local.fRate,v.Local.fTax)
					f.Intrinsic.Math.Round(v.Local.fTax,2,v.Local.fTax)
					f.Intrinsic.Math.Add(v.Local.fTotal, v.Local.fTax, v.Local.fTotal)
				f.Intrinsic.Control.EndIf
				
				'Get Tax 5 Amount
				f.Intrinsic.Control.If(v.DataTable.dtQuote(v.Local.i1).Tax_Apply_5!FieldValTrim,=,"Y")
					f.Intrinsic.String.Build("SELECT RATE FROM V_AR_TAX_TABLES WHERE ZONE = '{0}' AND AUTH = '{1}'",v.DataTable.dtQuote(v.Local.i1).Tax_Zone_5!FieldValTrim, v.DataTable.dtQuote(v.Local.i1).Tax_5!FieldValTrim, v.Local.sSQL)
					f.ODBC.Connection!con.ExecuteAndReturn(v.Local.sSQL,v.Local.fRate)
					f.Intrinsic.Math.Mult(v.DataTable.dtQuote(v.Local.i1).Extension!FieldValFloat,v.Local.fRate,v.Local.fTax)
					f.Intrinsic.Math.Round(v.Local.fTax,2,v.Local.fTax)
					f.Intrinsic.Math.Add(v.Local.fTotal, v.Local.fTax, v.Local.fTotal)
				f.Intrinsic.Control.EndIf
				
				'Get Tax 6 Amount
				f.Intrinsic.Control.If(v.DataTable.dtQuote(v.Local.i1).Tax_Apply_6!FieldValTrim,=,"Y")
					f.Intrinsic.String.Build("SELECT RATE FROM V_AR_TAX_TABLES WHERE ZONE = '{0}' AND AUTH = '{1}'",v.DataTable.dtQuote(v.Local.i1).Tax_Zone_6!FieldValTrim, v.DataTable.dtQuote(v.Local.i1).Tax_6!FieldValTrim, v.Local.sSQL)
					f.ODBC.Connection!con.ExecuteAndReturn(v.Local.sSQL,v.Local.fRate)
					f.Intrinsic.Math.Mult(v.DataTable.dtQuote(v.Local.i1).Extension!FieldValFloat,v.Local.fRate,v.Local.fTax)
					f.Intrinsic.Math.Round(v.Local.fTax,2,v.Local.fTax)
					f.Intrinsic.Math.Add(v.Local.fTotal, v.Local.fTax, v.Local.fTotal)
				f.Intrinsic.Control.EndIf
				
				'Get Tax 7 Amount
				f.Intrinsic.Control.If(v.DataTable.dtQuote(v.Local.i1).Tax_Apply_7!FieldValTrim,=,"Y")
					f.Intrinsic.String.Build("SELECT RATE FROM V_AR_TAX_TABLES WHERE ZONE = '{0}' AND AUTH = '{1}'",v.DataTable.dtQuote(v.Local.i1).Tax_Zone_7!FieldValTrim, v.DataTable.dtQuote(v.Local.i1).Tax_7!FieldValTrim, v.Local.sSQL)
					f.ODBC.Connection!con.ExecuteAndReturn(v.Local.sSQL,v.Local.fRate)
					f.Intrinsic.Math.Mult(v.DataTable.dtQuote(v.Local.i1).Extension!FieldValFloat,v.Local.fRate,v.Local.fTax)
					f.Intrinsic.Math.Round(v.Local.fTax,2,v.Local.fTax)
					f.Intrinsic.Math.Add(v.Local.fTotal, v.Local.fTax, v.Local.fTotal)
				f.Intrinsic.Control.EndIf
				
				'Get Tax 8 Amount
				f.Intrinsic.Control.If(v.DataTable.dtQuote(v.Local.i1).Tax_Apply_8!FieldValTrim,=,"Y")
					f.Intrinsic.String.Build("SELECT RATE FROM V_AR_TAX_TABLES WHERE ZONE = '{0}' AND AUTH = '{1}'",v.DataTable.dtQuote(v.Local.i1).Tax_Zone_8!FieldValTrim, v.DataTable.dtQuote(v.Local.i1).Tax_8!FieldValTrim, v.Local.sSQL)
					f.ODBC.Connection!con.ExecuteAndReturn(v.Local.sSQL,v.Local.fRate)
					f.Intrinsic.Math.Mult(v.DataTable.dtQuote(v.Local.i1).Extension!FieldValFloat,v.Local.fRate,v.Local.fTax)
					f.Intrinsic.Math.Round(v.Local.fTax,2,v.Local.fTax)
					f.Intrinsic.Math.Add(v.Local.fTotal, v.Local.fTax, v.Local.fTotal)
				f.Intrinsic.Control.EndIf
				
				'Get Tax 9 Amount
				f.Intrinsic.Control.If(v.DataTable.dtQuote(v.Local.i1).Tax_Apply_9!FieldValTrim,=,"Y")
					f.Intrinsic.String.Build("SELECT RATE FROM V_AR_TAX_TABLES WHERE ZONE = '{0}' AND AUTH = '{1}'",v.DataTable.dtQuote(v.Local.i1).Tax_Zone_9!FieldValTrim, v.DataTable.dtQuote(v.Local.i1).Tax_9!FieldValTrim, v.Local.sSQL)
					f.ODBC.Connection!con.ExecuteAndReturn(v.Local.sSQL,v.Local.fRate)
					f.Intrinsic.Math.Mult(v.DataTable.dtQuote(v.Local.i1).Extension!FieldValFloat,v.Local.fRate,v.Local.fTax)
					f.Intrinsic.Math.Round(v.Local.fTax,2,v.Local.fTax)
					f.Intrinsic.Math.Add(v.Local.fTotal, v.Local.fTax, v.Local.fTotal)
				f.Intrinsic.Control.EndIf
				
				'Get Tax 10 Amount
				f.Intrinsic.Control.If(v.DataTable.dtQuote(v.Local.i1).Tax_Apply_10!FieldValTrim,=,"Y")
					f.Intrinsic.String.Build("SELECT RATE FROM V_AR_TAX_TABLES WHERE ZONE = '{0}' AND AUTH = '{1}'",v.DataTable.dtQuote(v.Local.i1).Tax_Zone_10!FieldValTrim, v.DataTable.dtQuote(v.Local.i1).Tax_10!FieldValTrim, v.Local.sSQL)
					f.ODBC.Connection!con.ExecuteAndReturn(v.Local.sSQL,v.Local.fRate)
					f.Intrinsic.Math.Mult(v.DataTable.dtQuote(v.Local.i1).Extension!FieldValFloat,v.Local.fRate,v.Local.fTax)
					f.Intrinsic.Math.Round(v.Local.fTax,2,v.Local.fTax)
					f.Intrinsic.Math.Add(v.Local.fTotal, v.Local.fTax, v.Local.fTotal)
				f.Intrinsic.Control.EndIf
				
				f.Intrinsic.Math.Add(v.DataTable.dtQuote(v.Local.i1).Extension!FieldValFloat, v.Local.fTotal, v.Local.fTotal)
				
				'Write the QuoteLine information to file
				'Write the QuoteLine Column Title if it is the first line
				f.Intrinsic.Control.If(v.Local.i1,=,0)
					f.Intrinsic.String.Build("{0}#!#{1}",v.Global.sQuoteLineColumnTitle,v.Ambient.NewLine,v.Local.sFile)		
				f.Intrinsic.Control.EndIf
				
				f.Intrinsic.String.Build("{1}{0}{2}{0}{3}{0}{4}{0}{5}{0}{6}","*!*",v.Global.sQuote,v.DataTable.dtQuote(v.Local.i1).RECORD_NO!FieldValTrim,v.DataTable.dtQuote(v.Local.i1).PART!FieldValTrim,v.DataTable.dtQuote(v.Local.i1).QTY_QUOTED!FieldValFloat,v.DataTable.dtQuote(v.Local.i1).PRICE!FieldValFloat,v.DataTable.dtQuote(v.Local.i1).AMT_DISCOUNT!FieldValFloat,v.Local.sTempValue)
				f.Intrinsic.String.Build("{0}{1}{2}",v.Local.sFile,v.Local.sTempValue,v.Ambient.NewLine,v.Local.sFile)				
			f.Intrinsic.Control.Next(v.Local.i1)
			
			'Write the QuoteHeader information to file
			f.Intrinsic.String.Build("&!&{0}#!#{1}",v.Global.sQuoteHeaderColumnTitle,v.Ambient.NewLine,v.Local.sTempValue)		
			f.Intrinsic.String.Build("{0}{1}",v.Local.sFile,v.Local.sTempValue,v.Local.sFile)		
			f.Intrinsic.String.Build("{0}{1}*!*{2}",v.Local.sFile,v.Global.sQuote,v.Local.fTotal,v.Local.sFile)
			
		f.Intrinsic.Control.Else
			'Write the Empty QuoteLine information to file
			f.Intrinsic.String.Build("{0}#!#{1}{1}",v.Global.sQuoteLineColumnTitle,v.Ambient.NewLine,v.Local.sFile)
		
			'Write the QuoteHeader information to file
			f.Intrinsic.String.Build("&!&{0}#!#{1}",v.Global.sQuoteHeaderColumnTitle,v.Ambient.NewLine,v.Local.sTempValue)		
			f.Intrinsic.String.Build("{0}{1}",v.Local.sFile,v.Local.sTempValue,v.Local.sFile)		
			f.Intrinsic.String.Build("{0}{1}*!*{2}",v.Local.sFile,v.Global.sQuote,0,v.Local.sFile)
		f.Intrinsic.Control.EndIf
		
		f.Intrinsic.File.String2File(v.Local.sFileName,v.Local.sFile)
		f.Intrinsic.Control.If(v.DataTable.dtQuote.Exists)
			f.Data.DataTable.Close("dtQuote")
		f.Intrinsic.Control.EndIf
	F.Intrinsic.Control.EndIf
	
	f.Intrinsic.String.Build("update GAB_6555_APRVL set Cust_Amount = 0, Amount = 0, MAX_DISCOUNT = 0, Approver = '*REVISE*', APPROVED_DATE = NULL where Quote_No = '{0}'",v.Global.sQuote,v.Local.sSQL)
	f.ODBC.Connection!con.Execute(v.Local.sSQL)
	'TDjohan - END    11/22/2022
	f.Intrinsic.Control.ExitSub
f.Intrinsic.Control.EndIf

f.Intrinsic.String.Build("SELECT * FROM GAB_6555_APRVL WHERE QUOTE_NO = '{0}';",v.Global.sQuote,v.Local.sSQL)
f.Data.DataTable.CreateFromSQL("dtGAB","con",v.Local.sSQL,True)
f.Intrinsic.Control.If(v.DataTable.dtGAB.RowCount,=,0)
	f.Intrinsic.Control.If(v.Local.fMaxDiscPct,=,0)
		'Automatically approved the Quote because there is no Discount in the Quote lines
		f.Intrinsic.String.Build("insert into GAB_6555_APRVL(QUOTE_NO, DATE_QUOTE, CUSTOMER, CUST_AMOUNT, AMOUNT, MAX_DISCOUNT, DATE_DUE, ORIGINATOR, APPROVER, APPROVED_DATE) values('{0}', '{1}', '{2}', {3}, {4}, {5}, '{6}', '{7}', 'SYSTEM', NOW());",v.Global.sQuote, v.DataTable.dtQuote(0).Date_Quote!FieldValPervasiveDate, v.DataTable.dtQuote(0).Customer!FieldValTrim, v.Local.fTotalCust, v.Local.fTotal, v.Local.fMaxDiscPct, v.DataTable.dtQuote(0).Date_Due!FieldValPervasiveDate, v.Caller.User.Trim,  v.Local.sSQL)
	f.Intrinsic.Control.Else
		f.Intrinsic.String.Build("insert into GAB_6555_APRVL(QUOTE_NO, DATE_QUOTE, CUSTOMER, CUST_AMOUNT, AMOUNT, MAX_DISCOUNT, DATE_DUE, ORIGINATOR) values('{0}', '{1}', '{2}', {3}, {4}, {5}, '{6}', '{7}');",v.Global.sQuote, v.DataTable.dtQuote(0).Date_Quote!FieldValPervasiveDate, v.DataTable.dtQuote(0).Customer!FieldValTrim, v.Local.fTotalCust, v.Local.fTotal, v.Local.fMaxDiscPct, v.DataTable.dtQuote(0).Date_Due!FieldValPervasiveDate, v.Caller.User.Trim, v.Local.sSQL)
		'Send email to approvers
		f.Intrinsic.Control.CallSub(SendEmail,"Customer",v.DataTable.dtQuote(0).Customer!FieldValTrim,"MaxDiscPct",v.Local.fMaxDiscPct)
	f.Intrinsic.Control.EndIf
f.Intrinsic.Control.ElseIf(v.DataTable.dtGAB.RowCount,>,0)
	f.Intrinsic.Control.If(v.Local.bQuoteChanged)		
		f.Intrinsic.Control.If(v.Local.fMaxDiscPct,=,0)
			'Automatically approved the Quote because there is no Discount in the Quote lines
			f.Intrinsic.String.Build("update GAB_6555_APRVL set DATE_QUOTE = '{1}', Cust_Amount = {2}, Amount = {3}, MAX_DISCOUNT = {4}, DATE_DUE = '{5}', Approver = 'SYSTEM', APPROVED_DATE = NOW() where Quote_No = '{0}'",v.Global.sQuote, v.DataTable.dtQuote(0).Date_Quote!FieldValPervasiveDate, v.Local.fTotalCust, v.Local.fTotal, v.Local.fMaxDiscPct, v.DataTable.dtQuote(0).Date_Due!FieldValPervasiveDate, v.Local.sSQL)
		f.Intrinsic.Control.Else
			f.Intrinsic.String.Build("update GAB_6555_APRVL set DATE_QUOTE = '{1}', Cust_Amount = {2}, Amount = {3}, MAX_DISCOUNT = {4}, DATE_DUE = '{5}', Approver = '*REVISE*', APPROVED_DATE = NULL where Quote_No = '{0}'",v.Global.sQuote, v.DataTable.dtQuote(0).Date_Quote!FieldValPervasiveDate, v.Local.fTotalCust, v.Local.fTotal, v.Local.fMaxDiscPct, v.DataTable.dtQuote(0).Date_Due!FieldValPervasiveDate, v.Local.sSQL)
			'Send email to approvers
			f.Intrinsic.Control.CallSub(SendEmail,"Customer",v.DataTable.dtQuote(0).Customer!FieldValTrim,"MaxDiscPct",v.Local.fMaxDiscPct)
		f.Intrinsic.Control.EndIf
	f.Intrinsic.Control.EndIf
f.Intrinsic.Control.EndIf
f.ODBC.Connection!con.Execute(v.Local.sSQL)

f.Intrinsic.Control.If(v.DataTable.dtOriginalQuoteLines.Exists)
	f.Data.DataTable.Close("dtOriginalQuoteLines")
f.Intrinsic.Control.EndIf

f.Intrinsic.Control.If(v.DataTable.dtQuote.Exists)
	f.Data.DataTable.Close("dtQuote")
f.Intrinsic.Control.EndIf

f.Intrinsic.Control.If(v.DataTable.dtGAB.Exists)
	f.Data.DataTable.Close("dtGAB")
f.Intrinsic.Control.EndIf

'TDjohan - BEGIN    11/22/2022
'f.Intrinsic.File.DeleteFile(v.Local.sFileName)
'TDjohan - END    11/22/2022

'TDjohan - BEGIN    11/22/2022
f.Intrinsic.Control.If(V.Local.bQuoteChanged)
	f.Intrinsic.File.Exists(v.Local.sFileName,v.Local.bExists)
	f.Intrinsic.Control.If(v.Local.bExists,=,True)
		f.Intrinsic.File.DeleteFile(v.Local.sFileName)
	f.Intrinsic.Control.EndIf
	
	f.Intrinsic.Control.If(v.DataTable.dtQuote.Exists)
		f.Data.DataTable.Close("dtQuote")
	f.Intrinsic.Control.EndIf
	
	f.Intrinsic.String.Build("SELECT A.CUSTOMER, B.DATE_QUOTE, B.DATE_DUE, A.RECORD_NO, A.PART, A.QTY_QUOTED, A.PRICE, A.AMT_DISCOUNT, A.Extension, A.Extension_Quote, A.Tax_1, A.Tax_2, A.Tax_3, A.Tax_4, A.Tax_5, A.Tax_6, A.Tax_7, A.Tax_8, A.Tax_9, A.Tax_10, A.Tax_Apply_1, A.Tax_Apply_2, A.Tax_Apply_3, A.Tax_Apply_4, A.Tax_Apply_5, A.Tax_Apply_6, A.Tax_Apply_7, A.Tax_Apply_8, A.Tax_Apply_9, A.Tax_Apply_10, A.Tax_Zone_1, A.Tax_Zone_2, A.Tax_Zone_3, A.Tax_Zone_4, A.Tax_Zone_5, A.Tax_Zone_6, A.Tax_Zone_7, A.Tax_Zone_8, A.Tax_Zone_9, A.Tax_Zone_10 FROM V_QUOTE_LINES A LEFT JOIN V_QUOTE_HEADER B ON A.QUOTE_NO = B.QUOTE_NO WHERE A.QUOTE_NO='{0}' ORDER BY A.QUOTE_NO, A.RECORD_NO;",v.Global.sQuote,v.Local.sSQL)
	f.Data.DataTable.CreateFromSQL("dtQuote","con",v.Local.sSQL,True)
	f.Intrinsic.Control.If(v.DataTable.dtQuote.RowCount,>,0)
		V.Local.fTotal.Set(0)
		f.Intrinsic.Control.For(v.Local.i1,0,v.DataTable.dtQuote.RowCount--,1)
			'Get Tax 1 Amount
			f.Intrinsic.Control.If(v.DataTable.dtQuote(v.Local.i1).Tax_Apply_1!FieldValTrim,=,"Y")
				f.Intrinsic.String.Build("SELECT RATE FROM V_AR_TAX_TABLES WHERE ZONE = '{0}' AND AUTH = '{1}'",v.DataTable.dtQuote(v.Local.i1).Tax_Zone_1!FieldValTrim, v.DataTable.dtQuote(v.Local.i1).Tax_1!FieldValTrim, v.Local.sSQL)
				f.ODBC.Connection!con.ExecuteAndReturn(v.Local.sSQL,v.Local.fRate)
				f.Intrinsic.Math.Mult(v.DataTable.dtQuote(v.Local.i1).Extension!FieldValFloat,v.Local.fRate,v.Local.fTax)
				f.Intrinsic.Math.Round(v.Local.fTax,2,v.Local.fTax)
				f.Intrinsic.Math.Add(v.Local.fTotal, v.Local.fTax, v.Local.fTotal)
			f.Intrinsic.Control.EndIf
			
			'Get Tax 2 Amount
			f.Intrinsic.Control.If(v.DataTable.dtQuote(v.Local.i1).Tax_Apply_2!FieldValTrim,=,"Y")
				f.Intrinsic.String.Build("SELECT RATE FROM V_AR_TAX_TABLES WHERE ZONE = '{0}' AND AUTH = '{1}'",v.DataTable.dtQuote(v.Local.i1).Tax_Zone_2!FieldValTrim, v.DataTable.dtQuote(v.Local.i1).Tax_2!FieldValTrim, v.Local.sSQL)
				f.ODBC.Connection!con.ExecuteAndReturn(v.Local.sSQL,v.Local.fRate)
				f.Intrinsic.Math.Mult(v.DataTable.dtQuote(v.Local.i1).Extension!FieldValFloat,v.Local.fRate,v.Local.fTax)
				f.Intrinsic.Math.Round(v.Local.fTax,2,v.Local.fTax)
				f.Intrinsic.Math.Add(v.Local.fTotal, v.Local.fTax, v.Local.fTotal)
			f.Intrinsic.Control.EndIf
			
			'Get Tax 3 Amount
			f.Intrinsic.Control.If(v.DataTable.dtQuote(v.Local.i1).Tax_Apply_3!FieldValTrim,=,"Y")
				f.Intrinsic.String.Build("SELECT RATE FROM V_AR_TAX_TABLES WHERE ZONE = '{0}' AND AUTH = '{1}'",v.DataTable.dtQuote(v.Local.i1).Tax_Zone_3!FieldValTrim, v.DataTable.dtQuote(v.Local.i1).Tax_3!FieldValTrim, v.Local.sSQL)
				f.ODBC.Connection!con.ExecuteAndReturn(v.Local.sSQL,v.Local.fRate)
				f.Intrinsic.Math.Mult(v.DataTable.dtQuote(v.Local.i1).Extension!FieldValFloat,v.Local.fRate,v.Local.fTax)
				f.Intrinsic.Math.Round(v.Local.fTax,2,v.Local.fTax)
				f.Intrinsic.Math.Add(v.Local.fTotal, v.Local.fTax, v.Local.fTotal)
			f.Intrinsic.Control.EndIf
	
			'Get Tax 4 Amount
			f.Intrinsic.Control.If(v.DataTable.dtQuote(v.Local.i1).Tax_Apply_4!FieldValTrim,=,"Y")
				f.Intrinsic.String.Build("SELECT RATE FROM V_AR_TAX_TABLES WHERE ZONE = '{0}' AND AUTH = '{1}'",v.DataTable.dtQuote(v.Local.i1).Tax_Zone_4!FieldValTrim, v.DataTable.dtQuote(v.Local.i1).Tax_4!FieldValTrim, v.Local.sSQL)
				f.ODBC.Connection!con.ExecuteAndReturn(v.Local.sSQL,v.Local.fRate)
				f.Intrinsic.Math.Mult(v.DataTable.dtQuote(v.Local.i1).Extension!FieldValFloat,v.Local.fRate,v.Local.fTax)
				f.Intrinsic.Math.Round(v.Local.fTax,2,v.Local.fTax)
				f.Intrinsic.Math.Add(v.Local.fTotal, v.Local.fTax, v.Local.fTotal)
			f.Intrinsic.Control.EndIf
			
			'Get Tax 5 Amount
			f.Intrinsic.Control.If(v.DataTable.dtQuote(v.Local.i1).Tax_Apply_5!FieldValTrim,=,"Y")
				f.Intrinsic.String.Build("SELECT RATE FROM V_AR_TAX_TABLES WHERE ZONE = '{0}' AND AUTH = '{1}'",v.DataTable.dtQuote(v.Local.i1).Tax_Zone_5!FieldValTrim, v.DataTable.dtQuote(v.Local.i1).Tax_5!FieldValTrim, v.Local.sSQL)
				f.ODBC.Connection!con.ExecuteAndReturn(v.Local.sSQL,v.Local.fRate)
				f.Intrinsic.Math.Mult(v.DataTable.dtQuote(v.Local.i1).Extension!FieldValFloat,v.Local.fRate,v.Local.fTax)
				f.Intrinsic.Math.Round(v.Local.fTax,2,v.Local.fTax)
				f.Intrinsic.Math.Add(v.Local.fTotal, v.Local.fTax, v.Local.fTotal)
			f.Intrinsic.Control.EndIf
			
			'Get Tax 6 Amount
			f.Intrinsic.Control.If(v.DataTable.dtQuote(v.Local.i1).Tax_Apply_6!FieldValTrim,=,"Y")
				f.Intrinsic.String.Build("SELECT RATE FROM V_AR_TAX_TABLES WHERE ZONE = '{0}' AND AUTH = '{1}'",v.DataTable.dtQuote(v.Local.i1).Tax_Zone_6!FieldValTrim, v.DataTable.dtQuote(v.Local.i1).Tax_6!FieldValTrim, v.Local.sSQL)
				f.ODBC.Connection!con.ExecuteAndReturn(v.Local.sSQL,v.Local.fRate)
				f.Intrinsic.Math.Mult(v.DataTable.dtQuote(v.Local.i1).Extension!FieldValFloat,v.Local.fRate,v.Local.fTax)
				f.Intrinsic.Math.Round(v.Local.fTax,2,v.Local.fTax)
				f.Intrinsic.Math.Add(v.Local.fTotal, v.Local.fTax, v.Local.fTotal)
			f.Intrinsic.Control.EndIf
			
			'Get Tax 7 Amount
			f.Intrinsic.Control.If(v.DataTable.dtQuote(v.Local.i1).Tax_Apply_7!FieldValTrim,=,"Y")
				f.Intrinsic.String.Build("SELECT RATE FROM V_AR_TAX_TABLES WHERE ZONE = '{0}' AND AUTH = '{1}'",v.DataTable.dtQuote(v.Local.i1).Tax_Zone_7!FieldValTrim, v.DataTable.dtQuote(v.Local.i1).Tax_7!FieldValTrim, v.Local.sSQL)
				f.ODBC.Connection!con.ExecuteAndReturn(v.Local.sSQL,v.Local.fRate)
				f.Intrinsic.Math.Mult(v.DataTable.dtQuote(v.Local.i1).Extension!FieldValFloat,v.Local.fRate,v.Local.fTax)
				f.Intrinsic.Math.Round(v.Local.fTax,2,v.Local.fTax)
				f.Intrinsic.Math.Add(v.Local.fTotal, v.Local.fTax, v.Local.fTotal)
			f.Intrinsic.Control.EndIf
			
			'Get Tax 8 Amount
			f.Intrinsic.Control.If(v.DataTable.dtQuote(v.Local.i1).Tax_Apply_8!FieldValTrim,=,"Y")
				f.Intrinsic.String.Build("SELECT RATE FROM V_AR_TAX_TABLES WHERE ZONE = '{0}' AND AUTH = '{1}'",v.DataTable.dtQuote(v.Local.i1).Tax_Zone_8!FieldValTrim, v.DataTable.dtQuote(v.Local.i1).Tax_8!FieldValTrim, v.Local.sSQL)
				f.ODBC.Connection!con.ExecuteAndReturn(v.Local.sSQL,v.Local.fRate)
				f.Intrinsic.Math.Mult(v.DataTable.dtQuote(v.Local.i1).Extension!FieldValFloat,v.Local.fRate,v.Local.fTax)
				f.Intrinsic.Math.Round(v.Local.fTax,2,v.Local.fTax)
				f.Intrinsic.Math.Add(v.Local.fTotal, v.Local.fTax, v.Local.fTotal)
			f.Intrinsic.Control.EndIf
			
			'Get Tax 9 Amount
			f.Intrinsic.Control.If(v.DataTable.dtQuote(v.Local.i1).Tax_Apply_9!FieldValTrim,=,"Y")
				f.Intrinsic.String.Build("SELECT RATE FROM V_AR_TAX_TABLES WHERE ZONE = '{0}' AND AUTH = '{1}'",v.DataTable.dtQuote(v.Local.i1).Tax_Zone_9!FieldValTrim, v.DataTable.dtQuote(v.Local.i1).Tax_9!FieldValTrim, v.Local.sSQL)
				f.ODBC.Connection!con.ExecuteAndReturn(v.Local.sSQL,v.Local.fRate)
				f.Intrinsic.Math.Mult(v.DataTable.dtQuote(v.Local.i1).Extension!FieldValFloat,v.Local.fRate,v.Local.fTax)
				f.Intrinsic.Math.Round(v.Local.fTax,2,v.Local.fTax)
				f.Intrinsic.Math.Add(v.Local.fTotal, v.Local.fTax, v.Local.fTotal)
			f.Intrinsic.Control.EndIf
			
			'Get Tax 10 Amount
			f.Intrinsic.Control.If(v.DataTable.dtQuote(v.Local.i1).Tax_Apply_10!FieldValTrim,=,"Y")
				f.Intrinsic.String.Build("SELECT RATE FROM V_AR_TAX_TABLES WHERE ZONE = '{0}' AND AUTH = '{1}'",v.DataTable.dtQuote(v.Local.i1).Tax_Zone_10!FieldValTrim, v.DataTable.dtQuote(v.Local.i1).Tax_10!FieldValTrim, v.Local.sSQL)
				f.ODBC.Connection!con.ExecuteAndReturn(v.Local.sSQL,v.Local.fRate)
				f.Intrinsic.Math.Mult(v.DataTable.dtQuote(v.Local.i1).Extension!FieldValFloat,v.Local.fRate,v.Local.fTax)
				f.Intrinsic.Math.Round(v.Local.fTax,2,v.Local.fTax)
				f.Intrinsic.Math.Add(v.Local.fTotal, v.Local.fTax, v.Local.fTotal)
			f.Intrinsic.Control.EndIf
			
			f.Intrinsic.Math.Add(v.DataTable.dtQuote(v.Local.i1).Extension!FieldValFloat, v.Local.fTotal, v.Local.fTotal)
			
			'Write the QuoteLine information to file
			'Write the QuoteLine Column Title if it is the first line
			f.Intrinsic.Control.If(v.Local.i1,=,0)
				f.Intrinsic.String.Build("{0}#!#{1}",v.Global.sQuoteLineColumnTitle,v.Ambient.NewLine,v.Local.sFile)		
			f.Intrinsic.Control.EndIf
			
			f.Intrinsic.String.Build("{1}{0}{2}{0}{3}{0}{4}{0}{5}{0}{6}","*!*",v.Global.sQuote,v.DataTable.dtQuote(v.Local.i1).RECORD_NO!FieldValTrim,v.DataTable.dtQuote(v.Local.i1).PART!FieldValTrim,v.DataTable.dtQuote(v.Local.i1).QTY_QUOTED!FieldValFloat,v.DataTable.dtQuote(v.Local.i1).PRICE!FieldValFloat,v.DataTable.dtQuote(v.Local.i1).AMT_DISCOUNT!FieldValFloat,v.Local.sTempValue)
			f.Intrinsic.String.Build("{0}{1}{2}",v.Local.sFile,v.Local.sTempValue,v.Ambient.NewLine,v.Local.sFile)				
		f.Intrinsic.Control.Next(v.Local.i1)
		
		'Write the QuoteHeader information to file
		f.Intrinsic.String.Build("&!&{0}#!#{1}",v.Global.sQuoteHeaderColumnTitle,v.Ambient.NewLine,v.Local.sTempValue)		
		f.Intrinsic.String.Build("{0}{1}",v.Local.sFile,v.Local.sTempValue,v.Local.sFile)		
		f.Intrinsic.String.Build("{0}{1}*!*{2}",v.Local.sFile,v.Global.sQuote,v.Local.fTotal,v.Local.sFile)
		
	f.Intrinsic.Control.Else
		'Write the Empty QuoteLine information to file
		f.Intrinsic.String.Build("{0}#!#{1}{1}",v.Global.sQuoteLineColumnTitle,v.Ambient.NewLine,v.Local.sFile)
	
		'Write the QuoteHeader information to file
		f.Intrinsic.String.Build("&!&{0}#!#{1}",v.Global.sQuoteHeaderColumnTitle,v.Ambient.NewLine,v.Local.sTempValue)		
		f.Intrinsic.String.Build("{0}{1}",v.Local.sFile,v.Local.sTempValue,v.Local.sFile)		
		f.Intrinsic.String.Build("{0}{1}*!*{2}",v.Local.sFile,v.Global.sQuote,0,v.Local.sFile)
	f.Intrinsic.Control.EndIf
	
	f.Intrinsic.File.String2File(v.Local.sFileName,v.Local.sFile)
	f.Intrinsic.Control.If(v.DataTable.dtQuote.Exists)
		f.Data.DataTable.Close("dtQuote")
	f.Intrinsic.Control.EndIf
F.Intrinsic.Control.EndIf
'TDjohn - END       11/22/2022
Program.Sub.Hook10660.End

Program.Sub.Hook10920.Start
v.Local.sSQL.Declare
v.Local.sDate.Declare
v.Local.sFileName.Declare
v.Local.sFile.Declare
v.Local.fAmount.Declare
v.Local.sTemp.Declare
v.Local.i1.Declare
v.Local.fRate.Declare
v.Local.fTax.Declare
v.Local.fTotal.Declare
v.Local.fTotalCust.Declare
v.Local.sSplitString.Declare
v.Local.sQuoteHeader.Declare
v.Local.sQuoteHeaderInfo.Declare
v.Local.sQuoteLine.Declare
v.Local.sQuoteLineInfo.Declare
v.Local.bQuoteChanged.Declare
v.Local.sFilter.Declare
v.Local.sRet.Declare
v.Local.iRowIndex.Declare
v.Local.fMaxDiscPct.Declare
v.Local.fDiscPct.Declare
v.Local.fTotalAmtQuoteLine.Declare
v.Local.sCurrCo.Declare

f.Intrinsic.String.LPad(v.Passed.000003,"0",7,v.Global.sQuote)
f.Intrinsic.String.Build("SELECT * FROM GAB_6555_APRVL WHERE QUOTE_NO='{0}'",v.Global.sQuote,v.Local.sSQL)
f.ODBC.Connection!con.OpenLocalRecordsetRO("rstGAB",v.Local.sSQL)

f.Intrinsic.Control.If(v.ODBC.con!rstGAB.EOF,=,True)
'	f.Intrinsic.String.Build("SELECT A.CUSTOMER, B.DATE_QUOTE, B.DATE_DUE, A.RECORD_NO, A.PART, A.QTY_QUOTED, A.PRICE, A.AMT_DISCOUNT, A.Extension, A.Extension_Quote, A.Tax_1, A.Tax_2, A.Tax_3, A.Tax_4, A.Tax_5, A.Tax_6, A.Tax_7, A.Tax_8, A.Tax_9, A.Tax_10, A.Tax_Apply_1, A.Tax_Apply_2, A.Tax_Apply_3, A.Tax_Apply_4, A.Tax_Apply_5, A.Tax_Apply_6, A.Tax_Apply_7, A.Tax_Apply_8, A.Tax_Apply_9, A.Tax_Apply_10, A.Tax_Zone_1, A.Tax_Zone_2, A.Tax_Zone_3, A.Tax_Zone_4, A.Tax_Zone_5, A.Tax_Zone_6, A.Tax_Zone_7, A.Tax_Zone_8, A.Tax_Zone_9, A.Tax_Zone_10 FROM V_QUOTE_LINES A LEFT JOIN V_QUOTE_HEADER B ON A.QUOTE_NO = B.QUOTE_NO WHERE A.QUOTE_NO='{0}' order by A.QUOTE_NO, A.RECORD_NO;",v.Global.sQuote,v.Local.sSQL)
	f.Intrinsic.String.Build("SELECT A.QUOTE_CURR_CD, A.CUSTOMER, B.DATE_QUOTE, B.DATE_DUE, A.RECORD_NO, A.PART, A.QTY_QUOTED, A.PRICE, A.AMT_DISCOUNT, A.Extension, A.Extension_Quote, A.Tax_1, A.Tax_2, A.Tax_3, A.Tax_4, A.Tax_5, A.Tax_6, A.Tax_7, A.Tax_8, A.Tax_9, A.Tax_10, A.Tax_Apply_1, A.Tax_Apply_2, A.Tax_Apply_3, A.Tax_Apply_4, A.Tax_Apply_5, A.Tax_Apply_6, A.Tax_Apply_7, A.Tax_Apply_8, A.Tax_Apply_9, A.Tax_Apply_10, A.Tax_Zone_1, A.Tax_Zone_2, A.Tax_Zone_3, A.Tax_Zone_4, A.Tax_Zone_5, A.Tax_Zone_6, A.Tax_Zone_7, A.Tax_Zone_8, A.Tax_Zone_9, A.Tax_Zone_10 FROM V_QUOTE_LINES A LEFT JOIN V_QUOTE_HEADER B ON A.QUOTE_NO = B.QUOTE_NO WHERE A.QUOTE_NO='{0}' order by A.QUOTE_NO, A.RECORD_NO;",v.Global.sQuote,v.Local.sSQL)
	f.Data.DataTable.CreateFromSQL("dtQuote","con",v.Local.sSQL,True)
	
	'Get Base Currency
	F.Global.General.ReadOption("000000",1,"","0000",V.Local.sCurrCo)

	f.Intrinsic.Control.If(v.DataTable.dtQuote.RowCount,>,0)
		f.Intrinsic.Control.For(v.Local.i1,0,v.DataTable.dtQuote.RowCount--,1)
			'Get Tax 1 Amount
			f.Intrinsic.Control.If(v.DataTable.dtQuote(v.Local.i1).Tax_Apply_1!FieldValTrim,=,"Y")
				f.Intrinsic.String.Build("SELECT RATE FROM V_AR_TAX_TABLES WHERE ZONE = '{0}' AND AUTH = '{1}'",v.DataTable.dtQuote(v.Local.i1).Tax_Zone_1!FieldValTrim, v.DataTable.dtQuote(v.Local.i1).Tax_1!FieldValTrim, v.Local.sSQL)
				f.ODBC.Connection!con.ExecuteAndReturn(v.Local.sSQL,v.Local.fRate)
				f.Intrinsic.Math.Mult(v.DataTable.dtQuote(v.Local.i1).Extension!FieldValFloat,v.Local.fRate,v.Local.fTax)
				f.Intrinsic.Math.Round(v.Local.fTax,2,v.Local.fTax)
				f.Intrinsic.Math.Add(v.Local.fTotal, v.Local.fTax, v.Local.fTotal)
				f.Intrinsic.Math.Mult(v.DataTable.dtQuote(v.Local.i1).Extension_Quote!FieldValFloat,v.Local.fRate,v.Local.fTax)
				f.Intrinsic.Math.Round(v.Local.fTax,2,v.Local.fTax)
				f.Intrinsic.Math.Add(v.Local.fTotalCust, v.Local.fTax, v.Local.fTotalCust)			
			f.Intrinsic.Control.EndIf
			
			'Get Tax 2 Amount
			f.Intrinsic.Control.If(v.DataTable.dtQuote(v.Local.i1).Tax_Apply_2!FieldValTrim,=,"Y")
				f.Intrinsic.String.Build("SELECT RATE FROM V_AR_TAX_TABLES WHERE ZONE = '{0}' AND AUTH = '{1}'",v.DataTable.dtQuote(v.Local.i1).Tax_Zone_2!FieldValTrim, v.DataTable.dtQuote(v.Local.i1).Tax_2!FieldValTrim, v.Local.sSQL)
				f.ODBC.Connection!con.ExecuteAndReturn(v.Local.sSQL,v.Local.fRate)
				f.Intrinsic.Math.Mult(v.DataTable.dtQuote(v.Local.i1).Extension!FieldValFloat,v.Local.fRate,v.Local.fTax)
				f.Intrinsic.Math.Round(v.Local.fTax,2,v.Local.fTax)
				f.Intrinsic.Math.Add(v.Local.fTotal, v.Local.fTax, v.Local.fTotal)
				f.Intrinsic.Math.Mult(v.DataTable.dtQuote(v.Local.i1).Extension_Quote!FieldValFloat,v.Local.fRate,v.Local.fTax)
				f.Intrinsic.Math.Round(v.Local.fTax,2,v.Local.fTax)
				f.Intrinsic.Math.Add(v.Local.fTotalCust, v.Local.fTax, v.Local.fTotalCust)			
			f.Intrinsic.Control.EndIf
			
			'Get Tax 3 Amount
			f.Intrinsic.Control.If(v.DataTable.dtQuote(v.Local.i1).Tax_Apply_3!FieldValTrim,=,"Y")
				f.Intrinsic.String.Build("SELECT RATE FROM V_AR_TAX_TABLES WHERE ZONE = '{0}' AND AUTH = '{1}'",v.DataTable.dtQuote(v.Local.i1).Tax_Zone_3!FieldValTrim, v.DataTable.dtQuote(v.Local.i1).Tax_3!FieldValTrim, v.Local.sSQL)
				f.ODBC.Connection!con.ExecuteAndReturn(v.Local.sSQL,v.Local.fRate)
				f.Intrinsic.Math.Mult(v.DataTable.dtQuote(v.Local.i1).Extension!FieldValFloat,v.Local.fRate,v.Local.fTax)
				f.Intrinsic.Math.Round(v.Local.fTax,2,v.Local.fTax)
				f.Intrinsic.Math.Add(v.Local.fTotal, v.Local.fTax, v.Local.fTotal)
				f.Intrinsic.Math.Mult(v.DataTable.dtQuote(v.Local.i1).Extension_Quote!FieldValFloat,v.Local.fRate,v.Local.fTax)
				f.Intrinsic.Math.Round(v.Local.fTax,2,v.Local.fTax)
				f.Intrinsic.Math.Add(v.Local.fTotalCust, v.Local.fTax, v.Local.fTotalCust)			
			f.Intrinsic.Control.EndIf
	
			'Get Tax 4 Amount
			f.Intrinsic.Control.If(v.DataTable.dtQuote(v.Local.i1).Tax_Apply_4!FieldValTrim,=,"Y")
				f.Intrinsic.String.Build("SELECT RATE FROM V_AR_TAX_TABLES WHERE ZONE = '{0}' AND AUTH = '{1}'",v.DataTable.dtQuote(v.Local.i1).Tax_Zone_4!FieldValTrim, v.DataTable.dtQuote(v.Local.i1).Tax_4!FieldValTrim, v.Local.sSQL)
				f.ODBC.Connection!con.ExecuteAndReturn(v.Local.sSQL,v.Local.fRate)
				f.Intrinsic.Math.Mult(v.DataTable.dtQuote(v.Local.i1).Extension!FieldValFloat,v.Local.fRate,v.Local.fTax)
				f.Intrinsic.Math.Round(v.Local.fTax,2,v.Local.fTax)
				f.Intrinsic.Math.Add(v.Local.fTotal, v.Local.fTax, v.Local.fTotal)
				f.Intrinsic.Math.Mult(v.DataTable.dtQuote(v.Local.i1).Extension_Quote!FieldValFloat,v.Local.fRate,v.Local.fTax)
				f.Intrinsic.Math.Round(v.Local.fTax,2,v.Local.fTax)
				f.Intrinsic.Math.Add(v.Local.fTotalCust, v.Local.fTax, v.Local.fTotalCust)			
			f.Intrinsic.Control.EndIf
			
			'Get Tax 5 Amount
			f.Intrinsic.Control.If(v.DataTable.dtQuote(v.Local.i1).Tax_Apply_5!FieldValTrim,=,"Y")
				f.Intrinsic.String.Build("SELECT RATE FROM V_AR_TAX_TABLES WHERE ZONE = '{0}' AND AUTH = '{1}'",v.DataTable.dtQuote(v.Local.i1).Tax_Zone_5!FieldValTrim, v.DataTable.dtQuote(v.Local.i1).Tax_5!FieldValTrim, v.Local.sSQL)
				f.ODBC.Connection!con.ExecuteAndReturn(v.Local.sSQL,v.Local.fRate)
				f.Intrinsic.Math.Mult(v.DataTable.dtQuote(v.Local.i1).Extension!FieldValFloat,v.Local.fRate,v.Local.fTax)
				f.Intrinsic.Math.Round(v.Local.fTax,2,v.Local.fTax)
				f.Intrinsic.Math.Add(v.Local.fTotal, v.Local.fTax, v.Local.fTotal)
				f.Intrinsic.Math.Mult(v.DataTable.dtQuote(v.Local.i1).Extension_Quote!FieldValFloat,v.Local.fRate,v.Local.fTax)
				f.Intrinsic.Math.Round(v.Local.fTax,2,v.Local.fTax)
				f.Intrinsic.Math.Add(v.Local.fTotalCust, v.Local.fTax, v.Local.fTotalCust)			
			f.Intrinsic.Control.EndIf
			
			'Get Tax 6 Amount
			f.Intrinsic.Control.If(v.DataTable.dtQuote(v.Local.i1).Tax_Apply_6!FieldValTrim,=,"Y")
				f.Intrinsic.String.Build("SELECT RATE FROM V_AR_TAX_TABLES WHERE ZONE = '{0}' AND AUTH = '{1}'",v.DataTable.dtQuote(v.Local.i1).Tax_Zone_6!FieldValTrim, v.DataTable.dtQuote(v.Local.i1).Tax_6!FieldValTrim, v.Local.sSQL)
				f.ODBC.Connection!con.ExecuteAndReturn(v.Local.sSQL,v.Local.fRate)
				f.Intrinsic.Math.Mult(v.DataTable.dtQuote(v.Local.i1).Extension!FieldValFloat,v.Local.fRate,v.Local.fTax)
				f.Intrinsic.Math.Round(v.Local.fTax,2,v.Local.fTax)
				f.Intrinsic.Math.Add(v.Local.fTotal, v.Local.fTax, v.Local.fTotal)
				f.Intrinsic.Math.Mult(v.DataTable.dtQuote(v.Local.i1).Extension_Quote!FieldValFloat,v.Local.fRate,v.Local.fTax)
				f.Intrinsic.Math.Round(v.Local.fTax,2,v.Local.fTax)
				f.Intrinsic.Math.Add(v.Local.fTotalCust, v.Local.fTax, v.Local.fTotalCust)			
			f.Intrinsic.Control.EndIf
			
			'Get Tax 7 Amount
			f.Intrinsic.Control.If(v.DataTable.dtQuote(v.Local.i1).Tax_Apply_7!FieldValTrim,=,"Y")
				f.Intrinsic.String.Build("SELECT RATE FROM V_AR_TAX_TABLES WHERE ZONE = '{0}' AND AUTH = '{1}'",v.DataTable.dtQuote(v.Local.i1).Tax_Zone_7!FieldValTrim, v.DataTable.dtQuote(v.Local.i1).Tax_7!FieldValTrim, v.Local.sSQL)
				f.ODBC.Connection!con.ExecuteAndReturn(v.Local.sSQL,v.Local.fRate)
				f.Intrinsic.Math.Mult(v.DataTable.dtQuote(v.Local.i1).Extension!FieldValFloat,v.Local.fRate,v.Local.fTax)
				f.Intrinsic.Math.Round(v.Local.fTax,2,v.Local.fTax)
				f.Intrinsic.Math.Add(v.Local.fTotal, v.Local.fTax, v.Local.fTotal)
				f.Intrinsic.Math.Mult(v.DataTable.dtQuote(v.Local.i1).Extension_Quote!FieldValFloat,v.Local.fRate,v.Local.fTax)
				f.Intrinsic.Math.Round(v.Local.fTax,2,v.Local.fTax)
				f.Intrinsic.Math.Add(v.Local.fTotalCust, v.Local.fTax, v.Local.fTotalCust)			
			f.Intrinsic.Control.EndIf
			
			'Get Tax 8 Amount
			f.Intrinsic.Control.If(v.DataTable.dtQuote(v.Local.i1).Tax_Apply_8!FieldValTrim,=,"Y")
				f.Intrinsic.String.Build("SELECT RATE FROM V_AR_TAX_TABLES WHERE ZONE = '{0}' AND AUTH = '{1}'",v.DataTable.dtQuote(v.Local.i1).Tax_Zone_8!FieldValTrim, v.DataTable.dtQuote(v.Local.i1).Tax_8!FieldValTrim, v.Local.sSQL)
				f.ODBC.Connection!con.ExecuteAndReturn(v.Local.sSQL,v.Local.fRate)
				f.Intrinsic.Math.Mult(v.DataTable.dtQuote(v.Local.i1).Extension!FieldValFloat,v.Local.fRate,v.Local.fTax)
				f.Intrinsic.Math.Round(v.Local.fTax,2,v.Local.fTax)
				f.Intrinsic.Math.Add(v.Local.fTotal, v.Local.fTax, v.Local.fTotal)
				f.Intrinsic.Math.Mult(v.DataTable.dtQuote(v.Local.i1).Extension_Quote!FieldValFloat,v.Local.fRate,v.Local.fTax)
				f.Intrinsic.Math.Round(v.Local.fTax,2,v.Local.fTax)
				f.Intrinsic.Math.Add(v.Local.fTotalCust, v.Local.fTax, v.Local.fTotalCust)			
			f.Intrinsic.Control.EndIf
			
			'Get Tax 9 Amount
			f.Intrinsic.Control.If(v.DataTable.dtQuote(v.Local.i1).Tax_Apply_9!FieldValTrim,=,"Y")
				f.Intrinsic.String.Build("SELECT RATE FROM V_AR_TAX_TABLES WHERE ZONE = '{0}' AND AUTH = '{1}'",v.DataTable.dtQuote(v.Local.i1).Tax_Zone_9!FieldValTrim, v.DataTable.dtQuote(v.Local.i1).Tax_9!FieldValTrim, v.Local.sSQL)
				f.ODBC.Connection!con.ExecuteAndReturn(v.Local.sSQL,v.Local.fRate)
				f.Intrinsic.Math.Mult(v.DataTable.dtQuote(v.Local.i1).Extension!FieldValFloat,v.Local.fRate,v.Local.fTax)
				f.Intrinsic.Math.Round(v.Local.fTax,2,v.Local.fTax)
				f.Intrinsic.Math.Add(v.Local.fTotal, v.Local.fTax, v.Local.fTotal)
				f.Intrinsic.Math.Mult(v.DataTable.dtQuote(v.Local.i1).Extension_Quote!FieldValFloat,v.Local.fRate,v.Local.fTax)
				f.Intrinsic.Math.Round(v.Local.fTax,2,v.Local.fTax)
				f.Intrinsic.Math.Add(v.Local.fTotalCust, v.Local.fTax, v.Local.fTotalCust)			
			f.Intrinsic.Control.EndIf
			
			'Get Tax 10 Amount
			f.Intrinsic.Control.If(v.DataTable.dtQuote(v.Local.i1).Tax_Apply_10!FieldValTrim,=,"Y")
				f.Intrinsic.String.Build("SELECT RATE FROM V_AR_TAX_TABLES WHERE ZONE = '{0}' AND AUTH = '{1}'",v.DataTable.dtQuote(v.Local.i1).Tax_Zone_10!FieldValTrim, v.DataTable.dtQuote(v.Local.i1).Tax_10!FieldValTrim, v.Local.sSQL)
				f.ODBC.Connection!con.ExecuteAndReturn(v.Local.sSQL,v.Local.fRate)
				f.Intrinsic.Math.Mult(v.DataTable.dtQuote(v.Local.i1).Extension!FieldValFloat,v.Local.fRate,v.Local.fTax)
				f.Intrinsic.Math.Round(v.Local.fTax,2,v.Local.fTax)
				f.Intrinsic.Math.Add(v.Local.fTotal, v.Local.fTax, v.Local.fTotal)
				f.Intrinsic.Math.Mult(v.DataTable.dtQuote(v.Local.i1).Extension_Quote!FieldValFloat,v.Local.fRate,v.Local.fTax)
				f.Intrinsic.Math.Round(v.Local.fTax,2,v.Local.fTax)
				f.Intrinsic.Math.Add(v.Local.fTotalCust, v.Local.fTax, v.Local.fTotalCust)			
			f.Intrinsic.Control.EndIf
					
			f.Intrinsic.Math.Add(v.DataTable.dtQuote(v.Local.i1).Extension!FieldValFloat, v.Local.fTotal, v.Local.fTotal)
			f.Intrinsic.Control.If(v.DataTable.dtQuote(v.Local.i1).QUOTE_CURR_CD!FieldValTrim,=,v.Local.sCurrCo)
				v.Local.fTotalCust.Set(0.00)
			f.Intrinsic.Control.Else
				f.Intrinsic.Math.Add(v.DataTable.dtQuote(v.Local.i1).Extension_Quote!FieldValFloat, v.Local.fTotalCust, v.Local.fTotalCust)		
			f.Intrinsic.Control.EndIf
			
			'Calculate the Disc Pct for the Quote Line
			'Set it as the Max Disc Pct for the Quote if it is greater than the Max Disc Pct
			f.Intrinsic.Math.Mult(v.DataTable.dtQuote(v.Local.i1).QTY_QUOTED!FieldValFloat,v.DataTable.dtQuote(v.Local.i1).PRICE!FieldValFloat,v.Local.fTotalAmtQuoteLine)
			f.Intrinsic.Control.If(v.Local.fTotalAmtQuoteLine,>,0)
				f.Intrinsic.Math.Div(v.DataTable.dtQuote(v.Local.i1).AMT_DISCOUNT!FieldValFloat,v.Local.fTotalAmtQuoteLine,v.Local.fDiscPct)
				f.Intrinsic.Math.Round(v.Local.fDiscPct,4,v.Local.fDiscPct)
				f.Intrinsic.Math.Abs(v.Local.fDiscPct,v.Local.fDiscPct)
				f.Intrinsic.Control.If(v.Local.fMaxDiscPct,<,v.Local.fDiscPct)
					v.Local.fMaxDiscPct.Set(v.Local.fDiscPct)
				f.Intrinsic.Control.EndIf
			f.Intrinsic.Control.EndIf
			
		f.Intrinsic.Control.Next(v.Local.i1)
		
		f.Intrinsic.Control.If(v.Local.fMaxDiscPct,=,0)
			'Automatically approved the Quote because there is no Discount in the Quote lines
			f.Intrinsic.String.Build("insert into GAB_6555_APRVL(QUOTE_NO, DATE_QUOTE, CUSTOMER, CUST_AMOUNT, AMOUNT, MAX_DISCOUNT, DATE_DUE, ORIGINATOR, APPROVER, APPROVED_DATE) values('{0}', '{1}', '{2}', {3}, {4}, {5}, '{6}', '{7}', 'SYSTEM', NOW());",v.Global.sQuote, v.DataTable.dtQuote(0).Date_Quote!FieldValPervasiveDate, v.DataTable.dtQuote(0).Customer!FieldValTrim, v.Local.fTotalCust, v.Local.fTotal, v.Local.fMaxDiscPct, v.DataTable.dtQuote(0).Date_Due!FieldValPervasiveDate, v.Caller.User.Trim,  v.Local.sSQL)
		f.Intrinsic.Control.Else
			f.Intrinsic.String.Build("insert into GAB_6555_APRVL(QUOTE_NO, DATE_QUOTE, CUSTOMER, CUST_AMOUNT, AMOUNT, MAX_DISCOUNT, DATE_DUE, ORIGINATOR) values('{0}', '{1}', '{2}', {3}, {4}, {5}, '{6}', '{7}');",v.Global.sQuote, v.DataTable.dtQuote(0).Date_Quote!FieldValPervasiveDate, v.DataTable.dtQuote(0).Customer!FieldValTrim, v.Local.fTotalCust, v.Local.fTotal, v.Local.fMaxDiscPct, v.DataTable.dtQuote(0).Date_Due!FieldValPervasiveDate, v.Caller.User.Trim, v.Local.sSQL)
			'Send email to approvers
			f.Intrinsic.Control.CallSub(SendEmail,"Customer",v.DataTable.dtQuote(0).Customer!FieldValTrim,"MaxDiscPct",v.Local.fMaxDiscPct)
		f.Intrinsic.Control.EndIf
		f.ODBC.Connection!con.Execute(v.Local.sSQL)
	f.Intrinsic.Control.EndIf
f.Intrinsic.Control.EndIf
f.ODBC.Connection!con.CloseRecordsets("rstGAB")

f.Intrinsic.Control.If(v.DataTable.dtQuote.Exists)
	f.Data.DataTable.Close("dtQuote")
f.Intrinsic.Control.EndIf
Program.Sub.Hook10920.End

Program.Sub.Hook10721.Start
v.Local.sSQL.Declare
v.Local.sDate.Declare
v.Local.sFileName.Declare
v.Local.sFile.Declare
v.Local.bExists.Declare
v.Local.i1.Declare
v.Local.fRate.Declare
v.Local.fTax.Declare
v.Local.fTotal.Declare
v.Local.sTempValue.Declare

'TDjohan - Begin      11/22/2022
f.Intrinsic.String.Format(v.Ambient.Date,"YYYYMMDD",v.Local.sDate)
f.Intrinsic.String.Concat(v.System.Temp,"\GSS\GAB_6555_",v.Caller.User.Trim,"_",v.Local.sDate,".txt",v.Local.sFileName)
v.Local.sFile.Set("")

f.Intrinsic.File.Exists(v.Local.sFileName,v.Local.bExists)
f.Intrinsic.Control.If(v.Local.bExists,=,True)
	f.Intrinsic.File.DeleteFile(v.Local.sFileName)
f.Intrinsic.Control.EndIf
'TDjohan - End      11/22/2022

f.Intrinsic.String.LPad(v.Passed.000003,"0",7,v.Global.sQuote)
f.Intrinsic.String.Build("SELECT * FROM GAB_6555_APRVL WHERE QUOTE_NO='{0}'",v.Global.sQuote,v.Local.sSQL)
f.ODBC.Connection!con.OpenLocalRecordsetRO("rstGAB",v.Local.sSQL)

f.Intrinsic.Control.If(v.ODBC.con!rstGAB.EOF,=,False)
	f.Intrinsic.Control.If(v.ODBC.con!rstGAB.FieldValTrim!Approver,=,"")
'		f.Intrinsic.UI.Msgbox("Please approve this Quote first.","Quote Approval (6555)")
		v.Passed.777777.Set(1)
		f.Intrinsic.UI.ChangeCallerProperty(v.Passed.000079,"HIDE",1)
		f.Intrinsic.UI.ChangeCallerProperty(v.Passed.000080,"HIDE",1)
		f.Intrinsic.UI.ChangeCallerProperty(v.Passed.000110,"HIDE",1)
		v.Passed.GAB-TEXT-1.Set("")
		v.Passed.GAB-TEXT-2.Set("")
	f.Intrinsic.Control.Else
		f.Intrinsic.Control.If(v.ODBC.con!rstGAB.FieldValTrim!Approver,<>,"*REJECT*")
		f.Intrinsic.Control.AndIf(v.ODBC.con!rstGAB.FieldValTrim!Approver,<>,"*REVISE*")
			f.Intrinsic.UI.ChangeCallerProperty(v.Passed.000079,"HIDE",0)
			f.Intrinsic.UI.ChangeCallerProperty(v.Passed.000080,"HIDE",0)
			f.Intrinsic.UI.ChangeCallerProperty(v.Passed.000110,"HIDE",0)
			v.Passed.GAB-TEXT-1.Set(v.ODBC.con!rstGAB.FieldValTrim!Approver)
			F.Intrinsic.String.Format(V.ODBC.con!rstGAB.FieldValPervasiveDate!approved_date,"D MMM YYYY",V.Local.sDate)
			v.Passed.GAB-TEXT-2.Set(v.Local.sDate)
		f.Intrinsic.Control.Else
'			f.Intrinsic.UI.Msgbox("Please approve this Quote first.","Quote Approval (6555)")
			v.Passed.777777.Set(1)
			f.Intrinsic.UI.ChangeCallerProperty(v.Passed.000079,"HIDE",1)
			f.Intrinsic.UI.ChangeCallerProperty(v.Passed.000080,"HIDE",1)
			f.Intrinsic.UI.ChangeCallerProperty(v.Passed.000110,"HIDE",1)
			v.Passed.GAB-TEXT-1.Set("")
			v.Passed.GAB-TEXT-2.Set("")
		f.Intrinsic.Control.EndIf
	f.Intrinsic.Control.EndIf
f.Intrinsic.Control.Else
'	f.Intrinsic.UI.Msgbox("This Quote is not found in Quote Approval. Please open this Quote thru Estimating/Routing > Files > Quote > Open, hit Line buton and close the line screen. And then please approve this Quote by approver.","Quote Approval (6555)")
	v.Passed.777777.Set(1)
	f.Intrinsic.UI.ChangeCallerProperty(v.Passed.000079,"HIDE",1)
	f.Intrinsic.UI.ChangeCallerProperty(v.Passed.000080,"HIDE",1)
	f.Intrinsic.UI.ChangeCallerProperty(v.Passed.000110,"HIDE",1)
	v.Passed.GAB-TEXT-1.Set("")
	v.Passed.GAB-TEXT-2.Set("")
f.Intrinsic.Control.EndIf
f.ODBC.Connection!con.CloseRecordsets("rstGAB")

'TDjohan - Begin      11/22/2022
f.Intrinsic.Control.If(v.DataTable.dtQuote.Exists)
	f.Data.DataTable.Close("dtQuote")
f.Intrinsic.Control.EndIf

f.Intrinsic.String.Build("SELECT A.CUSTOMER, B.DATE_QUOTE, B.DATE_DUE, A.RECORD_NO, A.PART, A.QTY_QUOTED, A.PRICE, A.AMT_DISCOUNT, A.Extension, A.Extension_Quote, A.Tax_1, A.Tax_2, A.Tax_3, A.Tax_4, A.Tax_5, A.Tax_6, A.Tax_7, A.Tax_8, A.Tax_9, A.Tax_10, A.Tax_Apply_1, A.Tax_Apply_2, A.Tax_Apply_3, A.Tax_Apply_4, A.Tax_Apply_5, A.Tax_Apply_6, A.Tax_Apply_7, A.Tax_Apply_8, A.Tax_Apply_9, A.Tax_Apply_10, A.Tax_Zone_1, A.Tax_Zone_2, A.Tax_Zone_3, A.Tax_Zone_4, A.Tax_Zone_5, A.Tax_Zone_6, A.Tax_Zone_7, A.Tax_Zone_8, A.Tax_Zone_9, A.Tax_Zone_10 FROM V_QUOTE_LINES A LEFT JOIN V_QUOTE_HEADER B ON A.QUOTE_NO = B.QUOTE_NO WHERE A.QUOTE_NO='{0}' ORDER BY A.QUOTE_NO, A.RECORD_NO;",v.Global.sQuote,v.Local.sSQL)
f.Data.DataTable.CreateFromSQL("dtQuote","con",v.Local.sSQL,True)
f.Intrinsic.Control.If(v.DataTable.dtQuote.RowCount,>,0)
	f.Intrinsic.Control.For(v.Local.i1,0,v.DataTable.dtQuote.RowCount--,1)
		'Get Tax 1 Amount
		f.Intrinsic.Control.If(v.DataTable.dtQuote(v.Local.i1).Tax_Apply_1!FieldValTrim,=,"Y")
			f.Intrinsic.String.Build("SELECT RATE FROM V_AR_TAX_TABLES WHERE ZONE = '{0}' AND AUTH = '{1}'",v.DataTable.dtQuote(v.Local.i1).Tax_Zone_1!FieldValTrim, v.DataTable.dtQuote(v.Local.i1).Tax_1!FieldValTrim, v.Local.sSQL)
			f.ODBC.Connection!con.ExecuteAndReturn(v.Local.sSQL,v.Local.fRate)
			f.Intrinsic.Math.Mult(v.DataTable.dtQuote(v.Local.i1).Extension!FieldValFloat,v.Local.fRate,v.Local.fTax)
			f.Intrinsic.Math.Round(v.Local.fTax,2,v.Local.fTax)
			f.Intrinsic.Math.Add(v.Local.fTotal, v.Local.fTax, v.Local.fTotal)
		f.Intrinsic.Control.EndIf
		
		'Get Tax 2 Amount
		f.Intrinsic.Control.If(v.DataTable.dtQuote(v.Local.i1).Tax_Apply_2!FieldValTrim,=,"Y")
			f.Intrinsic.String.Build("SELECT RATE FROM V_AR_TAX_TABLES WHERE ZONE = '{0}' AND AUTH = '{1}'",v.DataTable.dtQuote(v.Local.i1).Tax_Zone_2!FieldValTrim, v.DataTable.dtQuote(v.Local.i1).Tax_2!FieldValTrim, v.Local.sSQL)
			f.ODBC.Connection!con.ExecuteAndReturn(v.Local.sSQL,v.Local.fRate)
			f.Intrinsic.Math.Mult(v.DataTable.dtQuote(v.Local.i1).Extension!FieldValFloat,v.Local.fRate,v.Local.fTax)
			f.Intrinsic.Math.Round(v.Local.fTax,2,v.Local.fTax)
			f.Intrinsic.Math.Add(v.Local.fTotal, v.Local.fTax, v.Local.fTotal)
		f.Intrinsic.Control.EndIf
		
		'Get Tax 3 Amount
		f.Intrinsic.Control.If(v.DataTable.dtQuote(v.Local.i1).Tax_Apply_3!FieldValTrim,=,"Y")
			f.Intrinsic.String.Build("SELECT RATE FROM V_AR_TAX_TABLES WHERE ZONE = '{0}' AND AUTH = '{1}'",v.DataTable.dtQuote(v.Local.i1).Tax_Zone_3!FieldValTrim, v.DataTable.dtQuote(v.Local.i1).Tax_3!FieldValTrim, v.Local.sSQL)
			f.ODBC.Connection!con.ExecuteAndReturn(v.Local.sSQL,v.Local.fRate)
			f.Intrinsic.Math.Mult(v.DataTable.dtQuote(v.Local.i1).Extension!FieldValFloat,v.Local.fRate,v.Local.fTax)
			f.Intrinsic.Math.Round(v.Local.fTax,2,v.Local.fTax)
			f.Intrinsic.Math.Add(v.Local.fTotal, v.Local.fTax, v.Local.fTotal)
		f.Intrinsic.Control.EndIf

		'Get Tax 4 Amount
		f.Intrinsic.Control.If(v.DataTable.dtQuote(v.Local.i1).Tax_Apply_4!FieldValTrim,=,"Y")
			f.Intrinsic.String.Build("SELECT RATE FROM V_AR_TAX_TABLES WHERE ZONE = '{0}' AND AUTH = '{1}'",v.DataTable.dtQuote(v.Local.i1).Tax_Zone_4!FieldValTrim, v.DataTable.dtQuote(v.Local.i1).Tax_4!FieldValTrim, v.Local.sSQL)
			f.ODBC.Connection!con.ExecuteAndReturn(v.Local.sSQL,v.Local.fRate)
			f.Intrinsic.Math.Mult(v.DataTable.dtQuote(v.Local.i1).Extension!FieldValFloat,v.Local.fRate,v.Local.fTax)
			f.Intrinsic.Math.Round(v.Local.fTax,2,v.Local.fTax)
			f.Intrinsic.Math.Add(v.Local.fTotal, v.Local.fTax, v.Local.fTotal)
		f.Intrinsic.Control.EndIf
		
		'Get Tax 5 Amount
		f.Intrinsic.Control.If(v.DataTable.dtQuote(v.Local.i1).Tax_Apply_5!FieldValTrim,=,"Y")
			f.Intrinsic.String.Build("SELECT RATE FROM V_AR_TAX_TABLES WHERE ZONE = '{0}' AND AUTH = '{1}'",v.DataTable.dtQuote(v.Local.i1).Tax_Zone_5!FieldValTrim, v.DataTable.dtQuote(v.Local.i1).Tax_5!FieldValTrim, v.Local.sSQL)
			f.ODBC.Connection!con.ExecuteAndReturn(v.Local.sSQL,v.Local.fRate)
			f.Intrinsic.Math.Mult(v.DataTable.dtQuote(v.Local.i1).Extension!FieldValFloat,v.Local.fRate,v.Local.fTax)
			f.Intrinsic.Math.Round(v.Local.fTax,2,v.Local.fTax)
			f.Intrinsic.Math.Add(v.Local.fTotal, v.Local.fTax, v.Local.fTotal)
		f.Intrinsic.Control.EndIf
		
		'Get Tax 6 Amount
		f.Intrinsic.Control.If(v.DataTable.dtQuote(v.Local.i1).Tax_Apply_6!FieldValTrim,=,"Y")
			f.Intrinsic.String.Build("SELECT RATE FROM V_AR_TAX_TABLES WHERE ZONE = '{0}' AND AUTH = '{1}'",v.DataTable.dtQuote(v.Local.i1).Tax_Zone_6!FieldValTrim, v.DataTable.dtQuote(v.Local.i1).Tax_6!FieldValTrim, v.Local.sSQL)
			f.ODBC.Connection!con.ExecuteAndReturn(v.Local.sSQL,v.Local.fRate)
			f.Intrinsic.Math.Mult(v.DataTable.dtQuote(v.Local.i1).Extension!FieldValFloat,v.Local.fRate,v.Local.fTax)
			f.Intrinsic.Math.Round(v.Local.fTax,2,v.Local.fTax)
			f.Intrinsic.Math.Add(v.Local.fTotal, v.Local.fTax, v.Local.fTotal)
		f.Intrinsic.Control.EndIf
		
		'Get Tax 7 Amount
		f.Intrinsic.Control.If(v.DataTable.dtQuote(v.Local.i1).Tax_Apply_7!FieldValTrim,=,"Y")
			f.Intrinsic.String.Build("SELECT RATE FROM V_AR_TAX_TABLES WHERE ZONE = '{0}' AND AUTH = '{1}'",v.DataTable.dtQuote(v.Local.i1).Tax_Zone_7!FieldValTrim, v.DataTable.dtQuote(v.Local.i1).Tax_7!FieldValTrim, v.Local.sSQL)
			f.ODBC.Connection!con.ExecuteAndReturn(v.Local.sSQL,v.Local.fRate)
			f.Intrinsic.Math.Mult(v.DataTable.dtQuote(v.Local.i1).Extension!FieldValFloat,v.Local.fRate,v.Local.fTax)
			f.Intrinsic.Math.Round(v.Local.fTax,2,v.Local.fTax)
			f.Intrinsic.Math.Add(v.Local.fTotal, v.Local.fTax, v.Local.fTotal)
		f.Intrinsic.Control.EndIf
		
		'Get Tax 8 Amount
		f.Intrinsic.Control.If(v.DataTable.dtQuote(v.Local.i1).Tax_Apply_8!FieldValTrim,=,"Y")
			f.Intrinsic.String.Build("SELECT RATE FROM V_AR_TAX_TABLES WHERE ZONE = '{0}' AND AUTH = '{1}'",v.DataTable.dtQuote(v.Local.i1).Tax_Zone_8!FieldValTrim, v.DataTable.dtQuote(v.Local.i1).Tax_8!FieldValTrim, v.Local.sSQL)
			f.ODBC.Connection!con.ExecuteAndReturn(v.Local.sSQL,v.Local.fRate)
			f.Intrinsic.Math.Mult(v.DataTable.dtQuote(v.Local.i1).Extension!FieldValFloat,v.Local.fRate,v.Local.fTax)
			f.Intrinsic.Math.Round(v.Local.fTax,2,v.Local.fTax)
			f.Intrinsic.Math.Add(v.Local.fTotal, v.Local.fTax, v.Local.fTotal)
		f.Intrinsic.Control.EndIf
		
		'Get Tax 9 Amount
		f.Intrinsic.Control.If(v.DataTable.dtQuote(v.Local.i1).Tax_Apply_9!FieldValTrim,=,"Y")
			f.Intrinsic.String.Build("SELECT RATE FROM V_AR_TAX_TABLES WHERE ZONE = '{0}' AND AUTH = '{1}'",v.DataTable.dtQuote(v.Local.i1).Tax_Zone_9!FieldValTrim, v.DataTable.dtQuote(v.Local.i1).Tax_9!FieldValTrim, v.Local.sSQL)
			f.ODBC.Connection!con.ExecuteAndReturn(v.Local.sSQL,v.Local.fRate)
			f.Intrinsic.Math.Mult(v.DataTable.dtQuote(v.Local.i1).Extension!FieldValFloat,v.Local.fRate,v.Local.fTax)
			f.Intrinsic.Math.Round(v.Local.fTax,2,v.Local.fTax)
			f.Intrinsic.Math.Add(v.Local.fTotal, v.Local.fTax, v.Local.fTotal)
		f.Intrinsic.Control.EndIf
		
		'Get Tax 10 Amount
		f.Intrinsic.Control.If(v.DataTable.dtQuote(v.Local.i1).Tax_Apply_10!FieldValTrim,=,"Y")
			f.Intrinsic.String.Build("SELECT RATE FROM V_AR_TAX_TABLES WHERE ZONE = '{0}' AND AUTH = '{1}'",v.DataTable.dtQuote(v.Local.i1).Tax_Zone_10!FieldValTrim, v.DataTable.dtQuote(v.Local.i1).Tax_10!FieldValTrim, v.Local.sSQL)
			f.ODBC.Connection!con.ExecuteAndReturn(v.Local.sSQL,v.Local.fRate)
			f.Intrinsic.Math.Mult(v.DataTable.dtQuote(v.Local.i1).Extension!FieldValFloat,v.Local.fRate,v.Local.fTax)
			f.Intrinsic.Math.Round(v.Local.fTax,2,v.Local.fTax)
			f.Intrinsic.Math.Add(v.Local.fTotal, v.Local.fTax, v.Local.fTotal)
		f.Intrinsic.Control.EndIf
		
		f.Intrinsic.Math.Add(v.DataTable.dtQuote(v.Local.i1).Extension!FieldValFloat, v.Local.fTotal, v.Local.fTotal)
		
		'Write the QuoteLine information to file
		'Write the QuoteLine Column Title if it is the first line
		f.Intrinsic.Control.If(v.Local.i1,=,0)
			f.Intrinsic.String.Build("{0}#!#{1}",v.Global.sQuoteLineColumnTitle,v.Ambient.NewLine,v.Local.sFile)		
		f.Intrinsic.Control.EndIf
		
		f.Intrinsic.String.Build("{1}{0}{2}{0}{3}{0}{4}{0}{5}{0}{6}","*!*",v.Global.sQuote,v.DataTable.dtQuote(v.Local.i1).RECORD_NO!FieldValTrim,v.DataTable.dtQuote(v.Local.i1).PART!FieldValTrim,v.DataTable.dtQuote(v.Local.i1).QTY_QUOTED!FieldValFloat,v.DataTable.dtQuote(v.Local.i1).PRICE!FieldValFloat,v.DataTable.dtQuote(v.Local.i1).AMT_DISCOUNT!FieldValFloat,v.Local.sTempValue)
		f.Intrinsic.String.Build("{0}{1}{2}",v.Local.sFile,v.Local.sTempValue,v.Ambient.NewLine,v.Local.sFile)				
	f.Intrinsic.Control.Next(v.Local.i1)
	
	'Write the QuoteHeader information to file
	f.Intrinsic.String.Build("&!&{0}#!#{1}",v.Global.sQuoteHeaderColumnTitle,v.Ambient.NewLine,v.Local.sTempValue)		
	f.Intrinsic.String.Build("{0}{1}",v.Local.sFile,v.Local.sTempValue,v.Local.sFile)		
	f.Intrinsic.String.Build("{0}{1}*!*{2}",v.Local.sFile,v.Global.sQuote,v.Local.fTotal,v.Local.sFile)
	
f.Intrinsic.Control.Else
	'Write the Empty QuoteLine information to file
	f.Intrinsic.String.Build("{0}#!#{1}{1}",v.Global.sQuoteLineColumnTitle,v.Ambient.NewLine,v.Local.sFile)

	'Write the QuoteHeader information to file
	f.Intrinsic.String.Build("&!&{0}#!#{1}",v.Global.sQuoteHeaderColumnTitle,v.Ambient.NewLine,v.Local.sTempValue)		
	f.Intrinsic.String.Build("{0}{1}",v.Local.sFile,v.Local.sTempValue,v.Local.sFile)		
	f.Intrinsic.String.Build("{0}{1}*!*{2}",v.Local.sFile,v.Global.sQuote,0,v.Local.sFile)
f.Intrinsic.Control.EndIf

f.Intrinsic.File.String2File(v.Local.sFileName,v.Local.sFile)
f.Intrinsic.Control.If(v.DataTable.dtQuote.Exists)
	f.Data.DataTable.Close("dtQuote")
f.Intrinsic.Control.EndIf
'TDjohan - End      11/22/2022
Program.Sub.Hook10721.End

Program.Sub.Hook10940.Start
v.Local.sSQL.Declare
v.Local.sTempValue.Declare
v.Local.sDate.Declare

f.Intrinsic.String.LPad(v.Passed.000003,"0",7,v.Global.sQuote)
f.Intrinsic.String.Build("SELECT * FROM GAB_6555_APRVL WHERE QUOTE_NO='{0}'",v.Global.sQuote,v.Local.sSQL)
f.ODBC.Connection!con.OpenLocalRecordsetRO("rstGAB",v.Local.sSQL)

f.Intrinsic.Control.If(v.ODBC.con!rstGAB.EOF,=,False)
	f.Intrinsic.Control.If(v.ODBC.con!rstGAB.FieldValTrim!Approver,=,"")
		f.Intrinsic.UI.Msgbox("Please approve this Quote first.","Quote Approval (6555)")
		v.Passed.777777.Set(1)
		f.Intrinsic.UI.ChangeCallerProperty(v.Passed.000079,"HIDE",1)
		f.Intrinsic.UI.ChangeCallerProperty(v.Passed.000080,"HIDE",1)
		f.Intrinsic.UI.ChangeCallerProperty(v.Passed.000110,"HIDE",1)
		v.Passed.GAB-TEXT-1.Set("")
		v.Passed.GAB-TEXT-2.Set("")
	f.Intrinsic.Control.Else
		f.Intrinsic.Control.If(v.ODBC.con!rstGAB.FieldValTrim!Approver,<>,"*REJECT*")
		f.Intrinsic.Control.AndIf(v.ODBC.con!rstGAB.FieldValTrim!Approver,<>,"*REVISE*")
			f.Intrinsic.UI.ChangeCallerProperty(v.Passed.000079,"HIDE",0)
			f.Intrinsic.UI.ChangeCallerProperty(v.Passed.000080,"HIDE",0)
			f.Intrinsic.UI.ChangeCallerProperty(v.Passed.000110,"HIDE",0)
			v.Passed.GAB-TEXT-1.Set(v.ODBC.con!rstGAB.FieldValTrim!Approver)
			F.Intrinsic.String.Format(V.ODBC.con!rstGAB.FieldValPervasiveDate!approved_date,"D MMM YYYY",V.Local.sDate)
			v.Passed.GAB-TEXT-2.Set(v.Local.sDate)
		f.Intrinsic.Control.Else
			f.Intrinsic.UI.Msgbox("Please approve this Quote first.","Quote Approval (6555)")
			v.Passed.777777.Set(1)
			f.Intrinsic.UI.ChangeCallerProperty(v.Passed.000079,"HIDE",1)
			f.Intrinsic.UI.ChangeCallerProperty(v.Passed.000080,"HIDE",1)
			f.Intrinsic.UI.ChangeCallerProperty(v.Passed.000110,"HIDE",1)
			v.Passed.GAB-TEXT-1.Set("")
			v.Passed.GAB-TEXT-2.Set("")
		f.Intrinsic.Control.EndIf
	f.Intrinsic.Control.EndIf
f.Intrinsic.Control.Else
	f.Intrinsic.String.Build("This Quote is not found in Quote Approval.{0}Please open this Quote thru Estimating/Routing > Files > Quote > Open, hit Line buton and close the line screen.{0}After that, please approve the quote.",v.Ambient.NewLine,v.Local.sTempValue)
	f.Intrinsic.UI.Msgbox(v.Local.sTempValue,"Quote Approval (6555)")
	v.Passed.777777.Set(1)
	f.Intrinsic.UI.ChangeCallerProperty(v.Passed.000079,"HIDE",1)
	f.Intrinsic.UI.ChangeCallerProperty(v.Passed.000080,"HIDE",1)
	f.Intrinsic.UI.ChangeCallerProperty(v.Passed.000110,"HIDE",1)	
	v.Passed.GAB-TEXT-1.Set("")
	v.Passed.GAB-TEXT-2.Set("")
f.Intrinsic.Control.EndIf
f.ODBC.Connection!con.CloseRecordsets("rstGAB")
Program.Sub.Hook10940.End

Program.Sub.Hook10775.Start
v.Local.sSQL.Declare
v.Local.sTempValue.Declare
v.Local.sDate.Declare

f.Intrinsic.String.LPad(v.Passed.000003,"0",7,v.Global.sQuote)
f.Intrinsic.String.Build("SELECT * FROM GAB_6555_APRVL WHERE QUOTE_NO='{0}'",v.Global.sQuote,v.Local.sSQL)
f.ODBC.Connection!con.OpenLocalRecordsetRO("rstGAB",v.Local.sSQL)

f.Intrinsic.Control.If(v.ODBC.con!rstGAB.EOF,=,False)
	f.Intrinsic.Control.If(v.ODBC.con!rstGAB.FieldValTrim!Approver,=,"")
		f.Intrinsic.UI.Msgbox("Please approve this Quote first.","Quote Approval (6555)")
		v.Passed.777777.Set(1)
		f.Intrinsic.UI.ChangeCallerProperty(v.Passed.000079,"HIDE",1)
		f.Intrinsic.UI.ChangeCallerProperty(v.Passed.000080,"HIDE",1)
		f.Intrinsic.UI.ChangeCallerProperty(v.Passed.000110,"HIDE",1)
		v.Passed.GAB-TEXT-1.Set("")
		v.Passed.GAB-TEXT-2.Set("")
	f.Intrinsic.Control.Else
		f.Intrinsic.Control.If(v.ODBC.con!rstGAB.FieldValTrim!Approver,<>,"*REJECT*")
		f.Intrinsic.Control.AndIf(v.ODBC.con!rstGAB.FieldValTrim!Approver,<>,"*REVISE*")
			f.Intrinsic.UI.ChangeCallerProperty(v.Passed.000079,"HIDE",0)
			f.Intrinsic.UI.ChangeCallerProperty(v.Passed.000080,"HIDE",0)
			f.Intrinsic.UI.ChangeCallerProperty(v.Passed.000110,"HIDE",0)
			v.Passed.GAB-TEXT-1.Set(v.ODBC.con!rstGAB.FieldValTrim!Approver)
			F.Intrinsic.String.Format(V.ODBC.con!rstGAB.FieldValPervasiveDate!approved_date,"D MMM YYYY",V.Local.sDate)
			v.Passed.GAB-TEXT-2.Set(v.Local.sDate)
		f.Intrinsic.Control.Else
			f.Intrinsic.UI.Msgbox("Please approve this Quote first.","Quote Approval (6555)")
			v.Passed.777777.Set(1)
			f.Intrinsic.UI.ChangeCallerProperty(v.Passed.000079,"HIDE",1)
			f.Intrinsic.UI.ChangeCallerProperty(v.Passed.000080,"HIDE",1)
			f.Intrinsic.UI.ChangeCallerProperty(v.Passed.000110,"HIDE",1)
			v.Passed.GAB-TEXT-1.Set("")
			v.Passed.GAB-TEXT-2.Set("")
		f.Intrinsic.Control.EndIf
	f.Intrinsic.Control.EndIf
f.Intrinsic.Control.Else
	f.Intrinsic.String.Build("This Quote is not found in Quote Approval.{0}Please open this Quote thru Estimating/Routing > Files > Quote > Open, hit Line buton and close the line screen.{0}After that, please approve the quote.",v.Ambient.NewLine,v.Local.sTempValue)
	f.Intrinsic.UI.Msgbox(v.Local.sTempValue,"Quote Approval (6555)")
	v.Passed.777777.Set(1)
	f.Intrinsic.UI.ChangeCallerProperty(v.Passed.000079,"HIDE",1)
	f.Intrinsic.UI.ChangeCallerProperty(v.Passed.000080,"HIDE",1)
	f.Intrinsic.UI.ChangeCallerProperty(v.Passed.000110,"HIDE",1)
	v.Passed.GAB-TEXT-1.Set("")
	v.Passed.GAB-TEXT-2.Set("")
f.Intrinsic.Control.EndIf
f.ODBC.Connection!con.CloseRecordsets("rstGAB")
Program.Sub.Hook10775.End

Program.Sub.Hook10850.Start
v.Local.sSQL.Declare
v.Local.sTempValue.Declare
v.Local.sDate.Declare

f.Intrinsic.String.LPad(v.Passed.000003,"0",7,v.Global.sQuote)
f.Intrinsic.String.Build("SELECT * FROM GAB_6555_APRVL WHERE QUOTE_NO='{0}'",v.Global.sQuote,v.Local.sSQL)
f.ODBC.Connection!con.OpenLocalRecordsetRO("rstGAB",v.Local.sSQL)

f.Intrinsic.Control.If(v.ODBC.con!rstGAB.EOF,=,False)
	f.Intrinsic.Control.If(v.ODBC.con!rstGAB.FieldValTrim!Approver,=,"")
		f.Intrinsic.UI.Msgbox("Please approve this Quote first.","Quote Approval (6555)")
		v.Passed.777777.Set(1)
		f.Intrinsic.UI.ChangeCallerProperty(v.Passed.000079,"HIDE",1)
		f.Intrinsic.UI.ChangeCallerProperty(v.Passed.000080,"HIDE",1)
		f.Intrinsic.UI.ChangeCallerProperty(v.Passed.000110,"HIDE",1)
		v.Passed.GAB-TEXT-1.Set("")
		v.Passed.GAB-TEXT-2.Set("")
	f.Intrinsic.Control.Else
		f.Intrinsic.Control.If(v.ODBC.con!rstGAB.FieldValTrim!Approver,<>,"*REJECT*")
		f.Intrinsic.Control.AndIf(v.ODBC.con!rstGAB.FieldValTrim!Approver,<>,"*REVISE*")
			f.Intrinsic.UI.ChangeCallerProperty(v.Passed.000079,"HIDE",0)
			f.Intrinsic.UI.ChangeCallerProperty(v.Passed.000080,"HIDE",0)
			f.Intrinsic.UI.ChangeCallerProperty(v.Passed.000110,"HIDE",0)
			v.Passed.GAB-TEXT-1.Set(v.ODBC.con!rstGAB.FieldValTrim!Approver)
			F.Intrinsic.String.Format(V.ODBC.con!rstGAB.FieldValPervasiveDate!approved_date,"D MMM YYYY",V.Local.sDate)
			v.Passed.GAB-TEXT-2.Set(v.Local.sDate)
		f.Intrinsic.Control.Else
			f.Intrinsic.UI.Msgbox("Please approve this Quote first.","Quote Approval (6555)")
			v.Passed.777777.Set(1)
			f.Intrinsic.UI.ChangeCallerProperty(v.Passed.000079,"HIDE",1)
			f.Intrinsic.UI.ChangeCallerProperty(v.Passed.000080,"HIDE",1)
			f.Intrinsic.UI.ChangeCallerProperty(v.Passed.000110,"HIDE",1)
			v.Passed.GAB-TEXT-1.Set("")
			v.Passed.GAB-TEXT-2.Set("")
		f.Intrinsic.Control.EndIf
	f.Intrinsic.Control.EndIf
f.Intrinsic.Control.Else
	f.Intrinsic.String.Build("This Quote is not found in Quote Approval.{0}Please open this Quote thru Estimating/Routing > Files > Quote > Open, hit Line buton and close the line screen.{0}After that, please approve the quote.",v.Ambient.NewLine,v.Local.sTempValue)
	f.Intrinsic.UI.Msgbox(v.Local.sTempValue,"Quote Approval (6555)")
	v.Passed.777777.Set(1)
	f.Intrinsic.UI.ChangeCallerProperty(v.Passed.000079,"HIDE",1)
	f.Intrinsic.UI.ChangeCallerProperty(v.Passed.000080,"HIDE",1)
	f.Intrinsic.UI.ChangeCallerProperty(v.Passed.000110,"HIDE",1)
	v.Passed.GAB-TEXT-1.Set("")
	v.Passed.GAB-TEXT-2.Set("")
f.Intrinsic.Control.EndIf
f.ODBC.Connection!con.CloseRecordsets("rstGAB")
Program.Sub.Hook10850.End

Program.Sub.Hook17330.Start
v.Local.sSQL.Declare
v.Local.sTempValue.Declare

f.Intrinsic.String.LPad(v.Passed.000002,"0",7,v.Global.sQuote)
f.Intrinsic.String.Build("SELECT * FROM GAB_6555_APRVL WHERE QUOTE_NO='{0}'",v.Global.sQuote,v.Local.sSQL)
f.ODBC.Connection!con.OpenLocalRecordsetRO("rstGAB",v.Local.sSQL)

f.Intrinsic.Control.If(v.ODBC.con!rstGAB.EOF,=,False)
	f.Intrinsic.Control.If(v.ODBC.con!rstGAB.FieldValTrim!Approver,=,"")
		f.Intrinsic.UI.Msgbox("Please approve this Quote first.","Quote Approval (6555)")
		v.Passed.777777.Set(1)
	f.Intrinsic.Control.Else
		f.Intrinsic.Control.If(v.ODBC.con!rstGAB.FieldValTrim!Approver,<>,"*REJECT*")
		f.Intrinsic.Control.AndIf(v.ODBC.con!rstGAB.FieldValTrim!Approver,<>,"*REVISE*")
			v.Local.sTempValue.Set("")
		f.Intrinsic.Control.Else
			f.Intrinsic.UI.Msgbox("Please approve this Quote first.","Quote Approval (6555)")
			v.Passed.777777.Set(1)
		f.Intrinsic.Control.EndIf
	f.Intrinsic.Control.EndIf
f.Intrinsic.Control.Else
	f.Intrinsic.String.Build("This Quote is not found in Quote Approval.{0}Please open this Quote thru Estimating/Routing > Files > Quote > Open, hit Line buton and close the line screen.{0}After that, please approve the quote.",v.Ambient.NewLine,v.Local.sTempValue)
	f.Intrinsic.UI.Msgbox(v.Local.sTempValue,"Quote Approval (6555)")
	v.Passed.777777.Set(1)
'	f.Intrinsic.UI.ChangeCallerProperty(v.Passed.000079,"HIDE",1)
'	f.Intrinsic.UI.ChangeCallerProperty(v.Passed.000080,"HIDE",1)
'	f.Intrinsic.UI.ChangeCallerProperty(v.Passed.000110,"HIDE",1)	
f.Intrinsic.Control.EndIf
f.ODBC.Connection!con.CloseRecordsets("rstGAB")
Program.Sub.Hook17330.End

Program.Sub.Hook28301.Start
v.Local.sSQL.Declare

f.Intrinsic.String.LPad(Variable.Passed.000001,"0",7,v.Global.sQuote)
f.Intrinsic.String.Build("SELECT * FROM GAB_6555_APRVL WHERE QUOTE_NO='{0}'",v.Global.sQuote,v.Local.sSQL)
f.ODBC.Connection!con.OpenLocalRecordsetRO("rstGAB",v.Local.sSQL)

f.Intrinsic.Control.If(v.ODBC.con!rstGAB.EOF,=,False)
	f.Intrinsic.Control.If(v.ODBC.con!rstGAB.FieldValTrim!Approver,=,"")
'		f.Intrinsic.UI.Msgbox("Please approve this Quote first.","Quote Approval (6555)")
		v.Passed.777777.Set(1)
		f.Intrinsic.UI.ChangeCallerProperty(Variable.Passed.000006,"HIDE",1)
	f.Intrinsic.Control.Else
		f.Intrinsic.Control.If(v.ODBC.con!rstGAB.FieldValTrim!Approver,<>,"*REJECT*")
		f.Intrinsic.Control.AndIf(v.ODBC.con!rstGAB.FieldValTrim!Approver,<>,"*REVISE*")
			f.Intrinsic.UI.ChangeCallerProperty(Variable.Passed.000006,"HIDE",0)
		f.Intrinsic.Control.Else
'			f.Intrinsic.UI.Msgbox("Please approve this Quote first.","Quote Approval (6555)")
			v.Passed.777777.Set(1)
			f.Intrinsic.UI.ChangeCallerProperty(Variable.Passed.000006,"HIDE",1)
		f.Intrinsic.Control.EndIf
	f.Intrinsic.Control.EndIf
f.Intrinsic.Control.Else
'	f.Intrinsic.UI.Msgbox("This Quote is not found in Quote Approval. Please open this Quote thru Estimating/Routing > Files > Quote > Open, hit Line buton and close the line screen. And then please approve this Quote by approver.","Quote Approval (6555)")
	v.Passed.777777.Set(1)
	f.Intrinsic.UI.ChangeCallerProperty(Variable.Passed.000006,"HIDE",1)
f.Intrinsic.Control.EndIf
f.ODBC.Connection!con.CloseRecordsets("rstGAB")
Program.Sub.Hook28301.End

Program.Sub.SendEmail.Start
v.Local.sSQL.Declare
v.Local.iUserSender.Declare
v.Local.sEmailAndNameSender.Declare
v.Local.sEmailAndNameRecipient.Declare
v.Local.sSubject.Declare
v.Local.sMessage.Declare
v.Local.sNameSender.Declare
v.Local.sUsernameSender.Declare
v.Local.sUsernameRecipient.Declare
v.Local.iRet.Declare
v.Local.sEmail.Declare
v.Local.sName.Declare

'Get Sender's User ID
f.Global.Security.GetUserID(v.Caller.User,v.Caller.CompanyCode,v.Local.iUserSender)

'Build the Email Subject
f.Intrinsic.String.Concat("Quote: ",v.Global.sQuote," Needs Approval",v.Local.sSubject)
'Build the Email Body
f.Intrinsic.String.Build("User ID: {0}{1}",v.Caller.User,v.Ambient.NewLine,V.Local.sMessage)
f.Global.Security.GetFullName(v.Caller.User,v.Local.sNameSender)
f.Intrinsic.String.Build("{0}User Name: {1}{2}",v.Local.sMessage,v.Local.sNameSender,v.Ambient.NewLine,v.Local.sMessage)
f.Intrinsic.String.Build("{0}Quote: {1}{2}",v.Local.sMessage,v.Global.sQuote,v.Ambient.NewLine,v.Local.sMessage)
f.Intrinsic.String.Build("{0}{1}This user has edited or created this quote, and is requesting approval.",v.Local.sMessage,v.Ambient.NewLine,v.Local.sMessage)

'Get the list of approvers who should approve the quote
f.Intrinsic.String.Build("select A.GSS_USER, B.CATEGORY, C.CUSTOMER from GAB_6555_APVR A INNER JOIN GAB_6555_DISC_TIER B ON A.DISC_TIER_ID = B.ID LEFT JOIN GAB_6555_APVR_CUST C ON A.GSS_USER = C.GSS_USER where B.LOWER_DISCOUNT <= {0} and B.UPPER_DISCOUNT >= {0} and C.CUSTOMER = '{1}' ORDER BY A.GSS_USER;",v.Args.MaxDiscPct,v.Args.Customer,v.Local.sSQL)
f.ODBC.Connection!con.OpenLocalRecordsetRO("rstApvr",v.Local.sSQL)
f.Intrinsic.Control.DoUntil(v.ODBC.con!rstApvr.EOF,=,True)	
	'Create a message using the Sender's User ID
	f.Global.Messaging.IsCourierRunning(v.Local.iRet)
	f.Intrinsic.Control.If(v.Local.iRet,<>,0)
		'Recipient's info
		v.Local.sUsernameRecipient.Set(v.ODBC.con!rstApvr.FieldValTrim!GSS_USER)
		f.Global.Security.GetUserEmail(v.Local.sUsernameRecipient,v.Caller.CompanyCode,v.Local.sEmail)
		f.Global.Security.GetFullName(v.Local.sUsernameRecipient,v.Caller.CompanyCode,v.Local.sName)
		f.Intrinsic.String.Concat(v.Local.sName.Trim,"*!*",v.Local.sEmail.Trim,v.Local.sEmailAndNameRecipient)
		
		'Sender's Info
		v.Local.sUsernameSender.Set(v.Caller.User.Trim)
		f.Global.Security.GetUserEmail(v.Local.sUsernameSender,v.Caller.CompanyCode,v.Local.sEmail)
		f.Global.Security.GetFullName(v.Local.sUsernameSender,v.Caller.CompanyCode,v.Local.sName)
		f.Intrinsic.String.Concat(v.Local.sEmail.Trim,"*!*",v.Local.sName.Trim,v.Local.sEmailAndNameSender)
		
		'Queue the email
		f.Global.Messaging.QueueMessage(v.Caller.CompanyCode,v.Local.iUserSender,v.Caller.Caller,v.Local.sSubject,v.Local.sEmailAndNameSender,v.Local.sEmailAndNameRecipient,v.Local.sMessage)
	f.Intrinsic.Control.Else
		f.Intrinsic.UI.Msgbox("Courier is not running. Please ensure courier is running in order to send emails.")
	f.Intrinsic.Control.EndIf
	f.ODBC.con!rstApvr.MoveNext
f.Intrinsic.Control.Loop
f.ODBC.con!rstApvr.Close
Program.Sub.SendEmail.End

Program.Sub.Hook10923.Start
v.Local.sSQL.Declare
v.Local.sDate.Declare
v.Local.sFileName.Declare
v.Local.sFile.Declare
v.Local.fAmount.Declare
v.Local.sTemp.Declare
v.Local.i1.Declare
v.Local.fRate.Declare
v.Local.fTax.Declare
v.Local.fTotal.Declare
v.Local.fTotalCust.Declare
v.Local.sSplitString.Declare
v.Local.sQuoteHeader.Declare
v.Local.sQuoteHeaderInfo.Declare
v.Local.sQuoteLine.Declare
v.Local.sQuoteLineInfo.Declare
v.Local.bQuoteChanged.Declare
v.Local.sFilter.Declare
v.Local.sRet.Declare
v.Local.iRowIndex.Declare
v.Local.fMaxDiscPct.Declare
v.Local.fDiscPct.Declare
v.Local.fTotalAmtQuoteLine.Declare
v.Local.sCurrCo.Declare
V.Local.sTempValue.Declare
V.Local.bExists.Declare

f.Intrinsic.String.LPad(v.Passed.000003,"0",7,v.Global.sQuote)
f.Intrinsic.String.Format(v.Ambient.Date,"YYYYMMDD",v.Local.sDate)
f.Intrinsic.String.Concat(v.System.Temp,"\GSS\GAB_6555_",v.Caller.User.Trim,"_",v.Local.sDate,".txt",v.Local.sFileName)
f.Intrinsic.File.Exists(v.Local.sFileName,v.Local.bExists)
f.Intrinsic.Control.If(v.Local.bExists)
	f.Intrinsic.File.File2String(v.Local.sFileName,v.Local.sFile)

	'The temp file will look like this
	'QUOTE_NO*!*RECORD_NO*!*PART*!*QTY*!*PRICE*!*AMT_DISCOUNT#!#
	'0000017*!*0010*!*3000-A*!*10*!*9.0909*!*-27.27
	'0000017*!*0020*!*8X10STGNK*!*2*!*90.909*!*-18.18
	'&!&QUOTE_NO*!*AMT_TOTAL#!#
	'0000017*!*243.18
	
	'Split the Quote Header and Quote Line
	f.Intrinsic.String.Build("{0}{1}",v.Ambient.NewLine,"&!&",v.Local.sSplitString)
	f.Intrinsic.String.Split(v.Local.sFile,v.Local.sSplitString,v.Local.sFile)
	
	'0 is Quote Line, 1 is Quote Header
	'Process Quote Header
	f.Intrinsic.String.Build("{0}{1}","#!#",v.Ambient.NewLine,v.Local.sSplitString)
	f.Intrinsic.String.Split(v.Local.sFile(1),v.Local.sSplitString,v.Local.sQuoteHeader)
	'The first line is the Quote Header Column Title
	'The second line is the Quote Header information
	f.Intrinsic.String.Split(v.Local.sQuoteHeader(1),"*!*",v.Local.sQuoteHeaderInfo)
	f.Intrinsic.Math.ConvertToFloat(v.Local.sQuoteHeaderInfo(1),v.Local.fAmount)
	
	'Process Quote Line
	f.Intrinsic.String.Build("{0}{1}","#!#",v.Ambient.NewLine,v.Local.sSplitString)
	f.Intrinsic.String.Split(v.Local.sFile(0),v.Local.sSplitString,v.Local.sQuoteLine)
	
	'Convert to Datatable if the Quote Line exists
	f.Intrinsic.Control.If(v.Local.sQuoteLine(1).Trim,<>,"")
		f.Data.DataTable.CreateFromString("dtOriginalQuoteLines",v.Local.sQuoteLine(1),v.Local.sQuoteLine(0),"String*!*String*!*String*!*Float*!*Float*!*Float","*!*",v.Ambient.NewLine,True)
	f.Intrinsic.Control.Else
		f.Data.DataTable.Create("dtOriginalQuoteLines",True)
	f.Intrinsic.Control.EndIf
f.Intrinsic.Control.EndIf

'f.Intrinsic.String.Build("SELECT A.CUSTOMER, B.DATE_QUOTE, B.DATE_DUE, A.RECORD_NO, A.PART, A.QTY_QUOTED, A.PRICE, A.AMT_DISCOUNT, A.Extension, A.Extension_Quote, A.Tax_1, A.Tax_2, A.Tax_3, A.Tax_4, A.Tax_5, A.Tax_6, A.Tax_7, A.Tax_8, A.Tax_9, A.Tax_10, A.Tax_Apply_1, A.Tax_Apply_2, A.Tax_Apply_3, A.Tax_Apply_4, A.Tax_Apply_5, A.Tax_Apply_6, A.Tax_Apply_7, A.Tax_Apply_8, A.Tax_Apply_9, A.Tax_Apply_10, A.Tax_Zone_1, A.Tax_Zone_2, A.Tax_Zone_3, A.Tax_Zone_4, A.Tax_Zone_5, A.Tax_Zone_6, A.Tax_Zone_7, A.Tax_Zone_8, A.Tax_Zone_9, A.Tax_Zone_10 FROM V_QUOTE_LINES A LEFT JOIN V_QUOTE_HEADER B ON A.QUOTE_NO = B.QUOTE_NO WHERE A.QUOTE_NO='{0}' order by A.QUOTE_NO, A.RECORD_NO;",v.Global.sQuote,v.Local.sSQL)
f.Intrinsic.String.Build("SELECT A.QUOTE_CURR_CD, A.CUSTOMER, B.DATE_QUOTE, B.DATE_DUE, A.RECORD_NO, A.PART, A.QTY_QUOTED, A.PRICE, A.AMT_DISCOUNT, A.Extension, A.Extension_Quote, A.Tax_1, A.Tax_2, A.Tax_3, A.Tax_4, A.Tax_5, A.Tax_6, A.Tax_7, A.Tax_8, A.Tax_9, A.Tax_10, A.Tax_Apply_1, A.Tax_Apply_2, A.Tax_Apply_3, A.Tax_Apply_4, A.Tax_Apply_5, A.Tax_Apply_6, A.Tax_Apply_7, A.Tax_Apply_8, A.Tax_Apply_9, A.Tax_Apply_10, A.Tax_Zone_1, A.Tax_Zone_2, A.Tax_Zone_3, A.Tax_Zone_4, A.Tax_Zone_5, A.Tax_Zone_6, A.Tax_Zone_7, A.Tax_Zone_8, A.Tax_Zone_9, A.Tax_Zone_10 FROM V_QUOTE_LINES A LEFT JOIN V_QUOTE_HEADER B ON A.QUOTE_NO = B.QUOTE_NO WHERE A.QUOTE_NO='{0}' order by A.QUOTE_NO, A.RECORD_NO;",v.Global.sQuote,v.Local.sSQL)
f.Data.DataTable.CreateFromSQL("dtQuote","con",v.Local.sSQL,True)

'Get Base Currency
F.Global.General.ReadOption("000000",1,"","0000",V.Local.sCurrCo)

v.Local.bQuoteChanged.Set(False)

'If the total quote lines are different then there are changes to the Quote Lines
f.Intrinsic.Control.If(v.DataTable.dtOriginalQuoteLines.Exists)
	f.Intrinsic.Control.If(v.DataTable.dtOriginalQuoteLines.RowCount,<>,v.DataTable.dtQuote.RowCount)
		v.Local.bQuoteChanged.Set(True)
	f.Intrinsic.Control.EndIf
f.Intrinsic.Control.EndIf

f.Intrinsic.Control.If(v.DataTable.dtQuote.RowCount,>,0)
	V.Local.fTotal.Set(0)
	V.Local.fTotalCust.Set(0)
	f.Intrinsic.Control.For(v.Local.i1,0,v.DataTable.dtQuote.RowCount--,1)
		'Get Tax 1 Amount
		f.Intrinsic.Control.If(v.DataTable.dtQuote(v.Local.i1).Tax_Apply_1!FieldValTrim,=,"Y")
			f.Intrinsic.String.Build("SELECT RATE FROM V_AR_TAX_TABLES WHERE ZONE = '{0}' AND AUTH = '{1}'",v.DataTable.dtQuote(v.Local.i1).Tax_Zone_1!FieldValTrim, v.DataTable.dtQuote(v.Local.i1).Tax_1!FieldValTrim, v.Local.sSQL)
			f.ODBC.Connection!con.ExecuteAndReturn(v.Local.sSQL,v.Local.fRate)
			f.Intrinsic.Math.Mult(v.DataTable.dtQuote(v.Local.i1).Extension!FieldValFloat,v.Local.fRate,v.Local.fTax)
			f.Intrinsic.Math.Round(v.Local.fTax,2,v.Local.fTax)
			f.Intrinsic.Math.Add(v.Local.fTotal, v.Local.fTax, v.Local.fTotal)
			f.Intrinsic.Math.Mult(v.DataTable.dtQuote(v.Local.i1).Extension_Quote!FieldValFloat,v.Local.fRate,v.Local.fTax)
			f.Intrinsic.Math.Round(v.Local.fTax,2,v.Local.fTax)
			f.Intrinsic.Math.Add(v.Local.fTotalCust, v.Local.fTax, v.Local.fTotalCust)			
		f.Intrinsic.Control.EndIf
		
		'Get Tax 2 Amount
		f.Intrinsic.Control.If(v.DataTable.dtQuote(v.Local.i1).Tax_Apply_2!FieldValTrim,=,"Y")
			f.Intrinsic.String.Build("SELECT RATE FROM V_AR_TAX_TABLES WHERE ZONE = '{0}' AND AUTH = '{1}'",v.DataTable.dtQuote(v.Local.i1).Tax_Zone_2!FieldValTrim, v.DataTable.dtQuote(v.Local.i1).Tax_2!FieldValTrim, v.Local.sSQL)
			f.ODBC.Connection!con.ExecuteAndReturn(v.Local.sSQL,v.Local.fRate)
			f.Intrinsic.Math.Mult(v.DataTable.dtQuote(v.Local.i1).Extension!FieldValFloat,v.Local.fRate,v.Local.fTax)
			f.Intrinsic.Math.Round(v.Local.fTax,2,v.Local.fTax)
			f.Intrinsic.Math.Add(v.Local.fTotal, v.Local.fTax, v.Local.fTotal)
			f.Intrinsic.Math.Mult(v.DataTable.dtQuote(v.Local.i1).Extension_Quote!FieldValFloat,v.Local.fRate,v.Local.fTax)
			f.Intrinsic.Math.Round(v.Local.fTax,2,v.Local.fTax)
			f.Intrinsic.Math.Add(v.Local.fTotalCust, v.Local.fTax, v.Local.fTotalCust)			
		f.Intrinsic.Control.EndIf
		
		'Get Tax 3 Amount
		f.Intrinsic.Control.If(v.DataTable.dtQuote(v.Local.i1).Tax_Apply_3!FieldValTrim,=,"Y")
			f.Intrinsic.String.Build("SELECT RATE FROM V_AR_TAX_TABLES WHERE ZONE = '{0}' AND AUTH = '{1}'",v.DataTable.dtQuote(v.Local.i1).Tax_Zone_3!FieldValTrim, v.DataTable.dtQuote(v.Local.i1).Tax_3!FieldValTrim, v.Local.sSQL)
			f.ODBC.Connection!con.ExecuteAndReturn(v.Local.sSQL,v.Local.fRate)
			f.Intrinsic.Math.Mult(v.DataTable.dtQuote(v.Local.i1).Extension!FieldValFloat,v.Local.fRate,v.Local.fTax)
			f.Intrinsic.Math.Round(v.Local.fTax,2,v.Local.fTax)
			f.Intrinsic.Math.Add(v.Local.fTotal, v.Local.fTax, v.Local.fTotal)
			f.Intrinsic.Math.Mult(v.DataTable.dtQuote(v.Local.i1).Extension_Quote!FieldValFloat,v.Local.fRate,v.Local.fTax)
			f.Intrinsic.Math.Round(v.Local.fTax,2,v.Local.fTax)
			f.Intrinsic.Math.Add(v.Local.fTotalCust, v.Local.fTax, v.Local.fTotalCust)			
		f.Intrinsic.Control.EndIf

		'Get Tax 4 Amount
		f.Intrinsic.Control.If(v.DataTable.dtQuote(v.Local.i1).Tax_Apply_4!FieldValTrim,=,"Y")
			f.Intrinsic.String.Build("SELECT RATE FROM V_AR_TAX_TABLES WHERE ZONE = '{0}' AND AUTH = '{1}'",v.DataTable.dtQuote(v.Local.i1).Tax_Zone_4!FieldValTrim, v.DataTable.dtQuote(v.Local.i1).Tax_4!FieldValTrim, v.Local.sSQL)
			f.ODBC.Connection!con.ExecuteAndReturn(v.Local.sSQL,v.Local.fRate)
			f.Intrinsic.Math.Mult(v.DataTable.dtQuote(v.Local.i1).Extension!FieldValFloat,v.Local.fRate,v.Local.fTax)
			f.Intrinsic.Math.Round(v.Local.fTax,2,v.Local.fTax)
			f.Intrinsic.Math.Add(v.Local.fTotal, v.Local.fTax, v.Local.fTotal)
			f.Intrinsic.Math.Mult(v.DataTable.dtQuote(v.Local.i1).Extension_Quote!FieldValFloat,v.Local.fRate,v.Local.fTax)
			f.Intrinsic.Math.Round(v.Local.fTax,2,v.Local.fTax)
			f.Intrinsic.Math.Add(v.Local.fTotalCust, v.Local.fTax, v.Local.fTotalCust)			
		f.Intrinsic.Control.EndIf
		
		'Get Tax 5 Amount
		f.Intrinsic.Control.If(v.DataTable.dtQuote(v.Local.i1).Tax_Apply_5!FieldValTrim,=,"Y")
			f.Intrinsic.String.Build("SELECT RATE FROM V_AR_TAX_TABLES WHERE ZONE = '{0}' AND AUTH = '{1}'",v.DataTable.dtQuote(v.Local.i1).Tax_Zone_5!FieldValTrim, v.DataTable.dtQuote(v.Local.i1).Tax_5!FieldValTrim, v.Local.sSQL)
			f.ODBC.Connection!con.ExecuteAndReturn(v.Local.sSQL,v.Local.fRate)
			f.Intrinsic.Math.Mult(v.DataTable.dtQuote(v.Local.i1).Extension!FieldValFloat,v.Local.fRate,v.Local.fTax)
			f.Intrinsic.Math.Round(v.Local.fTax,2,v.Local.fTax)
			f.Intrinsic.Math.Add(v.Local.fTotal, v.Local.fTax, v.Local.fTotal)
			f.Intrinsic.Math.Mult(v.DataTable.dtQuote(v.Local.i1).Extension_Quote!FieldValFloat,v.Local.fRate,v.Local.fTax)
			f.Intrinsic.Math.Round(v.Local.fTax,2,v.Local.fTax)
			f.Intrinsic.Math.Add(v.Local.fTotalCust, v.Local.fTax, v.Local.fTotalCust)			
		f.Intrinsic.Control.EndIf
		
		'Get Tax 6 Amount
		f.Intrinsic.Control.If(v.DataTable.dtQuote(v.Local.i1).Tax_Apply_6!FieldValTrim,=,"Y")
			f.Intrinsic.String.Build("SELECT RATE FROM V_AR_TAX_TABLES WHERE ZONE = '{0}' AND AUTH = '{1}'",v.DataTable.dtQuote(v.Local.i1).Tax_Zone_6!FieldValTrim, v.DataTable.dtQuote(v.Local.i1).Tax_6!FieldValTrim, v.Local.sSQL)
			f.ODBC.Connection!con.ExecuteAndReturn(v.Local.sSQL,v.Local.fRate)
			f.Intrinsic.Math.Mult(v.DataTable.dtQuote(v.Local.i1).Extension!FieldValFloat,v.Local.fRate,v.Local.fTax)
			f.Intrinsic.Math.Round(v.Local.fTax,2,v.Local.fTax)
			f.Intrinsic.Math.Add(v.Local.fTotal, v.Local.fTax, v.Local.fTotal)
			f.Intrinsic.Math.Mult(v.DataTable.dtQuote(v.Local.i1).Extension_Quote!FieldValFloat,v.Local.fRate,v.Local.fTax)
			f.Intrinsic.Math.Round(v.Local.fTax,2,v.Local.fTax)
			f.Intrinsic.Math.Add(v.Local.fTotalCust, v.Local.fTax, v.Local.fTotalCust)			
		f.Intrinsic.Control.EndIf
		
		'Get Tax 7 Amount
		f.Intrinsic.Control.If(v.DataTable.dtQuote(v.Local.i1).Tax_Apply_7!FieldValTrim,=,"Y")
			f.Intrinsic.String.Build("SELECT RATE FROM V_AR_TAX_TABLES WHERE ZONE = '{0}' AND AUTH = '{1}'",v.DataTable.dtQuote(v.Local.i1).Tax_Zone_7!FieldValTrim, v.DataTable.dtQuote(v.Local.i1).Tax_7!FieldValTrim, v.Local.sSQL)
			f.ODBC.Connection!con.ExecuteAndReturn(v.Local.sSQL,v.Local.fRate)
			f.Intrinsic.Math.Mult(v.DataTable.dtQuote(v.Local.i1).Extension!FieldValFloat,v.Local.fRate,v.Local.fTax)
			f.Intrinsic.Math.Round(v.Local.fTax,2,v.Local.fTax)
			f.Intrinsic.Math.Add(v.Local.fTotal, v.Local.fTax, v.Local.fTotal)
			f.Intrinsic.Math.Mult(v.DataTable.dtQuote(v.Local.i1).Extension_Quote!FieldValFloat,v.Local.fRate,v.Local.fTax)
			f.Intrinsic.Math.Round(v.Local.fTax,2,v.Local.fTax)
			f.Intrinsic.Math.Add(v.Local.fTotalCust, v.Local.fTax, v.Local.fTotalCust)			
		f.Intrinsic.Control.EndIf
		
		'Get Tax 8 Amount
		f.Intrinsic.Control.If(v.DataTable.dtQuote(v.Local.i1).Tax_Apply_8!FieldValTrim,=,"Y")
			f.Intrinsic.String.Build("SELECT RATE FROM V_AR_TAX_TABLES WHERE ZONE = '{0}' AND AUTH = '{1}'",v.DataTable.dtQuote(v.Local.i1).Tax_Zone_8!FieldValTrim, v.DataTable.dtQuote(v.Local.i1).Tax_8!FieldValTrim, v.Local.sSQL)
			f.ODBC.Connection!con.ExecuteAndReturn(v.Local.sSQL,v.Local.fRate)
			f.Intrinsic.Math.Mult(v.DataTable.dtQuote(v.Local.i1).Extension!FieldValFloat,v.Local.fRate,v.Local.fTax)
			f.Intrinsic.Math.Round(v.Local.fTax,2,v.Local.fTax)
			f.Intrinsic.Math.Add(v.Local.fTotal, v.Local.fTax, v.Local.fTotal)
			f.Intrinsic.Math.Mult(v.DataTable.dtQuote(v.Local.i1).Extension_Quote!FieldValFloat,v.Local.fRate,v.Local.fTax)
			f.Intrinsic.Math.Round(v.Local.fTax,2,v.Local.fTax)
			f.Intrinsic.Math.Add(v.Local.fTotalCust, v.Local.fTax, v.Local.fTotalCust)			
		f.Intrinsic.Control.EndIf
		
		'Get Tax 9 Amount
		f.Intrinsic.Control.If(v.DataTable.dtQuote(v.Local.i1).Tax_Apply_9!FieldValTrim,=,"Y")
			f.Intrinsic.String.Build("SELECT RATE FROM V_AR_TAX_TABLES WHERE ZONE = '{0}' AND AUTH = '{1}'",v.DataTable.dtQuote(v.Local.i1).Tax_Zone_9!FieldValTrim, v.DataTable.dtQuote(v.Local.i1).Tax_9!FieldValTrim, v.Local.sSQL)
			f.ODBC.Connection!con.ExecuteAndReturn(v.Local.sSQL,v.Local.fRate)
			f.Intrinsic.Math.Mult(v.DataTable.dtQuote(v.Local.i1).Extension!FieldValFloat,v.Local.fRate,v.Local.fTax)
			f.Intrinsic.Math.Round(v.Local.fTax,2,v.Local.fTax)
			f.Intrinsic.Math.Add(v.Local.fTotal, v.Local.fTax, v.Local.fTotal)
			f.Intrinsic.Math.Mult(v.DataTable.dtQuote(v.Local.i1).Extension_Quote!FieldValFloat,v.Local.fRate,v.Local.fTax)
			f.Intrinsic.Math.Round(v.Local.fTax,2,v.Local.fTax)
			f.Intrinsic.Math.Add(v.Local.fTotalCust, v.Local.fTax, v.Local.fTotalCust)			
		f.Intrinsic.Control.EndIf
		
		'Get Tax 10 Amount
		f.Intrinsic.Control.If(v.DataTable.dtQuote(v.Local.i1).Tax_Apply_10!FieldValTrim,=,"Y")
			f.Intrinsic.String.Build("SELECT RATE FROM V_AR_TAX_TABLES WHERE ZONE = '{0}' AND AUTH = '{1}'",v.DataTable.dtQuote(v.Local.i1).Tax_Zone_10!FieldValTrim, v.DataTable.dtQuote(v.Local.i1).Tax_10!FieldValTrim, v.Local.sSQL)
			f.ODBC.Connection!con.ExecuteAndReturn(v.Local.sSQL,v.Local.fRate)
			f.Intrinsic.Math.Mult(v.DataTable.dtQuote(v.Local.i1).Extension!FieldValFloat,v.Local.fRate,v.Local.fTax)
			f.Intrinsic.Math.Round(v.Local.fTax,2,v.Local.fTax)
			f.Intrinsic.Math.Add(v.Local.fTotal, v.Local.fTax, v.Local.fTotal)
			f.Intrinsic.Math.Mult(v.DataTable.dtQuote(v.Local.i1).Extension_Quote!FieldValFloat,v.Local.fRate,v.Local.fTax)
			f.Intrinsic.Math.Round(v.Local.fTax,2,v.Local.fTax)
			f.Intrinsic.Math.Add(v.Local.fTotalCust, v.Local.fTax, v.Local.fTotalCust)			
		f.Intrinsic.Control.EndIf
		
		f.Intrinsic.Math.Add(v.DataTable.dtQuote(v.Local.i1).Extension!FieldValFloat, v.Local.fTotal, v.Local.fTotal)
		f.Intrinsic.Control.If(v.DataTable.dtQuote(v.Local.i1).QUOTE_CURR_CD!FieldValTrim,=,v.Local.sCurrCo)
			v.Local.fTotalCust.Set(0.00)
		f.Intrinsic.Control.Else
			f.Intrinsic.Math.Add(v.DataTable.dtQuote(v.Local.i1).Extension_Quote!FieldValFloat, v.Local.fTotalCust, v.Local.fTotalCust)
		f.Intrinsic.Control.EndIf
		
		'Checked & Compare the Quote Line data if no change is detected yet
		f.Intrinsic.Control.If(v.Local.bQuoteChanged.Not)
			f.Intrinsic.Control.If(v.DataTable.dtOriginalQuoteLines.Exists)
				f.Intrinsic.String.Build("RECORD_NO = '{0}'",v.DataTable.dtQuote(v.Local.i1).RECORD_NO!FieldValTrim,v.Local.sFilter)
				f.Data.DataTable.Select("dtOriginalQuoteLines",v.Local.sFilter,v.Local.sRet)
				f.Intrinsic.Control.If(v.Local.sRet,=,"***NORETURN***")
					v.Local.bQuoteChanged.Set(True)
				f.Intrinsic.Control.Else
					f.Intrinsic.String.Split(v.Local.sRet,"*!*",v.Local.sRet)
					v.Local.iRowIndex.Set(v.Local.sRet(0).Long)
					f.Intrinsic.Control.If(v.DataTable.dtQuote(v.Local.i1).PART!FieldValTrim,<>,v.DataTable.dtOriginalQuoteLines(v.Local.iRowIndex).PART!FieldValTrim)
						v.Local.bQuoteChanged.Set(True)
					f.Intrinsic.Control.ElseIf(v.DataTable.dtQuote(v.Local.i1).QTY_QUOTED!FieldValFloat,<>,v.DataTable.dtOriginalQuoteLines(v.Local.iRowIndex).QTY_QUOTED!FieldValFloat)
						v.Local.bQuoteChanged.Set(True)
					f.Intrinsic.Control.ElseIf(v.DataTable.dtQuote(v.Local.i1).PRICE!FieldValFloat,<>,v.DataTable.dtOriginalQuoteLines(v.Local.iRowIndex).PRICE!FieldValFloat)
						v.Local.bQuoteChanged.Set(True)
					f.Intrinsic.Control.ElseIf(v.DataTable.dtQuote(v.Local.i1).AMT_DISCOUNT!FieldValFloat,<>,v.DataTable.dtOriginalQuoteLines(v.Local.iRowIndex).AMT_DISCOUNT!FieldValFloat)
						v.Local.bQuoteChanged.Set(True)
					f.Intrinsic.Control.EndIf
				f.Intrinsic.Control.EndIf
			f.Intrinsic.Control.EndIf
		f.Intrinsic.Control.EndIf
		
		'Calculate the Disc Pct for the Quote Line
		'Set it as the Max Disc Pct for the Quote if it is greater than the Max Disc Pct
		f.Intrinsic.Math.Mult(v.DataTable.dtQuote(v.Local.i1).QTY_QUOTED!FieldValFloat,v.DataTable.dtQuote(v.Local.i1).PRICE!FieldValFloat,v.Local.fTotalAmtQuoteLine)
		f.Intrinsic.Control.If(v.Local.fTotalAmtQuoteLine,>,0)
			f.Intrinsic.Math.Div(v.DataTable.dtQuote(v.Local.i1).AMT_DISCOUNT!FieldValFloat,v.Local.fTotalAmtQuoteLine,v.Local.fDiscPct)
			f.Intrinsic.Math.Round(v.Local.fDiscPct,4,v.Local.fDiscPct)
			f.Intrinsic.Math.Abs(v.Local.fDiscPct,v.Local.fDiscPct)
			f.Intrinsic.Control.If(v.Local.fMaxDiscPct,<,v.Local.fDiscPct)
				v.Local.fMaxDiscPct.Set(v.Local.fDiscPct)
			f.Intrinsic.Control.EndIf
		f.Intrinsic.Control.EndIf
	f.Intrinsic.Control.Next(v.Local.i1)
f.Intrinsic.Control.Else
'	f.Intrinsic.UI.Msgbox("This Quote is not added into quote approval. Please add at least one quote line.","Quote Approval (6555)")
	f.Intrinsic.Control.If(V.Local.bQuoteChanged)
		f.Intrinsic.File.Exists(v.Local.sFileName,v.Local.bExists)
		f.Intrinsic.Control.If(v.Local.bExists,=,True)
			f.Intrinsic.File.DeleteFile(v.Local.sFileName)
		f.Intrinsic.Control.EndIf
		
		f.Intrinsic.Control.If(v.DataTable.dtQuote.Exists)
			f.Data.DataTable.Close("dtQuote")
		f.Intrinsic.Control.EndIf
		
		f.Intrinsic.String.Build("SELECT A.CUSTOMER, B.DATE_QUOTE, B.DATE_DUE, A.RECORD_NO, A.PART, A.QTY_QUOTED, A.PRICE, A.AMT_DISCOUNT, A.Extension, A.Extension_Quote, A.Tax_1, A.Tax_2, A.Tax_3, A.Tax_4, A.Tax_5, A.Tax_6, A.Tax_7, A.Tax_8, A.Tax_9, A.Tax_10, A.Tax_Apply_1, A.Tax_Apply_2, A.Tax_Apply_3, A.Tax_Apply_4, A.Tax_Apply_5, A.Tax_Apply_6, A.Tax_Apply_7, A.Tax_Apply_8, A.Tax_Apply_9, A.Tax_Apply_10, A.Tax_Zone_1, A.Tax_Zone_2, A.Tax_Zone_3, A.Tax_Zone_4, A.Tax_Zone_5, A.Tax_Zone_6, A.Tax_Zone_7, A.Tax_Zone_8, A.Tax_Zone_9, A.Tax_Zone_10 FROM V_QUOTE_LINES A LEFT JOIN V_QUOTE_HEADER B ON A.QUOTE_NO = B.QUOTE_NO WHERE A.QUOTE_NO='{0}' ORDER BY A.QUOTE_NO, A.RECORD_NO;",v.Global.sQuote,v.Local.sSQL)
		f.Data.DataTable.CreateFromSQL("dtQuote","con",v.Local.sSQL,True)
		f.Intrinsic.Control.If(v.DataTable.dtQuote.RowCount,>,0)
			V.Local.fTotal.Set(0)
			f.Intrinsic.Control.For(v.Local.i1,0,v.DataTable.dtQuote.RowCount--,1)
				'Get Tax 1 Amount
				f.Intrinsic.Control.If(v.DataTable.dtQuote(v.Local.i1).Tax_Apply_1!FieldValTrim,=,"Y")
					f.Intrinsic.String.Build("SELECT RATE FROM V_AR_TAX_TABLES WHERE ZONE = '{0}' AND AUTH = '{1}'",v.DataTable.dtQuote(v.Local.i1).Tax_Zone_1!FieldValTrim, v.DataTable.dtQuote(v.Local.i1).Tax_1!FieldValTrim, v.Local.sSQL)
					f.ODBC.Connection!con.ExecuteAndReturn(v.Local.sSQL,v.Local.fRate)
					f.Intrinsic.Math.Mult(v.DataTable.dtQuote(v.Local.i1).Extension!FieldValFloat,v.Local.fRate,v.Local.fTax)
					f.Intrinsic.Math.Round(v.Local.fTax,2,v.Local.fTax)
					f.Intrinsic.Math.Add(v.Local.fTotal, v.Local.fTax, v.Local.fTotal)
				f.Intrinsic.Control.EndIf
				
				'Get Tax 2 Amount
				f.Intrinsic.Control.If(v.DataTable.dtQuote(v.Local.i1).Tax_Apply_2!FieldValTrim,=,"Y")
					f.Intrinsic.String.Build("SELECT RATE FROM V_AR_TAX_TABLES WHERE ZONE = '{0}' AND AUTH = '{1}'",v.DataTable.dtQuote(v.Local.i1).Tax_Zone_2!FieldValTrim, v.DataTable.dtQuote(v.Local.i1).Tax_2!FieldValTrim, v.Local.sSQL)
					f.ODBC.Connection!con.ExecuteAndReturn(v.Local.sSQL,v.Local.fRate)
					f.Intrinsic.Math.Mult(v.DataTable.dtQuote(v.Local.i1).Extension!FieldValFloat,v.Local.fRate,v.Local.fTax)
					f.Intrinsic.Math.Round(v.Local.fTax,2,v.Local.fTax)
					f.Intrinsic.Math.Add(v.Local.fTotal, v.Local.fTax, v.Local.fTotal)
				f.Intrinsic.Control.EndIf
				
				'Get Tax 3 Amount
				f.Intrinsic.Control.If(v.DataTable.dtQuote(v.Local.i1).Tax_Apply_3!FieldValTrim,=,"Y")
					f.Intrinsic.String.Build("SELECT RATE FROM V_AR_TAX_TABLES WHERE ZONE = '{0}' AND AUTH = '{1}'",v.DataTable.dtQuote(v.Local.i1).Tax_Zone_3!FieldValTrim, v.DataTable.dtQuote(v.Local.i1).Tax_3!FieldValTrim, v.Local.sSQL)
					f.ODBC.Connection!con.ExecuteAndReturn(v.Local.sSQL,v.Local.fRate)
					f.Intrinsic.Math.Mult(v.DataTable.dtQuote(v.Local.i1).Extension!FieldValFloat,v.Local.fRate,v.Local.fTax)
					f.Intrinsic.Math.Round(v.Local.fTax,2,v.Local.fTax)
					f.Intrinsic.Math.Add(v.Local.fTotal, v.Local.fTax, v.Local.fTotal)
				f.Intrinsic.Control.EndIf
		
				'Get Tax 4 Amount
				f.Intrinsic.Control.If(v.DataTable.dtQuote(v.Local.i1).Tax_Apply_4!FieldValTrim,=,"Y")
					f.Intrinsic.String.Build("SELECT RATE FROM V_AR_TAX_TABLES WHERE ZONE = '{0}' AND AUTH = '{1}'",v.DataTable.dtQuote(v.Local.i1).Tax_Zone_4!FieldValTrim, v.DataTable.dtQuote(v.Local.i1).Tax_4!FieldValTrim, v.Local.sSQL)
					f.ODBC.Connection!con.ExecuteAndReturn(v.Local.sSQL,v.Local.fRate)
					f.Intrinsic.Math.Mult(v.DataTable.dtQuote(v.Local.i1).Extension!FieldValFloat,v.Local.fRate,v.Local.fTax)
					f.Intrinsic.Math.Round(v.Local.fTax,2,v.Local.fTax)
					f.Intrinsic.Math.Add(v.Local.fTotal, v.Local.fTax, v.Local.fTotal)
				f.Intrinsic.Control.EndIf
				
				'Get Tax 5 Amount
				f.Intrinsic.Control.If(v.DataTable.dtQuote(v.Local.i1).Tax_Apply_5!FieldValTrim,=,"Y")
					f.Intrinsic.String.Build("SELECT RATE FROM V_AR_TAX_TABLES WHERE ZONE = '{0}' AND AUTH = '{1}'",v.DataTable.dtQuote(v.Local.i1).Tax_Zone_5!FieldValTrim, v.DataTable.dtQuote(v.Local.i1).Tax_5!FieldValTrim, v.Local.sSQL)
					f.ODBC.Connection!con.ExecuteAndReturn(v.Local.sSQL,v.Local.fRate)
					f.Intrinsic.Math.Mult(v.DataTable.dtQuote(v.Local.i1).Extension!FieldValFloat,v.Local.fRate,v.Local.fTax)
					f.Intrinsic.Math.Round(v.Local.fTax,2,v.Local.fTax)
					f.Intrinsic.Math.Add(v.Local.fTotal, v.Local.fTax, v.Local.fTotal)
				f.Intrinsic.Control.EndIf
				
				'Get Tax 6 Amount
				f.Intrinsic.Control.If(v.DataTable.dtQuote(v.Local.i1).Tax_Apply_6!FieldValTrim,=,"Y")
					f.Intrinsic.String.Build("SELECT RATE FROM V_AR_TAX_TABLES WHERE ZONE = '{0}' AND AUTH = '{1}'",v.DataTable.dtQuote(v.Local.i1).Tax_Zone_6!FieldValTrim, v.DataTable.dtQuote(v.Local.i1).Tax_6!FieldValTrim, v.Local.sSQL)
					f.ODBC.Connection!con.ExecuteAndReturn(v.Local.sSQL,v.Local.fRate)
					f.Intrinsic.Math.Mult(v.DataTable.dtQuote(v.Local.i1).Extension!FieldValFloat,v.Local.fRate,v.Local.fTax)
					f.Intrinsic.Math.Round(v.Local.fTax,2,v.Local.fTax)
					f.Intrinsic.Math.Add(v.Local.fTotal, v.Local.fTax, v.Local.fTotal)
				f.Intrinsic.Control.EndIf
				
				'Get Tax 7 Amount
				f.Intrinsic.Control.If(v.DataTable.dtQuote(v.Local.i1).Tax_Apply_7!FieldValTrim,=,"Y")
					f.Intrinsic.String.Build("SELECT RATE FROM V_AR_TAX_TABLES WHERE ZONE = '{0}' AND AUTH = '{1}'",v.DataTable.dtQuote(v.Local.i1).Tax_Zone_7!FieldValTrim, v.DataTable.dtQuote(v.Local.i1).Tax_7!FieldValTrim, v.Local.sSQL)
					f.ODBC.Connection!con.ExecuteAndReturn(v.Local.sSQL,v.Local.fRate)
					f.Intrinsic.Math.Mult(v.DataTable.dtQuote(v.Local.i1).Extension!FieldValFloat,v.Local.fRate,v.Local.fTax)
					f.Intrinsic.Math.Round(v.Local.fTax,2,v.Local.fTax)
					f.Intrinsic.Math.Add(v.Local.fTotal, v.Local.fTax, v.Local.fTotal)
				f.Intrinsic.Control.EndIf
				
				'Get Tax 8 Amount
				f.Intrinsic.Control.If(v.DataTable.dtQuote(v.Local.i1).Tax_Apply_8!FieldValTrim,=,"Y")
					f.Intrinsic.String.Build("SELECT RATE FROM V_AR_TAX_TABLES WHERE ZONE = '{0}' AND AUTH = '{1}'",v.DataTable.dtQuote(v.Local.i1).Tax_Zone_8!FieldValTrim, v.DataTable.dtQuote(v.Local.i1).Tax_8!FieldValTrim, v.Local.sSQL)
					f.ODBC.Connection!con.ExecuteAndReturn(v.Local.sSQL,v.Local.fRate)
					f.Intrinsic.Math.Mult(v.DataTable.dtQuote(v.Local.i1).Extension!FieldValFloat,v.Local.fRate,v.Local.fTax)
					f.Intrinsic.Math.Round(v.Local.fTax,2,v.Local.fTax)
					f.Intrinsic.Math.Add(v.Local.fTotal, v.Local.fTax, v.Local.fTotal)
				f.Intrinsic.Control.EndIf
				
				'Get Tax 9 Amount
				f.Intrinsic.Control.If(v.DataTable.dtQuote(v.Local.i1).Tax_Apply_9!FieldValTrim,=,"Y")
					f.Intrinsic.String.Build("SELECT RATE FROM V_AR_TAX_TABLES WHERE ZONE = '{0}' AND AUTH = '{1}'",v.DataTable.dtQuote(v.Local.i1).Tax_Zone_9!FieldValTrim, v.DataTable.dtQuote(v.Local.i1).Tax_9!FieldValTrim, v.Local.sSQL)
					f.ODBC.Connection!con.ExecuteAndReturn(v.Local.sSQL,v.Local.fRate)
					f.Intrinsic.Math.Mult(v.DataTable.dtQuote(v.Local.i1).Extension!FieldValFloat,v.Local.fRate,v.Local.fTax)
					f.Intrinsic.Math.Round(v.Local.fTax,2,v.Local.fTax)
					f.Intrinsic.Math.Add(v.Local.fTotal, v.Local.fTax, v.Local.fTotal)
				f.Intrinsic.Control.EndIf
				
				'Get Tax 10 Amount
				f.Intrinsic.Control.If(v.DataTable.dtQuote(v.Local.i1).Tax_Apply_10!FieldValTrim,=,"Y")
					f.Intrinsic.String.Build("SELECT RATE FROM V_AR_TAX_TABLES WHERE ZONE = '{0}' AND AUTH = '{1}'",v.DataTable.dtQuote(v.Local.i1).Tax_Zone_10!FieldValTrim, v.DataTable.dtQuote(v.Local.i1).Tax_10!FieldValTrim, v.Local.sSQL)
					f.ODBC.Connection!con.ExecuteAndReturn(v.Local.sSQL,v.Local.fRate)
					f.Intrinsic.Math.Mult(v.DataTable.dtQuote(v.Local.i1).Extension!FieldValFloat,v.Local.fRate,v.Local.fTax)
					f.Intrinsic.Math.Round(v.Local.fTax,2,v.Local.fTax)
					f.Intrinsic.Math.Add(v.Local.fTotal, v.Local.fTax, v.Local.fTotal)
				f.Intrinsic.Control.EndIf
				
				f.Intrinsic.Math.Add(v.DataTable.dtQuote(v.Local.i1).Extension!FieldValFloat, v.Local.fTotal, v.Local.fTotal)
				
				'Write the QuoteLine information to file
				'Write the QuoteLine Column Title if it is the first line
				f.Intrinsic.Control.If(v.Local.i1,=,0)
					f.Intrinsic.String.Build("{0}#!#{1}",v.Global.sQuoteLineColumnTitle,v.Ambient.NewLine,v.Local.sFile)		
				f.Intrinsic.Control.EndIf
				
				f.Intrinsic.String.Build("{1}{0}{2}{0}{3}{0}{4}{0}{5}{0}{6}","*!*",v.Global.sQuote,v.DataTable.dtQuote(v.Local.i1).RECORD_NO!FieldValTrim,v.DataTable.dtQuote(v.Local.i1).PART!FieldValTrim,v.DataTable.dtQuote(v.Local.i1).QTY_QUOTED!FieldValFloat,v.DataTable.dtQuote(v.Local.i1).PRICE!FieldValFloat,v.DataTable.dtQuote(v.Local.i1).AMT_DISCOUNT!FieldValFloat,v.Local.sTempValue)
				f.Intrinsic.String.Build("{0}{1}{2}",v.Local.sFile,v.Local.sTempValue,v.Ambient.NewLine,v.Local.sFile)				
			f.Intrinsic.Control.Next(v.Local.i1)
			
			'Write the QuoteHeader information to file
			f.Intrinsic.String.Build("&!&{0}#!#{1}",v.Global.sQuoteHeaderColumnTitle,v.Ambient.NewLine,v.Local.sTempValue)		
			f.Intrinsic.String.Build("{0}{1}",v.Local.sFile,v.Local.sTempValue,v.Local.sFile)		
			f.Intrinsic.String.Build("{0}{1}*!*{2}",v.Local.sFile,v.Global.sQuote,v.Local.fTotal,v.Local.sFile)
			
		f.Intrinsic.Control.Else
			'Write the Empty QuoteLine information to file
			f.Intrinsic.String.Build("{0}#!#{1}{1}",v.Global.sQuoteLineColumnTitle,v.Ambient.NewLine,v.Local.sFile)
		
			'Write the QuoteHeader information to file
			f.Intrinsic.String.Build("&!&{0}#!#{1}",v.Global.sQuoteHeaderColumnTitle,v.Ambient.NewLine,v.Local.sTempValue)		
			f.Intrinsic.String.Build("{0}{1}",v.Local.sFile,v.Local.sTempValue,v.Local.sFile)		
			f.Intrinsic.String.Build("{0}{1}*!*{2}",v.Local.sFile,v.Global.sQuote,0,v.Local.sFile)
		f.Intrinsic.Control.EndIf
		
		f.Intrinsic.File.String2File(v.Local.sFileName,v.Local.sFile)
		f.Intrinsic.Control.If(v.DataTable.dtQuote.Exists)
			f.Data.DataTable.Close("dtQuote")
		f.Intrinsic.Control.EndIf
	F.Intrinsic.Control.EndIf
	
	f.Intrinsic.String.Build("update GAB_6555_APRVL set Cust_Amount = 0, Amount = 0, MAX_DISCOUNT = 0, Approver = '*REVISE*', APPROVED_DATE = NULL where Quote_No = '{0}'",v.Global.sQuote,v.Local.sSQL)
	f.ODBC.Connection!con.Execute(v.Local.sSQL)
	f.Intrinsic.Control.ExitSub
f.Intrinsic.Control.EndIf

f.Intrinsic.String.Build("SELECT * FROM GAB_6555_APRVL WHERE QUOTE_NO = '{0}';",v.Global.sQuote,v.Local.sSQL)
f.Data.DataTable.CreateFromSQL("dtGAB","con",v.Local.sSQL,True)
f.Intrinsic.Control.If(v.DataTable.dtGAB.RowCount,=,0)
	f.Intrinsic.Control.If(v.Local.fMaxDiscPct,=,0)
		'Automatically approved the Quote because there is no Discount in the Quote lines
		f.Intrinsic.String.Build("insert into GAB_6555_APRVL(QUOTE_NO, DATE_QUOTE, CUSTOMER, CUST_AMOUNT, AMOUNT, MAX_DISCOUNT, DATE_DUE, ORIGINATOR, APPROVER, APPROVED_DATE) values('{0}', '{1}', '{2}', {3}, {4}, {5}, '{6}', '{7}', 'SYSTEM', NOW());",v.Global.sQuote, v.DataTable.dtQuote(0).Date_Quote!FieldValPervasiveDate, v.DataTable.dtQuote(0).Customer!FieldValTrim, v.Local.fTotalCust, v.Local.fTotal, v.Local.fMaxDiscPct, v.DataTable.dtQuote(0).Date_Due!FieldValPervasiveDate, v.Caller.User.Trim,  v.Local.sSQL)
	f.Intrinsic.Control.Else
		f.Intrinsic.String.Build("insert into GAB_6555_APRVL(QUOTE_NO, DATE_QUOTE, CUSTOMER, CUST_AMOUNT, AMOUNT, MAX_DISCOUNT, DATE_DUE, ORIGINATOR) values('{0}', '{1}', '{2}', {3}, {4}, {5}, '{6}', '{7}');",v.Global.sQuote, v.DataTable.dtQuote(0).Date_Quote!FieldValPervasiveDate, v.DataTable.dtQuote(0).Customer!FieldValTrim, v.Local.fTotalCust, v.Local.fTotal, v.Local.fMaxDiscPct, v.DataTable.dtQuote(0).Date_Due!FieldValPervasiveDate, v.Caller.User.Trim, v.Local.sSQL)
		'Send email to approvers
		f.Intrinsic.Control.CallSub(SendEmail,"Customer",v.DataTable.dtQuote(0).Customer!FieldValTrim,"MaxDiscPct",v.Local.fMaxDiscPct)
	f.Intrinsic.Control.EndIf
f.Intrinsic.Control.ElseIf(v.DataTable.dtGAB.RowCount,>,0)
	f.Intrinsic.Control.If(v.Local.bQuoteChanged)		
		f.Intrinsic.Control.If(v.Local.fMaxDiscPct,=,0)
			'Automatically approved the Quote because there is no Discount in the Quote lines
			f.Intrinsic.String.Build("update GAB_6555_APRVL set DATE_QUOTE = '{1}', Cust_Amount = {2}, Amount = {3}, MAX_DISCOUNT = {4}, DATE_DUE = '{5}', Approver = 'SYSTEM', APPROVED_DATE = NOW() where Quote_No = '{0}'",v.Global.sQuote, v.DataTable.dtQuote(0).Date_Quote!FieldValPervasiveDate, v.Local.fTotalCust, v.Local.fTotal, v.Local.fMaxDiscPct, v.DataTable.dtQuote(0).Date_Due!FieldValPervasiveDate, v.Local.sSQL)
		f.Intrinsic.Control.Else
			f.Intrinsic.String.Build("update GAB_6555_APRVL set DATE_QUOTE = '{1}', Cust_Amount = {2}, Amount = {3}, MAX_DISCOUNT = {4}, DATE_DUE = '{5}', Approver = '*REVISE*', APPROVED_DATE = NULL where Quote_No = '{0}'",v.Global.sQuote, v.DataTable.dtQuote(0).Date_Quote!FieldValPervasiveDate, v.Local.fTotalCust, v.Local.fTotal, v.Local.fMaxDiscPct, v.DataTable.dtQuote(0).Date_Due!FieldValPervasiveDate, v.Local.sSQL)
			'Send email to approvers
			f.Intrinsic.Control.CallSub(SendEmail,"Customer",v.DataTable.dtQuote(0).Customer!FieldValTrim,"MaxDiscPct",v.Local.fMaxDiscPct)
		f.Intrinsic.Control.EndIf
	f.Intrinsic.Control.EndIf
f.Intrinsic.Control.EndIf
f.ODBC.Connection!con.Execute(v.Local.sSQL)

f.Intrinsic.Control.If(v.DataTable.dtOriginalQuoteLines.Exists)
	f.Data.DataTable.Close("dtOriginalQuoteLines")
f.Intrinsic.Control.EndIf

f.Intrinsic.Control.If(v.DataTable.dtQuote.Exists)
	f.Data.DataTable.Close("dtQuote")
f.Intrinsic.Control.EndIf

f.Intrinsic.Control.If(v.DataTable.dtGAB.Exists)
	f.Data.DataTable.Close("dtGAB")
f.Intrinsic.Control.EndIf

f.Intrinsic.Control.If(V.Local.bQuoteChanged)
	f.Intrinsic.File.Exists(v.Local.sFileName,v.Local.bExists)
	f.Intrinsic.Control.If(v.Local.bExists,=,True)
		f.Intrinsic.File.DeleteFile(v.Local.sFileName)
	f.Intrinsic.Control.EndIf
	
	f.Intrinsic.Control.If(v.DataTable.dtQuote.Exists)
		f.Data.DataTable.Close("dtQuote")
	f.Intrinsic.Control.EndIf
	
	f.Intrinsic.String.Build("SELECT A.CUSTOMER, B.DATE_QUOTE, B.DATE_DUE, A.RECORD_NO, A.PART, A.QTY_QUOTED, A.PRICE, A.AMT_DISCOUNT, A.Extension, A.Extension_Quote, A.Tax_1, A.Tax_2, A.Tax_3, A.Tax_4, A.Tax_5, A.Tax_6, A.Tax_7, A.Tax_8, A.Tax_9, A.Tax_10, A.Tax_Apply_1, A.Tax_Apply_2, A.Tax_Apply_3, A.Tax_Apply_4, A.Tax_Apply_5, A.Tax_Apply_6, A.Tax_Apply_7, A.Tax_Apply_8, A.Tax_Apply_9, A.Tax_Apply_10, A.Tax_Zone_1, A.Tax_Zone_2, A.Tax_Zone_3, A.Tax_Zone_4, A.Tax_Zone_5, A.Tax_Zone_6, A.Tax_Zone_7, A.Tax_Zone_8, A.Tax_Zone_9, A.Tax_Zone_10 FROM V_QUOTE_LINES A LEFT JOIN V_QUOTE_HEADER B ON A.QUOTE_NO = B.QUOTE_NO WHERE A.QUOTE_NO='{0}' ORDER BY A.QUOTE_NO, A.RECORD_NO;",v.Global.sQuote,v.Local.sSQL)
	f.Data.DataTable.CreateFromSQL("dtQuote","con",v.Local.sSQL,True)
	f.Intrinsic.Control.If(v.DataTable.dtQuote.RowCount,>,0)
		V.Local.fTotal.Set(0)
		f.Intrinsic.Control.For(v.Local.i1,0,v.DataTable.dtQuote.RowCount--,1)
			'Get Tax 1 Amount
			f.Intrinsic.Control.If(v.DataTable.dtQuote(v.Local.i1).Tax_Apply_1!FieldValTrim,=,"Y")
				f.Intrinsic.String.Build("SELECT RATE FROM V_AR_TAX_TABLES WHERE ZONE = '{0}' AND AUTH = '{1}'",v.DataTable.dtQuote(v.Local.i1).Tax_Zone_1!FieldValTrim, v.DataTable.dtQuote(v.Local.i1).Tax_1!FieldValTrim, v.Local.sSQL)
				f.ODBC.Connection!con.ExecuteAndReturn(v.Local.sSQL,v.Local.fRate)
				f.Intrinsic.Math.Mult(v.DataTable.dtQuote(v.Local.i1).Extension!FieldValFloat,v.Local.fRate,v.Local.fTax)
				f.Intrinsic.Math.Round(v.Local.fTax,2,v.Local.fTax)
				f.Intrinsic.Math.Add(v.Local.fTotal, v.Local.fTax, v.Local.fTotal)
			f.Intrinsic.Control.EndIf
			
			'Get Tax 2 Amount
			f.Intrinsic.Control.If(v.DataTable.dtQuote(v.Local.i1).Tax_Apply_2!FieldValTrim,=,"Y")
				f.Intrinsic.String.Build("SELECT RATE FROM V_AR_TAX_TABLES WHERE ZONE = '{0}' AND AUTH = '{1}'",v.DataTable.dtQuote(v.Local.i1).Tax_Zone_2!FieldValTrim, v.DataTable.dtQuote(v.Local.i1).Tax_2!FieldValTrim, v.Local.sSQL)
				f.ODBC.Connection!con.ExecuteAndReturn(v.Local.sSQL,v.Local.fRate)
				f.Intrinsic.Math.Mult(v.DataTable.dtQuote(v.Local.i1).Extension!FieldValFloat,v.Local.fRate,v.Local.fTax)
				f.Intrinsic.Math.Round(v.Local.fTax,2,v.Local.fTax)
				f.Intrinsic.Math.Add(v.Local.fTotal, v.Local.fTax, v.Local.fTotal)
			f.Intrinsic.Control.EndIf
			
			'Get Tax 3 Amount
			f.Intrinsic.Control.If(v.DataTable.dtQuote(v.Local.i1).Tax_Apply_3!FieldValTrim,=,"Y")
				f.Intrinsic.String.Build("SELECT RATE FROM V_AR_TAX_TABLES WHERE ZONE = '{0}' AND AUTH = '{1}'",v.DataTable.dtQuote(v.Local.i1).Tax_Zone_3!FieldValTrim, v.DataTable.dtQuote(v.Local.i1).Tax_3!FieldValTrim, v.Local.sSQL)
				f.ODBC.Connection!con.ExecuteAndReturn(v.Local.sSQL,v.Local.fRate)
				f.Intrinsic.Math.Mult(v.DataTable.dtQuote(v.Local.i1).Extension!FieldValFloat,v.Local.fRate,v.Local.fTax)
				f.Intrinsic.Math.Round(v.Local.fTax,2,v.Local.fTax)
				f.Intrinsic.Math.Add(v.Local.fTotal, v.Local.fTax, v.Local.fTotal)
			f.Intrinsic.Control.EndIf
	
			'Get Tax 4 Amount
			f.Intrinsic.Control.If(v.DataTable.dtQuote(v.Local.i1).Tax_Apply_4!FieldValTrim,=,"Y")
				f.Intrinsic.String.Build("SELECT RATE FROM V_AR_TAX_TABLES WHERE ZONE = '{0}' AND AUTH = '{1}'",v.DataTable.dtQuote(v.Local.i1).Tax_Zone_4!FieldValTrim, v.DataTable.dtQuote(v.Local.i1).Tax_4!FieldValTrim, v.Local.sSQL)
				f.ODBC.Connection!con.ExecuteAndReturn(v.Local.sSQL,v.Local.fRate)
				f.Intrinsic.Math.Mult(v.DataTable.dtQuote(v.Local.i1).Extension!FieldValFloat,v.Local.fRate,v.Local.fTax)
				f.Intrinsic.Math.Round(v.Local.fTax,2,v.Local.fTax)
				f.Intrinsic.Math.Add(v.Local.fTotal, v.Local.fTax, v.Local.fTotal)
			f.Intrinsic.Control.EndIf
			
			'Get Tax 5 Amount
			f.Intrinsic.Control.If(v.DataTable.dtQuote(v.Local.i1).Tax_Apply_5!FieldValTrim,=,"Y")
				f.Intrinsic.String.Build("SELECT RATE FROM V_AR_TAX_TABLES WHERE ZONE = '{0}' AND AUTH = '{1}'",v.DataTable.dtQuote(v.Local.i1).Tax_Zone_5!FieldValTrim, v.DataTable.dtQuote(v.Local.i1).Tax_5!FieldValTrim, v.Local.sSQL)
				f.ODBC.Connection!con.ExecuteAndReturn(v.Local.sSQL,v.Local.fRate)
				f.Intrinsic.Math.Mult(v.DataTable.dtQuote(v.Local.i1).Extension!FieldValFloat,v.Local.fRate,v.Local.fTax)
				f.Intrinsic.Math.Round(v.Local.fTax,2,v.Local.fTax)
				f.Intrinsic.Math.Add(v.Local.fTotal, v.Local.fTax, v.Local.fTotal)
			f.Intrinsic.Control.EndIf
			
			'Get Tax 6 Amount
			f.Intrinsic.Control.If(v.DataTable.dtQuote(v.Local.i1).Tax_Apply_6!FieldValTrim,=,"Y")
				f.Intrinsic.String.Build("SELECT RATE FROM V_AR_TAX_TABLES WHERE ZONE = '{0}' AND AUTH = '{1}'",v.DataTable.dtQuote(v.Local.i1).Tax_Zone_6!FieldValTrim, v.DataTable.dtQuote(v.Local.i1).Tax_6!FieldValTrim, v.Local.sSQL)
				f.ODBC.Connection!con.ExecuteAndReturn(v.Local.sSQL,v.Local.fRate)
				f.Intrinsic.Math.Mult(v.DataTable.dtQuote(v.Local.i1).Extension!FieldValFloat,v.Local.fRate,v.Local.fTax)
				f.Intrinsic.Math.Round(v.Local.fTax,2,v.Local.fTax)
				f.Intrinsic.Math.Add(v.Local.fTotal, v.Local.fTax, v.Local.fTotal)
			f.Intrinsic.Control.EndIf
			
			'Get Tax 7 Amount
			f.Intrinsic.Control.If(v.DataTable.dtQuote(v.Local.i1).Tax_Apply_7!FieldValTrim,=,"Y")
				f.Intrinsic.String.Build("SELECT RATE FROM V_AR_TAX_TABLES WHERE ZONE = '{0}' AND AUTH = '{1}'",v.DataTable.dtQuote(v.Local.i1).Tax_Zone_7!FieldValTrim, v.DataTable.dtQuote(v.Local.i1).Tax_7!FieldValTrim, v.Local.sSQL)
				f.ODBC.Connection!con.ExecuteAndReturn(v.Local.sSQL,v.Local.fRate)
				f.Intrinsic.Math.Mult(v.DataTable.dtQuote(v.Local.i1).Extension!FieldValFloat,v.Local.fRate,v.Local.fTax)
				f.Intrinsic.Math.Round(v.Local.fTax,2,v.Local.fTax)
				f.Intrinsic.Math.Add(v.Local.fTotal, v.Local.fTax, v.Local.fTotal)
			f.Intrinsic.Control.EndIf
			
			'Get Tax 8 Amount
			f.Intrinsic.Control.If(v.DataTable.dtQuote(v.Local.i1).Tax_Apply_8!FieldValTrim,=,"Y")
				f.Intrinsic.String.Build("SELECT RATE FROM V_AR_TAX_TABLES WHERE ZONE = '{0}' AND AUTH = '{1}'",v.DataTable.dtQuote(v.Local.i1).Tax_Zone_8!FieldValTrim, v.DataTable.dtQuote(v.Local.i1).Tax_8!FieldValTrim, v.Local.sSQL)
				f.ODBC.Connection!con.ExecuteAndReturn(v.Local.sSQL,v.Local.fRate)
				f.Intrinsic.Math.Mult(v.DataTable.dtQuote(v.Local.i1).Extension!FieldValFloat,v.Local.fRate,v.Local.fTax)
				f.Intrinsic.Math.Round(v.Local.fTax,2,v.Local.fTax)
				f.Intrinsic.Math.Add(v.Local.fTotal, v.Local.fTax, v.Local.fTotal)
			f.Intrinsic.Control.EndIf
			
			'Get Tax 9 Amount
			f.Intrinsic.Control.If(v.DataTable.dtQuote(v.Local.i1).Tax_Apply_9!FieldValTrim,=,"Y")
				f.Intrinsic.String.Build("SELECT RATE FROM V_AR_TAX_TABLES WHERE ZONE = '{0}' AND AUTH = '{1}'",v.DataTable.dtQuote(v.Local.i1).Tax_Zone_9!FieldValTrim, v.DataTable.dtQuote(v.Local.i1).Tax_9!FieldValTrim, v.Local.sSQL)
				f.ODBC.Connection!con.ExecuteAndReturn(v.Local.sSQL,v.Local.fRate)
				f.Intrinsic.Math.Mult(v.DataTable.dtQuote(v.Local.i1).Extension!FieldValFloat,v.Local.fRate,v.Local.fTax)
				f.Intrinsic.Math.Round(v.Local.fTax,2,v.Local.fTax)
				f.Intrinsic.Math.Add(v.Local.fTotal, v.Local.fTax, v.Local.fTotal)
			f.Intrinsic.Control.EndIf
			
			'Get Tax 10 Amount
			f.Intrinsic.Control.If(v.DataTable.dtQuote(v.Local.i1).Tax_Apply_10!FieldValTrim,=,"Y")
				f.Intrinsic.String.Build("SELECT RATE FROM V_AR_TAX_TABLES WHERE ZONE = '{0}' AND AUTH = '{1}'",v.DataTable.dtQuote(v.Local.i1).Tax_Zone_10!FieldValTrim, v.DataTable.dtQuote(v.Local.i1).Tax_10!FieldValTrim, v.Local.sSQL)
				f.ODBC.Connection!con.ExecuteAndReturn(v.Local.sSQL,v.Local.fRate)
				f.Intrinsic.Math.Mult(v.DataTable.dtQuote(v.Local.i1).Extension!FieldValFloat,v.Local.fRate,v.Local.fTax)
				f.Intrinsic.Math.Round(v.Local.fTax,2,v.Local.fTax)
				f.Intrinsic.Math.Add(v.Local.fTotal, v.Local.fTax, v.Local.fTotal)
			f.Intrinsic.Control.EndIf
			
			f.Intrinsic.Math.Add(v.DataTable.dtQuote(v.Local.i1).Extension!FieldValFloat, v.Local.fTotal, v.Local.fTotal)
			
			'Write the QuoteLine information to file
			'Write the QuoteLine Column Title if it is the first line
			f.Intrinsic.Control.If(v.Local.i1,=,0)
				f.Intrinsic.String.Build("{0}#!#{1}",v.Global.sQuoteLineColumnTitle,v.Ambient.NewLine,v.Local.sFile)		
			f.Intrinsic.Control.EndIf
			
			f.Intrinsic.String.Build("{1}{0}{2}{0}{3}{0}{4}{0}{5}{0}{6}","*!*",v.Global.sQuote,v.DataTable.dtQuote(v.Local.i1).RECORD_NO!FieldValTrim,v.DataTable.dtQuote(v.Local.i1).PART!FieldValTrim,v.DataTable.dtQuote(v.Local.i1).QTY_QUOTED!FieldValFloat,v.DataTable.dtQuote(v.Local.i1).PRICE!FieldValFloat,v.DataTable.dtQuote(v.Local.i1).AMT_DISCOUNT!FieldValFloat,v.Local.sTempValue)
			f.Intrinsic.String.Build("{0}{1}{2}",v.Local.sFile,v.Local.sTempValue,v.Ambient.NewLine,v.Local.sFile)				
		f.Intrinsic.Control.Next(v.Local.i1)
		
		'Write the QuoteHeader information to file
		f.Intrinsic.String.Build("&!&{0}#!#{1}",v.Global.sQuoteHeaderColumnTitle,v.Ambient.NewLine,v.Local.sTempValue)		
		f.Intrinsic.String.Build("{0}{1}",v.Local.sFile,v.Local.sTempValue,v.Local.sFile)		
		f.Intrinsic.String.Build("{0}{1}*!*{2}",v.Local.sFile,v.Global.sQuote,v.Local.fTotal,v.Local.sFile)
		
	f.Intrinsic.Control.Else
		'Write the Empty QuoteLine information to file
		f.Intrinsic.String.Build("{0}#!#{1}{1}",v.Global.sQuoteLineColumnTitle,v.Ambient.NewLine,v.Local.sFile)
	
		'Write the QuoteHeader information to file
		f.Intrinsic.String.Build("&!&{0}#!#{1}",v.Global.sQuoteHeaderColumnTitle,v.Ambient.NewLine,v.Local.sTempValue)		
		f.Intrinsic.String.Build("{0}{1}",v.Local.sFile,v.Local.sTempValue,v.Local.sFile)		
		f.Intrinsic.String.Build("{0}{1}*!*{2}",v.Local.sFile,v.Global.sQuote,0,v.Local.sFile)
	f.Intrinsic.Control.EndIf
	
	f.Intrinsic.File.String2File(v.Local.sFileName,v.Local.sFile)
	f.Intrinsic.Control.If(v.DataTable.dtQuote.Exists)
		f.Data.DataTable.Close("dtQuote")
	f.Intrinsic.Control.EndIf
F.Intrinsic.Control.EndIf
Program.Sub.Hook10923.End

'Program.Sub.Hook10532.Start
'v.Local.sSQL.Declare
'v.Local.sDate.Declare
'v.Local.sFileName.Declare
'v.Local.sFile.Declare
'v.Local.fAmount.Declare
'v.Local.sTemp.Declare
'v.Local.i1.Declare
'v.Local.fRate.Declare
'v.Local.fTax.Declare
'v.Local.fTotal.Declare
'v.Local.fTotalCust.Declare
'v.Local.sSplitString.Declare
'v.Local.sQuoteHeader.Declare
'v.Local.sQuoteHeaderInfo.Declare
'v.Local.sQuoteLine.Declare
'v.Local.sQuoteLineInfo.Declare
'v.Local.bQuoteChanged.Declare
'v.Local.sFilter.Declare
'v.Local.sRet.Declare
'v.Local.iRowIndex.Declare
'v.Local.fMaxDiscPct.Declare
'v.Local.fDiscPct.Declare
'v.Local.fTotalAmtQuoteLine.Declare
'v.Local.sCurrCo.Declare
'V.Local.sTempValue.Declare
'Function.Intrinsic.Debug.InvokeDebugger
'Function.Intrinsic.Debug.Stop

'f.Intrinsic.String.LPad(v.Passed.000060,"0",7,v.Global.sQuote)
'f.Intrinsic.String.Format(v.Ambient.Date,"YYYYMMDD",v.Local.sDate)
'f.Intrinsic.String.Concat(v.System.Temp,"\GSS\GAB_6555_",v.Caller.User.Trim,"_",v.Local.sDate,".txt",v.Local.sFileName)
'f.Intrinsic.File.File2String(v.Local.sFileName,v.Local.sFile)

''The temp file will look like this
''QUOTE_NO*!*RECORD_NO*!*PART*!*QTY*!*PRICE*!*AMT_DISCOUNT#!#
''0000017*!*0010*!*3000-A*!*10*!*9.0909*!*-27.27
''0000017*!*0020*!*8X10STGNK*!*2*!*90.909*!*-18.18
''&!&QUOTE_NO*!*AMT_TOTAL#!#
''0000017*!*243.18

''Split the Quote Header and Quote Line
'f.Intrinsic.String.Build("{0}{1}",v.Ambient.NewLine,"&!&",v.Local.sSplitString)
'f.Intrinsic.String.Split(v.Local.sFile,v.Local.sSplitString,v.Local.sFile)

''0 is Quote Line, 1 is Quote Header
''Process Quote Header
'f.Intrinsic.String.Build("{0}{1}","#!#",v.Ambient.NewLine,v.Local.sSplitString)
'f.Intrinsic.String.Split(v.Local.sFile(1),v.Local.sSplitString,v.Local.sQuoteHeader)
''The first line is the Quote Header Column Title
''The second line is the Quote Header information
'f.Intrinsic.String.Split(v.Local.sQuoteHeader(1),"*!*",v.Local.sQuoteHeaderInfo)
'f.Intrinsic.Math.ConvertToFloat(v.Local.sQuoteHeaderInfo(1),v.Local.fAmount)

''Process Quote Line
'f.Intrinsic.String.Build("{0}{1}","#!#",v.Ambient.NewLine,v.Local.sSplitString)
'f.Intrinsic.String.Split(v.Local.sFile(0),v.Local.sSplitString,v.Local.sQuoteLine)

''Convert to Datatable if the Quote Line exists
'f.Intrinsic.Control.If(v.Local.sQuoteLine(1).Trim,<>,"")
'	f.Data.DataTable.CreateFromString("dtOriginalQuoteLines",v.Local.sQuoteLine(1),v.Local.sQuoteLine(0),"String*!*String*!*String*!*Float*!*Float*!*Float","*!*",v.Ambient.NewLine,True)
'f.Intrinsic.Control.Else
'	f.Data.DataTable.Create("dtOriginalQuoteLines",True)
'f.Intrinsic.Control.EndIf

''f.Intrinsic.String.Build("SELECT A.CUSTOMER, B.DATE_QUOTE, B.DATE_DUE, A.RECORD_NO, A.PART, A.QTY_QUOTED, A.PRICE, A.AMT_DISCOUNT, A.Extension, A.Extension_Quote, A.Tax_1, A.Tax_2, A.Tax_3, A.Tax_4, A.Tax_5, A.Tax_6, A.Tax_7, A.Tax_8, A.Tax_9, A.Tax_10, A.Tax_Apply_1, A.Tax_Apply_2, A.Tax_Apply_3, A.Tax_Apply_4, A.Tax_Apply_5, A.Tax_Apply_6, A.Tax_Apply_7, A.Tax_Apply_8, A.Tax_Apply_9, A.Tax_Apply_10, A.Tax_Zone_1, A.Tax_Zone_2, A.Tax_Zone_3, A.Tax_Zone_4, A.Tax_Zone_5, A.Tax_Zone_6, A.Tax_Zone_7, A.Tax_Zone_8, A.Tax_Zone_9, A.Tax_Zone_10 FROM V_QUOTE_LINES A LEFT JOIN V_QUOTE_HEADER B ON A.QUOTE_NO = B.QUOTE_NO WHERE A.QUOTE_NO='{0}' order by A.QUOTE_NO, A.RECORD_NO;",v.Global.sQuote,v.Local.sSQL)
'f.Intrinsic.String.Build("SELECT A.QUOTE_CURR_CD, A.CUSTOMER, B.DATE_QUOTE, B.DATE_DUE, A.RECORD_NO, A.PART, A.QTY_QUOTED, A.PRICE, A.AMT_DISCOUNT, A.Extension, A.Extension_Quote, A.Tax_1, A.Tax_2, A.Tax_3, A.Tax_4, A.Tax_5, A.Tax_6, A.Tax_7, A.Tax_8, A.Tax_9, A.Tax_10, A.Tax_Apply_1, A.Tax_Apply_2, A.Tax_Apply_3, A.Tax_Apply_4, A.Tax_Apply_5, A.Tax_Apply_6, A.Tax_Apply_7, A.Tax_Apply_8, A.Tax_Apply_9, A.Tax_Apply_10, A.Tax_Zone_1, A.Tax_Zone_2, A.Tax_Zone_3, A.Tax_Zone_4, A.Tax_Zone_5, A.Tax_Zone_6, A.Tax_Zone_7, A.Tax_Zone_8, A.Tax_Zone_9, A.Tax_Zone_10 FROM V_QUOTE_LINES A LEFT JOIN V_QUOTE_HEADER B ON A.QUOTE_NO = B.QUOTE_NO WHERE A.QUOTE_NO='{0}' order by A.QUOTE_NO, A.RECORD_NO;",v.Global.sQuote,v.Local.sSQL)
'f.Data.DataTable.CreateFromSQL("dtQuote","con",v.Local.sSQL,True)

''Get Base Currency
'F.Global.General.ReadOption("000000",1,"","0000",V.Local.sCurrCo)

'v.Local.bQuoteChanged.Set(False)

''If the total quote lines are different then there are changes to the Quote Lines
'f.Intrinsic.Control.If(v.DataTable.dtOriginalQuoteLines.Exists)
'	f.Intrinsic.Control.If(v.DataTable.dtOriginalQuoteLines.RowCount,<>,v.DataTable.dtQuote.RowCount)
'		v.Local.bQuoteChanged.Set(True)
'	f.Intrinsic.Control.EndIf
'f.Intrinsic.Control.EndIf

'f.Intrinsic.Control.If(v.DataTable.dtQuote.RowCount,>,0)
'	V.Local.fTotal.Set(0)
'	V.Local.fTotalCust.Set(0)
'	f.Intrinsic.Control.For(v.Local.i1,0,v.DataTable.dtQuote.RowCount--,1)
'		'Get Tax 1 Amount
'		f.Intrinsic.Control.If(v.DataTable.dtQuote(v.Local.i1).Tax_Apply_1!FieldValTrim,=,"Y")
'			f.Intrinsic.String.Build("SELECT RATE FROM V_AR_TAX_TABLES WHERE ZONE = '{0}' AND AUTH = '{1}'",v.DataTable.dtQuote(v.Local.i1).Tax_Zone_1!FieldValTrim, v.DataTable.dtQuote(v.Local.i1).Tax_1!FieldValTrim, v.Local.sSQL)
'			f.ODBC.Connection!con.ExecuteAndReturn(v.Local.sSQL,v.Local.fRate)
'			f.Intrinsic.Math.Mult(v.DataTable.dtQuote(v.Local.i1).Extension!FieldValFloat,v.Local.fRate,v.Local.fTax)
'			f.Intrinsic.Math.Round(v.Local.fTax,2,v.Local.fTax)
'			f.Intrinsic.Math.Add(v.Local.fTotal, v.Local.fTax, v.Local.fTotal)
'			f.Intrinsic.Math.Mult(v.DataTable.dtQuote(v.Local.i1).Extension_Quote!FieldValFloat,v.Local.fRate,v.Local.fTax)
'			f.Intrinsic.Math.Round(v.Local.fTax,2,v.Local.fTax)
'			f.Intrinsic.Math.Add(v.Local.fTotalCust, v.Local.fTax, v.Local.fTotalCust)			
'		f.Intrinsic.Control.EndIf
'		
'		'Get Tax 2 Amount
'		f.Intrinsic.Control.If(v.DataTable.dtQuote(v.Local.i1).Tax_Apply_2!FieldValTrim,=,"Y")
'			f.Intrinsic.String.Build("SELECT RATE FROM V_AR_TAX_TABLES WHERE ZONE = '{0}' AND AUTH = '{1}'",v.DataTable.dtQuote(v.Local.i1).Tax_Zone_2!FieldValTrim, v.DataTable.dtQuote(v.Local.i1).Tax_2!FieldValTrim, v.Local.sSQL)
'			f.ODBC.Connection!con.ExecuteAndReturn(v.Local.sSQL,v.Local.fRate)
'			f.Intrinsic.Math.Mult(v.DataTable.dtQuote(v.Local.i1).Extension!FieldValFloat,v.Local.fRate,v.Local.fTax)
'			f.Intrinsic.Math.Round(v.Local.fTax,2,v.Local.fTax)
'			f.Intrinsic.Math.Add(v.Local.fTotal, v.Local.fTax, v.Local.fTotal)
'			f.Intrinsic.Math.Mult(v.DataTable.dtQuote(v.Local.i1).Extension_Quote!FieldValFloat,v.Local.fRate,v.Local.fTax)
'			f.Intrinsic.Math.Round(v.Local.fTax,2,v.Local.fTax)
'			f.Intrinsic.Math.Add(v.Local.fTotalCust, v.Local.fTax, v.Local.fTotalCust)			
'		f.Intrinsic.Control.EndIf
'		
'		'Get Tax 3 Amount
'		f.Intrinsic.Control.If(v.DataTable.dtQuote(v.Local.i1).Tax_Apply_3!FieldValTrim,=,"Y")
'			f.Intrinsic.String.Build("SELECT RATE FROM V_AR_TAX_TABLES WHERE ZONE = '{0}' AND AUTH = '{1}'",v.DataTable.dtQuote(v.Local.i1).Tax_Zone_3!FieldValTrim, v.DataTable.dtQuote(v.Local.i1).Tax_3!FieldValTrim, v.Local.sSQL)
'			f.ODBC.Connection!con.ExecuteAndReturn(v.Local.sSQL,v.Local.fRate)
'			f.Intrinsic.Math.Mult(v.DataTable.dtQuote(v.Local.i1).Extension!FieldValFloat,v.Local.fRate,v.Local.fTax)
'			f.Intrinsic.Math.Round(v.Local.fTax,2,v.Local.fTax)
'			f.Intrinsic.Math.Add(v.Local.fTotal, v.Local.fTax, v.Local.fTotal)
'			f.Intrinsic.Math.Mult(v.DataTable.dtQuote(v.Local.i1).Extension_Quote!FieldValFloat,v.Local.fRate,v.Local.fTax)
'			f.Intrinsic.Math.Round(v.Local.fTax,2,v.Local.fTax)
'			f.Intrinsic.Math.Add(v.Local.fTotalCust, v.Local.fTax, v.Local.fTotalCust)			
'		f.Intrinsic.Control.EndIf

'		'Get Tax 4 Amount
'		f.Intrinsic.Control.If(v.DataTable.dtQuote(v.Local.i1).Tax_Apply_4!FieldValTrim,=,"Y")
'			f.Intrinsic.String.Build("SELECT RATE FROM V_AR_TAX_TABLES WHERE ZONE = '{0}' AND AUTH = '{1}'",v.DataTable.dtQuote(v.Local.i1).Tax_Zone_4!FieldValTrim, v.DataTable.dtQuote(v.Local.i1).Tax_4!FieldValTrim, v.Local.sSQL)
'			f.ODBC.Connection!con.ExecuteAndReturn(v.Local.sSQL,v.Local.fRate)
'			f.Intrinsic.Math.Mult(v.DataTable.dtQuote(v.Local.i1).Extension!FieldValFloat,v.Local.fRate,v.Local.fTax)
'			f.Intrinsic.Math.Round(v.Local.fTax,2,v.Local.fTax)
'			f.Intrinsic.Math.Add(v.Local.fTotal, v.Local.fTax, v.Local.fTotal)
'			f.Intrinsic.Math.Mult(v.DataTable.dtQuote(v.Local.i1).Extension_Quote!FieldValFloat,v.Local.fRate,v.Local.fTax)
'			f.Intrinsic.Math.Round(v.Local.fTax,2,v.Local.fTax)
'			f.Intrinsic.Math.Add(v.Local.fTotalCust, v.Local.fTax, v.Local.fTotalCust)			
'		f.Intrinsic.Control.EndIf
'		
'		'Get Tax 5 Amount
'		f.Intrinsic.Control.If(v.DataTable.dtQuote(v.Local.i1).Tax_Apply_5!FieldValTrim,=,"Y")
'			f.Intrinsic.String.Build("SELECT RATE FROM V_AR_TAX_TABLES WHERE ZONE = '{0}' AND AUTH = '{1}'",v.DataTable.dtQuote(v.Local.i1).Tax_Zone_5!FieldValTrim, v.DataTable.dtQuote(v.Local.i1).Tax_5!FieldValTrim, v.Local.sSQL)
'			f.ODBC.Connection!con.ExecuteAndReturn(v.Local.sSQL,v.Local.fRate)
'			f.Intrinsic.Math.Mult(v.DataTable.dtQuote(v.Local.i1).Extension!FieldValFloat,v.Local.fRate,v.Local.fTax)
'			f.Intrinsic.Math.Round(v.Local.fTax,2,v.Local.fTax)
'			f.Intrinsic.Math.Add(v.Local.fTotal, v.Local.fTax, v.Local.fTotal)
'			f.Intrinsic.Math.Mult(v.DataTable.dtQuote(v.Local.i1).Extension_Quote!FieldValFloat,v.Local.fRate,v.Local.fTax)
'			f.Intrinsic.Math.Round(v.Local.fTax,2,v.Local.fTax)
'			f.Intrinsic.Math.Add(v.Local.fTotalCust, v.Local.fTax, v.Local.fTotalCust)			
'		f.Intrinsic.Control.EndIf
'		
'		'Get Tax 6 Amount
'		f.Intrinsic.Control.If(v.DataTable.dtQuote(v.Local.i1).Tax_Apply_6!FieldValTrim,=,"Y")
'			f.Intrinsic.String.Build("SELECT RATE FROM V_AR_TAX_TABLES WHERE ZONE = '{0}' AND AUTH = '{1}'",v.DataTable.dtQuote(v.Local.i1).Tax_Zone_6!FieldValTrim, v.DataTable.dtQuote(v.Local.i1).Tax_6!FieldValTrim, v.Local.sSQL)
'			f.ODBC.Connection!con.ExecuteAndReturn(v.Local.sSQL,v.Local.fRate)
'			f.Intrinsic.Math.Mult(v.DataTable.dtQuote(v.Local.i1).Extension!FieldValFloat,v.Local.fRate,v.Local.fTax)
'			f.Intrinsic.Math.Round(v.Local.fTax,2,v.Local.fTax)
'			f.Intrinsic.Math.Add(v.Local.fTotal, v.Local.fTax, v.Local.fTotal)
'			f.Intrinsic.Math.Mult(v.DataTable.dtQuote(v.Local.i1).Extension_Quote!FieldValFloat,v.Local.fRate,v.Local.fTax)
'			f.Intrinsic.Math.Round(v.Local.fTax,2,v.Local.fTax)
'			f.Intrinsic.Math.Add(v.Local.fTotalCust, v.Local.fTax, v.Local.fTotalCust)			
'		f.Intrinsic.Control.EndIf
'		
'		'Get Tax 7 Amount
'		f.Intrinsic.Control.If(v.DataTable.dtQuote(v.Local.i1).Tax_Apply_7!FieldValTrim,=,"Y")
'			f.Intrinsic.String.Build("SELECT RATE FROM V_AR_TAX_TABLES WHERE ZONE = '{0}' AND AUTH = '{1}'",v.DataTable.dtQuote(v.Local.i1).Tax_Zone_7!FieldValTrim, v.DataTable.dtQuote(v.Local.i1).Tax_7!FieldValTrim, v.Local.sSQL)
'			f.ODBC.Connection!con.ExecuteAndReturn(v.Local.sSQL,v.Local.fRate)
'			f.Intrinsic.Math.Mult(v.DataTable.dtQuote(v.Local.i1).Extension!FieldValFloat,v.Local.fRate,v.Local.fTax)
'			f.Intrinsic.Math.Round(v.Local.fTax,2,v.Local.fTax)
'			f.Intrinsic.Math.Add(v.Local.fTotal, v.Local.fTax, v.Local.fTotal)
'			f.Intrinsic.Math.Mult(v.DataTable.dtQuote(v.Local.i1).Extension_Quote!FieldValFloat,v.Local.fRate,v.Local.fTax)
'			f.Intrinsic.Math.Round(v.Local.fTax,2,v.Local.fTax)
'			f.Intrinsic.Math.Add(v.Local.fTotalCust, v.Local.fTax, v.Local.fTotalCust)			
'		f.Intrinsic.Control.EndIf
'		
'		'Get Tax 8 Amount
'		f.Intrinsic.Control.If(v.DataTable.dtQuote(v.Local.i1).Tax_Apply_8!FieldValTrim,=,"Y")
'			f.Intrinsic.String.Build("SELECT RATE FROM V_AR_TAX_TABLES WHERE ZONE = '{0}' AND AUTH = '{1}'",v.DataTable.dtQuote(v.Local.i1).Tax_Zone_8!FieldValTrim, v.DataTable.dtQuote(v.Local.i1).Tax_8!FieldValTrim, v.Local.sSQL)
'			f.ODBC.Connection!con.ExecuteAndReturn(v.Local.sSQL,v.Local.fRate)
'			f.Intrinsic.Math.Mult(v.DataTable.dtQuote(v.Local.i1).Extension!FieldValFloat,v.Local.fRate,v.Local.fTax)
'			f.Intrinsic.Math.Round(v.Local.fTax,2,v.Local.fTax)
'			f.Intrinsic.Math.Add(v.Local.fTotal, v.Local.fTax, v.Local.fTotal)
'			f.Intrinsic.Math.Mult(v.DataTable.dtQuote(v.Local.i1).Extension_Quote!FieldValFloat,v.Local.fRate,v.Local.fTax)
'			f.Intrinsic.Math.Round(v.Local.fTax,2,v.Local.fTax)
'			f.Intrinsic.Math.Add(v.Local.fTotalCust, v.Local.fTax, v.Local.fTotalCust)			
'		f.Intrinsic.Control.EndIf
'		
'		'Get Tax 9 Amount
'		f.Intrinsic.Control.If(v.DataTable.dtQuote(v.Local.i1).Tax_Apply_9!FieldValTrim,=,"Y")
'			f.Intrinsic.String.Build("SELECT RATE FROM V_AR_TAX_TABLES WHERE ZONE = '{0}' AND AUTH = '{1}'",v.DataTable.dtQuote(v.Local.i1).Tax_Zone_9!FieldValTrim, v.DataTable.dtQuote(v.Local.i1).Tax_9!FieldValTrim, v.Local.sSQL)
'			f.ODBC.Connection!con.ExecuteAndReturn(v.Local.sSQL,v.Local.fRate)
'			f.Intrinsic.Math.Mult(v.DataTable.dtQuote(v.Local.i1).Extension!FieldValFloat,v.Local.fRate,v.Local.fTax)
'			f.Intrinsic.Math.Round(v.Local.fTax,2,v.Local.fTax)
'			f.Intrinsic.Math.Add(v.Local.fTotal, v.Local.fTax, v.Local.fTotal)
'			f.Intrinsic.Math.Mult(v.DataTable.dtQuote(v.Local.i1).Extension_Quote!FieldValFloat,v.Local.fRate,v.Local.fTax)
'			f.Intrinsic.Math.Round(v.Local.fTax,2,v.Local.fTax)
'			f.Intrinsic.Math.Add(v.Local.fTotalCust, v.Local.fTax, v.Local.fTotalCust)			
'		f.Intrinsic.Control.EndIf
'		
'		'Get Tax 10 Amount
'		f.Intrinsic.Control.If(v.DataTable.dtQuote(v.Local.i1).Tax_Apply_10!FieldValTrim,=,"Y")
'			f.Intrinsic.String.Build("SELECT RATE FROM V_AR_TAX_TABLES WHERE ZONE = '{0}' AND AUTH = '{1}'",v.DataTable.dtQuote(v.Local.i1).Tax_Zone_10!FieldValTrim, v.DataTable.dtQuote(v.Local.i1).Tax_10!FieldValTrim, v.Local.sSQL)
'			f.ODBC.Connection!con.ExecuteAndReturn(v.Local.sSQL,v.Local.fRate)
'			f.Intrinsic.Math.Mult(v.DataTable.dtQuote(v.Local.i1).Extension!FieldValFloat,v.Local.fRate,v.Local.fTax)
'			f.Intrinsic.Math.Round(v.Local.fTax,2,v.Local.fTax)
'			f.Intrinsic.Math.Add(v.Local.fTotal, v.Local.fTax, v.Local.fTotal)
'			f.Intrinsic.Math.Mult(v.DataTable.dtQuote(v.Local.i1).Extension_Quote!FieldValFloat,v.Local.fRate,v.Local.fTax)
'			f.Intrinsic.Math.Round(v.Local.fTax,2,v.Local.fTax)
'			f.Intrinsic.Math.Add(v.Local.fTotalCust, v.Local.fTax, v.Local.fTotalCust)			
'		f.Intrinsic.Control.EndIf
'		
'		f.Intrinsic.Math.Add(v.DataTable.dtQuote(v.Local.i1).Extension!FieldValFloat, v.Local.fTotal, v.Local.fTotal)
'		f.Intrinsic.Control.If(v.DataTable.dtQuote(v.Local.i1).QUOTE_CURR_CD!FieldValTrim,=,v.Local.sCurrCo)
'			v.Local.fTotalCust.Set(0.00)
'		f.Intrinsic.Control.Else
'			f.Intrinsic.Math.Add(v.DataTable.dtQuote(v.Local.i1).Extension_Quote!FieldValFloat, v.Local.fTotalCust, v.Local.fTotalCust)
'		f.Intrinsic.Control.EndIf
'		
'		'Checked & Compare the Quote Line data if no change is detected yet
'		f.Intrinsic.Control.If(v.Local.bQuoteChanged.Not)
'			f.Intrinsic.Control.If(v.DataTable.dtOriginalQuoteLines.Exists)
'				f.Intrinsic.String.Build("RECORD_NO = '{0}'",v.DataTable.dtQuote(v.Local.i1).RECORD_NO!FieldValTrim,v.Local.sFilter)
'				f.Data.DataTable.Select("dtOriginalQuoteLines",v.Local.sFilter,v.Local.sRet)
'				f.Intrinsic.Control.If(v.Local.sRet,=,"***NORETURN***")
'					v.Local.bQuoteChanged.Set(True)
'				f.Intrinsic.Control.Else
'					f.Intrinsic.String.Split(v.Local.sRet,"*!*",v.Local.sRet)
'					v.Local.iRowIndex.Set(v.Local.sRet(0).Long)
'					f.Intrinsic.Control.If(v.DataTable.dtQuote(v.Local.i1).PART!FieldValTrim,<>,v.DataTable.dtOriginalQuoteLines(v.Local.iRowIndex).PART!FieldValTrim)
'						v.Local.bQuoteChanged.Set(True)
'					f.Intrinsic.Control.ElseIf(v.DataTable.dtQuote(v.Local.i1).QTY_QUOTED!FieldValFloat,<>,v.DataTable.dtOriginalQuoteLines(v.Local.iRowIndex).QTY_QUOTED!FieldValFloat)
'						v.Local.bQuoteChanged.Set(True)
'					f.Intrinsic.Control.ElseIf(v.DataTable.dtQuote(v.Local.i1).PRICE!FieldValFloat,<>,v.DataTable.dtOriginalQuoteLines(v.Local.iRowIndex).PRICE!FieldValFloat)
'						v.Local.bQuoteChanged.Set(True)
'					f.Intrinsic.Control.ElseIf(v.DataTable.dtQuote(v.Local.i1).AMT_DISCOUNT!FieldValFloat,<>,v.DataTable.dtOriginalQuoteLines(v.Local.iRowIndex).AMT_DISCOUNT!FieldValFloat)
'						v.Local.bQuoteChanged.Set(True)
'					f.Intrinsic.Control.EndIf
'				f.Intrinsic.Control.EndIf
'			f.Intrinsic.Control.EndIf
'		f.Intrinsic.Control.EndIf
'		
'		'Calculate the Disc Pct for the Quote Line
'		'Set it as the Max Disc Pct for the Quote if it is greater than the Max Disc Pct
'		f.Intrinsic.Math.Mult(v.DataTable.dtQuote(v.Local.i1).QTY_QUOTED!FieldValFloat,v.DataTable.dtQuote(v.Local.i1).PRICE!FieldValFloat,v.Local.fTotalAmtQuoteLine)
'		f.Intrinsic.Control.If(v.Local.fTotalAmtQuoteLine,>,0)
'			f.Intrinsic.Math.Div(v.DataTable.dtQuote(v.Local.i1).AMT_DISCOUNT!FieldValFloat,v.Local.fTotalAmtQuoteLine,v.Local.fDiscPct)
'			f.Intrinsic.Math.Round(v.Local.fDiscPct,4,v.Local.fDiscPct)
'			f.Intrinsic.Math.Abs(v.Local.fDiscPct,v.Local.fDiscPct)
'			f.Intrinsic.Control.If(v.Local.fMaxDiscPct,<,v.Local.fDiscPct)
'				v.Local.fMaxDiscPct.Set(v.Local.fDiscPct)
'			f.Intrinsic.Control.EndIf
'		f.Intrinsic.Control.EndIf
'	f.Intrinsic.Control.Next(v.Local.i1)
'	
'f.Intrinsic.Control.Else

'	f.Intrinsic.Control.If(V.Local.bQuoteChanged)
'		f.Intrinsic.File.DeleteFile(v.Local.sFileName)
'		
'		f.Intrinsic.Control.If(v.DataTable.dtQuote.Exists)
'			f.Data.DataTable.Close("dtQuote")
'		f.Intrinsic.Control.EndIf
'		
'		f.Intrinsic.String.Build("SELECT A.CUSTOMER, B.DATE_QUOTE, B.DATE_DUE, A.RECORD_NO, A.PART, A.QTY_QUOTED, A.PRICE, A.AMT_DISCOUNT, A.Extension, A.Extension_Quote, A.Tax_1, A.Tax_2, A.Tax_3, A.Tax_4, A.Tax_5, A.Tax_6, A.Tax_7, A.Tax_8, A.Tax_9, A.Tax_10, A.Tax_Apply_1, A.Tax_Apply_2, A.Tax_Apply_3, A.Tax_Apply_4, A.Tax_Apply_5, A.Tax_Apply_6, A.Tax_Apply_7, A.Tax_Apply_8, A.Tax_Apply_9, A.Tax_Apply_10, A.Tax_Zone_1, A.Tax_Zone_2, A.Tax_Zone_3, A.Tax_Zone_4, A.Tax_Zone_5, A.Tax_Zone_6, A.Tax_Zone_7, A.Tax_Zone_8, A.Tax_Zone_9, A.Tax_Zone_10 FROM V_QUOTE_LINES A LEFT JOIN V_QUOTE_HEADER B ON A.QUOTE_NO = B.QUOTE_NO WHERE A.QUOTE_NO='{0}' ORDER BY A.QUOTE_NO, A.RECORD_NO;",v.Global.sQuote,v.Local.sSQL)
'		f.Data.DataTable.CreateFromSQL("dtQuote","con",v.Local.sSQL,True)
'		f.Intrinsic.Control.If(v.DataTable.dtQuote.RowCount,>,0)
'			V.Local.fTotal.Set(0)
'			f.Intrinsic.Control.For(v.Local.i1,0,v.DataTable.dtQuote.RowCount--,1)
'				'Get Tax 1 Amount
'				f.Intrinsic.Control.If(v.DataTable.dtQuote(v.Local.i1).Tax_Apply_1!FieldValTrim,=,"Y")
'					f.Intrinsic.String.Build("SELECT RATE FROM V_AR_TAX_TABLES WHERE ZONE = '{0}' AND AUTH = '{1}'",v.DataTable.dtQuote(v.Local.i1).Tax_Zone_1!FieldValTrim, v.DataTable.dtQuote(v.Local.i1).Tax_1!FieldValTrim, v.Local.sSQL)
'					f.ODBC.Connection!con.ExecuteAndReturn(v.Local.sSQL,v.Local.fRate)
'					f.Intrinsic.Math.Mult(v.DataTable.dtQuote(v.Local.i1).Extension!FieldValFloat,v.Local.fRate,v.Local.fTax)
'					f.Intrinsic.Math.Round(v.Local.fTax,2,v.Local.fTax)
'					f.Intrinsic.Math.Add(v.Local.fTotal, v.Local.fTax, v.Local.fTotal)
'				f.Intrinsic.Control.EndIf
'				
'				'Get Tax 2 Amount
'				f.Intrinsic.Control.If(v.DataTable.dtQuote(v.Local.i1).Tax_Apply_2!FieldValTrim,=,"Y")
'					f.Intrinsic.String.Build("SELECT RATE FROM V_AR_TAX_TABLES WHERE ZONE = '{0}' AND AUTH = '{1}'",v.DataTable.dtQuote(v.Local.i1).Tax_Zone_2!FieldValTrim, v.DataTable.dtQuote(v.Local.i1).Tax_2!FieldValTrim, v.Local.sSQL)
'					f.ODBC.Connection!con.ExecuteAndReturn(v.Local.sSQL,v.Local.fRate)
'					f.Intrinsic.Math.Mult(v.DataTable.dtQuote(v.Local.i1).Extension!FieldValFloat,v.Local.fRate,v.Local.fTax)
'					f.Intrinsic.Math.Round(v.Local.fTax,2,v.Local.fTax)
'					f.Intrinsic.Math.Add(v.Local.fTotal, v.Local.fTax, v.Local.fTotal)
'				f.Intrinsic.Control.EndIf
'				
'				'Get Tax 3 Amount
'				f.Intrinsic.Control.If(v.DataTable.dtQuote(v.Local.i1).Tax_Apply_3!FieldValTrim,=,"Y")
'					f.Intrinsic.String.Build("SELECT RATE FROM V_AR_TAX_TABLES WHERE ZONE = '{0}' AND AUTH = '{1}'",v.DataTable.dtQuote(v.Local.i1).Tax_Zone_3!FieldValTrim, v.DataTable.dtQuote(v.Local.i1).Tax_3!FieldValTrim, v.Local.sSQL)
'					f.ODBC.Connection!con.ExecuteAndReturn(v.Local.sSQL,v.Local.fRate)
'					f.Intrinsic.Math.Mult(v.DataTable.dtQuote(v.Local.i1).Extension!FieldValFloat,v.Local.fRate,v.Local.fTax)
'					f.Intrinsic.Math.Round(v.Local.fTax,2,v.Local.fTax)
'					f.Intrinsic.Math.Add(v.Local.fTotal, v.Local.fTax, v.Local.fTotal)
'				f.Intrinsic.Control.EndIf
'		
'				'Get Tax 4 Amount
'				f.Intrinsic.Control.If(v.DataTable.dtQuote(v.Local.i1).Tax_Apply_4!FieldValTrim,=,"Y")
'					f.Intrinsic.String.Build("SELECT RATE FROM V_AR_TAX_TABLES WHERE ZONE = '{0}' AND AUTH = '{1}'",v.DataTable.dtQuote(v.Local.i1).Tax_Zone_4!FieldValTrim, v.DataTable.dtQuote(v.Local.i1).Tax_4!FieldValTrim, v.Local.sSQL)
'					f.ODBC.Connection!con.ExecuteAndReturn(v.Local.sSQL,v.Local.fRate)
'					f.Intrinsic.Math.Mult(v.DataTable.dtQuote(v.Local.i1).Extension!FieldValFloat,v.Local.fRate,v.Local.fTax)
'					f.Intrinsic.Math.Round(v.Local.fTax,2,v.Local.fTax)
'					f.Intrinsic.Math.Add(v.Local.fTotal, v.Local.fTax, v.Local.fTotal)
'				f.Intrinsic.Control.EndIf
'				
'				'Get Tax 5 Amount
'				f.Intrinsic.Control.If(v.DataTable.dtQuote(v.Local.i1).Tax_Apply_5!FieldValTrim,=,"Y")
'					f.Intrinsic.String.Build("SELECT RATE FROM V_AR_TAX_TABLES WHERE ZONE = '{0}' AND AUTH = '{1}'",v.DataTable.dtQuote(v.Local.i1).Tax_Zone_5!FieldValTrim, v.DataTable.dtQuote(v.Local.i1).Tax_5!FieldValTrim, v.Local.sSQL)
'					f.ODBC.Connection!con.ExecuteAndReturn(v.Local.sSQL,v.Local.fRate)
'					f.Intrinsic.Math.Mult(v.DataTable.dtQuote(v.Local.i1).Extension!FieldValFloat,v.Local.fRate,v.Local.fTax)
'					f.Intrinsic.Math.Round(v.Local.fTax,2,v.Local.fTax)
'					f.Intrinsic.Math.Add(v.Local.fTotal, v.Local.fTax, v.Local.fTotal)
'				f.Intrinsic.Control.EndIf
'				
'				'Get Tax 6 Amount
'				f.Intrinsic.Control.If(v.DataTable.dtQuote(v.Local.i1).Tax_Apply_6!FieldValTrim,=,"Y")
'					f.Intrinsic.String.Build("SELECT RATE FROM V_AR_TAX_TABLES WHERE ZONE = '{0}' AND AUTH = '{1}'",v.DataTable.dtQuote(v.Local.i1).Tax_Zone_6!FieldValTrim, v.DataTable.dtQuote(v.Local.i1).Tax_6!FieldValTrim, v.Local.sSQL)
'					f.ODBC.Connection!con.ExecuteAndReturn(v.Local.sSQL,v.Local.fRate)
'					f.Intrinsic.Math.Mult(v.DataTable.dtQuote(v.Local.i1).Extension!FieldValFloat,v.Local.fRate,v.Local.fTax)
'					f.Intrinsic.Math.Round(v.Local.fTax,2,v.Local.fTax)
'					f.Intrinsic.Math.Add(v.Local.fTotal, v.Local.fTax, v.Local.fTotal)
'				f.Intrinsic.Control.EndIf
'				
'				'Get Tax 7 Amount
'				f.Intrinsic.Control.If(v.DataTable.dtQuote(v.Local.i1).Tax_Apply_7!FieldValTrim,=,"Y")
'					f.Intrinsic.String.Build("SELECT RATE FROM V_AR_TAX_TABLES WHERE ZONE = '{0}' AND AUTH = '{1}'",v.DataTable.dtQuote(v.Local.i1).Tax_Zone_7!FieldValTrim, v.DataTable.dtQuote(v.Local.i1).Tax_7!FieldValTrim, v.Local.sSQL)
'					f.ODBC.Connection!con.ExecuteAndReturn(v.Local.sSQL,v.Local.fRate)
'					f.Intrinsic.Math.Mult(v.DataTable.dtQuote(v.Local.i1).Extension!FieldValFloat,v.Local.fRate,v.Local.fTax)
'					f.Intrinsic.Math.Round(v.Local.fTax,2,v.Local.fTax)
'					f.Intrinsic.Math.Add(v.Local.fTotal, v.Local.fTax, v.Local.fTotal)
'				f.Intrinsic.Control.EndIf
'				
'				'Get Tax 8 Amount
'				f.Intrinsic.Control.If(v.DataTable.dtQuote(v.Local.i1).Tax_Apply_8!FieldValTrim,=,"Y")
'					f.Intrinsic.String.Build("SELECT RATE FROM V_AR_TAX_TABLES WHERE ZONE = '{0}' AND AUTH = '{1}'",v.DataTable.dtQuote(v.Local.i1).Tax_Zone_8!FieldValTrim, v.DataTable.dtQuote(v.Local.i1).Tax_8!FieldValTrim, v.Local.sSQL)
'					f.ODBC.Connection!con.ExecuteAndReturn(v.Local.sSQL,v.Local.fRate)
'					f.Intrinsic.Math.Mult(v.DataTable.dtQuote(v.Local.i1).Extension!FieldValFloat,v.Local.fRate,v.Local.fTax)
'					f.Intrinsic.Math.Round(v.Local.fTax,2,v.Local.fTax)
'					f.Intrinsic.Math.Add(v.Local.fTotal, v.Local.fTax, v.Local.fTotal)
'				f.Intrinsic.Control.EndIf
'				
'				'Get Tax 9 Amount
'				f.Intrinsic.Control.If(v.DataTable.dtQuote(v.Local.i1).Tax_Apply_9!FieldValTrim,=,"Y")
'					f.Intrinsic.String.Build("SELECT RATE FROM V_AR_TAX_TABLES WHERE ZONE = '{0}' AND AUTH = '{1}'",v.DataTable.dtQuote(v.Local.i1).Tax_Zone_9!FieldValTrim, v.DataTable.dtQuote(v.Local.i1).Tax_9!FieldValTrim, v.Local.sSQL)
'					f.ODBC.Connection!con.ExecuteAndReturn(v.Local.sSQL,v.Local.fRate)
'					f.Intrinsic.Math.Mult(v.DataTable.dtQuote(v.Local.i1).Extension!FieldValFloat,v.Local.fRate,v.Local.fTax)
'					f.Intrinsic.Math.Round(v.Local.fTax,2,v.Local.fTax)
'					f.Intrinsic.Math.Add(v.Local.fTotal, v.Local.fTax, v.Local.fTotal)
'				f.Intrinsic.Control.EndIf
'				
'				'Get Tax 10 Amount
'				f.Intrinsic.Control.If(v.DataTable.dtQuote(v.Local.i1).Tax_Apply_10!FieldValTrim,=,"Y")
'					f.Intrinsic.String.Build("SELECT RATE FROM V_AR_TAX_TABLES WHERE ZONE = '{0}' AND AUTH = '{1}'",v.DataTable.dtQuote(v.Local.i1).Tax_Zone_10!FieldValTrim, v.DataTable.dtQuote(v.Local.i1).Tax_10!FieldValTrim, v.Local.sSQL)
'					f.ODBC.Connection!con.ExecuteAndReturn(v.Local.sSQL,v.Local.fRate)
'					f.Intrinsic.Math.Mult(v.DataTable.dtQuote(v.Local.i1).Extension!FieldValFloat,v.Local.fRate,v.Local.fTax)
'					f.Intrinsic.Math.Round(v.Local.fTax,2,v.Local.fTax)
'					f.Intrinsic.Math.Add(v.Local.fTotal, v.Local.fTax, v.Local.fTotal)
'				f.Intrinsic.Control.EndIf
'				
'				f.Intrinsic.Math.Add(v.DataTable.dtQuote(v.Local.i1).Extension!FieldValFloat, v.Local.fTotal, v.Local.fTotal)
'				
'				'Write the QuoteLine information to file
'				'Write the QuoteLine Column Title if it is the first line
'				f.Intrinsic.Control.If(v.Local.i1,=,0)
'					f.Intrinsic.String.Build("{0}#!#{1}",v.Global.sQuoteLineColumnTitle,v.Ambient.NewLine,v.Local.sFile)		
'				f.Intrinsic.Control.EndIf
'				
'				f.Intrinsic.String.Build("{1}{0}{2}{0}{3}{0}{4}{0}{5}{0}{6}","*!*",v.Global.sQuote,v.DataTable.dtQuote(v.Local.i1).RECORD_NO!FieldValTrim,v.DataTable.dtQuote(v.Local.i1).PART!FieldValTrim,v.DataTable.dtQuote(v.Local.i1).QTY_QUOTED!FieldValFloat,v.DataTable.dtQuote(v.Local.i1).PRICE!FieldValFloat,v.DataTable.dtQuote(v.Local.i1).AMT_DISCOUNT!FieldValFloat,v.Local.sTempValue)
'				f.Intrinsic.String.Build("{0}{1}{2}",v.Local.sFile,v.Local.sTempValue,v.Ambient.NewLine,v.Local.sFile)				
'			f.Intrinsic.Control.Next(v.Local.i1)
'			
'			'Write the QuoteHeader information to file
'			f.Intrinsic.String.Build("&!&{0}#!#{1}",v.Global.sQuoteHeaderColumnTitle,v.Ambient.NewLine,v.Local.sTempValue)		
'			f.Intrinsic.String.Build("{0}{1}",v.Local.sFile,v.Local.sTempValue,v.Local.sFile)		
'			f.Intrinsic.String.Build("{0}{1}*!*{2}",v.Local.sFile,v.Global.sQuote,v.Local.fTotal,v.Local.sFile)
'			
'		f.Intrinsic.Control.Else
'			'Write the Empty QuoteLine information to file
'			f.Intrinsic.String.Build("{0}#!#{1}{1}",v.Global.sQuoteLineColumnTitle,v.Ambient.NewLine,v.Local.sFile)
'		
'			'Write the QuoteHeader information to file
'			f.Intrinsic.String.Build("&!&{0}#!#{1}",v.Global.sQuoteHeaderColumnTitle,v.Ambient.NewLine,v.Local.sTempValue)		
'			f.Intrinsic.String.Build("{0}{1}",v.Local.sFile,v.Local.sTempValue,v.Local.sFile)		
'			f.Intrinsic.String.Build("{0}{1}*!*{2}",v.Local.sFile,v.Global.sQuote,0,v.Local.sFile)
'		f.Intrinsic.Control.EndIf
'		
'		f.Intrinsic.File.String2File(v.Local.sFileName,v.Local.sFile)
'		f.Intrinsic.Control.If(v.DataTable.dtQuote.Exists)
'			f.Data.DataTable.Close("dtQuote")
'		f.Intrinsic.Control.EndIf
'	F.Intrinsic.Control.EndIf
'	
'	f.Intrinsic.String.Build("update GAB_6555_APRVL set Cust_Amount = 0, Amount = 0, MAX_DISCOUNT = 0, Approver = '*REVISE*', APPROVED_DATE = NULL where Quote_No = '{0}'",v.Global.sQuote,v.Local.sSQL)
'	f.ODBC.Connection!con.Execute(v.Local.sSQL)
'	f.Intrinsic.Control.ExitSub
'f.Intrinsic.Control.EndIf

'f.Intrinsic.String.Build("SELECT * FROM GAB_6555_APRVL WHERE QUOTE_NO = '{0}';",v.Global.sQuote,v.Local.sSQL)
'f.Data.DataTable.CreateFromSQL("dtGAB","con",v.Local.sSQL,True)
'f.Intrinsic.Control.If(v.DataTable.dtGAB.RowCount,=,0)
'	f.Intrinsic.Control.If(v.Local.fMaxDiscPct,=,0)
'		'Automatically approved the Quote because there is no Discount in the Quote lines
'		f.Intrinsic.String.Build("insert into GAB_6555_APRVL(QUOTE_NO, DATE_QUOTE, CUSTOMER, CUST_AMOUNT, AMOUNT, MAX_DISCOUNT, DATE_DUE, ORIGINATOR, APPROVER, APPROVED_DATE) values('{0}', '{1}', '{2}', {3}, {4}, {5}, '{6}', '{7}', 'SYSTEM', NOW());",v.Global.sQuote, v.DataTable.dtQuote(0).Date_Quote!FieldValPervasiveDate, v.DataTable.dtQuote(0).Customer!FieldValTrim, v.Local.fTotalCust, v.Local.fTotal, v.Local.fMaxDiscPct, v.DataTable.dtQuote(0).Date_Due!FieldValPervasiveDate, v.Caller.User.Trim,  v.Local.sSQL)
'	f.Intrinsic.Control.Else
'		f.Intrinsic.String.Build("insert into GAB_6555_APRVL(QUOTE_NO, DATE_QUOTE, CUSTOMER, CUST_AMOUNT, AMOUNT, MAX_DISCOUNT, DATE_DUE, ORIGINATOR) values('{0}', '{1}', '{2}', {3}, {4}, {5}, '{6}', '{7}');",v.Global.sQuote, v.DataTable.dtQuote(0).Date_Quote!FieldValPervasiveDate, v.DataTable.dtQuote(0).Customer!FieldValTrim, v.Local.fTotalCust, v.Local.fTotal, v.Local.fMaxDiscPct, v.DataTable.dtQuote(0).Date_Due!FieldValPervasiveDate, v.Caller.User.Trim, v.Local.sSQL)
'		'Send email to approvers
''		f.Intrinsic.Control.CallSub(SendEmail,"Customer",v.DataTable.dtQuote(0).Customer!FieldValTrim,"MaxDiscPct",v.Local.fMaxDiscPct)
'	f.Intrinsic.Control.EndIf
'f.Intrinsic.Control.ElseIf(v.DataTable.dtGAB.RowCount,>,0)
'	f.Intrinsic.Control.If(v.Local.bQuoteChanged)		
'		f.Intrinsic.Control.If(v.Local.fMaxDiscPct,=,0)
'			'Automatically approved the Quote because there is no Discount in the Quote lines
'			f.Intrinsic.String.Build("update GAB_6555_APRVL set DATE_QUOTE = '{1}', Cust_Amount = {2}, Amount = {3}, MAX_DISCOUNT = {4}, DATE_DUE = '{5}', Approver = 'SYSTEM', APPROVED_DATE = NOW() where Quote_No = '{0}'",v.Global.sQuote, v.DataTable.dtQuote(0).Date_Quote!FieldValPervasiveDate, v.Local.fTotalCust, v.Local.fTotal, v.Local.fMaxDiscPct, v.DataTable.dtQuote(0).Date_Due!FieldValPervasiveDate, v.Local.sSQL)
'		f.Intrinsic.Control.Else
'			f.Intrinsic.String.Build("update GAB_6555_APRVL set DATE_QUOTE = '{1}', Cust_Amount = {2}, Amount = {3}, MAX_DISCOUNT = {4}, DATE_DUE = '{5}', Approver = '*REVISE*', APPROVED_DATE = NULL where Quote_No = '{0}'",v.Global.sQuote, v.DataTable.dtQuote(0).Date_Quote!FieldValPervasiveDate, v.Local.fTotalCust, v.Local.fTotal, v.Local.fMaxDiscPct, v.DataTable.dtQuote(0).Date_Due!FieldValPervasiveDate, v.Local.sSQL)
'			'Send email to approvers
''			f.Intrinsic.Control.CallSub(SendEmail,"Customer",v.DataTable.dtQuote(0).Customer!FieldValTrim,"MaxDiscPct",v.Local.fMaxDiscPct)
'		f.Intrinsic.Control.EndIf
'	f.Intrinsic.Control.EndIf
'f.Intrinsic.Control.EndIf
'f.ODBC.Connection!con.Execute(v.Local.sSQL)

'f.Intrinsic.Control.If(v.DataTable.dtOriginalQuoteLines.Exists)
'	f.Data.DataTable.Close("dtOriginalQuoteLines")
'f.Intrinsic.Control.EndIf

'f.Intrinsic.Control.If(v.DataTable.dtQuote.Exists)
'	f.Data.DataTable.Close("dtQuote")
'f.Intrinsic.Control.EndIf

'f.Intrinsic.Control.If(v.DataTable.dtGAB.Exists)
'	f.Data.DataTable.Close("dtGAB")
'f.Intrinsic.Control.EndIf

'f.Intrinsic.Control.If(V.Local.bQuoteChanged)
'	f.Intrinsic.File.DeleteFile(v.Local.sFileName)
'	
'	f.Intrinsic.Control.If(v.DataTable.dtQuote.Exists)
'		f.Data.DataTable.Close("dtQuote")
'	f.Intrinsic.Control.EndIf
'	
'	f.Intrinsic.String.Build("SELECT A.CUSTOMER, B.DATE_QUOTE, B.DATE_DUE, A.RECORD_NO, A.PART, A.QTY_QUOTED, A.PRICE, A.AMT_DISCOUNT, A.Extension, A.Extension_Quote, A.Tax_1, A.Tax_2, A.Tax_3, A.Tax_4, A.Tax_5, A.Tax_6, A.Tax_7, A.Tax_8, A.Tax_9, A.Tax_10, A.Tax_Apply_1, A.Tax_Apply_2, A.Tax_Apply_3, A.Tax_Apply_4, A.Tax_Apply_5, A.Tax_Apply_6, A.Tax_Apply_7, A.Tax_Apply_8, A.Tax_Apply_9, A.Tax_Apply_10, A.Tax_Zone_1, A.Tax_Zone_2, A.Tax_Zone_3, A.Tax_Zone_4, A.Tax_Zone_5, A.Tax_Zone_6, A.Tax_Zone_7, A.Tax_Zone_8, A.Tax_Zone_9, A.Tax_Zone_10 FROM V_QUOTE_LINES A LEFT JOIN V_QUOTE_HEADER B ON A.QUOTE_NO = B.QUOTE_NO WHERE A.QUOTE_NO='{0}' ORDER BY A.QUOTE_NO, A.RECORD_NO;",v.Global.sQuote,v.Local.sSQL)
'	f.Data.DataTable.CreateFromSQL("dtQuote","con",v.Local.sSQL,True)
'	f.Intrinsic.Control.If(v.DataTable.dtQuote.RowCount,>,0)
'		V.Local.fTotal.Set(0)
'		f.Intrinsic.Control.For(v.Local.i1,0,v.DataTable.dtQuote.RowCount--,1)
'			'Get Tax 1 Amount
'			f.Intrinsic.Control.If(v.DataTable.dtQuote(v.Local.i1).Tax_Apply_1!FieldValTrim,=,"Y")
'				f.Intrinsic.String.Build("SELECT RATE FROM V_AR_TAX_TABLES WHERE ZONE = '{0}' AND AUTH = '{1}'",v.DataTable.dtQuote(v.Local.i1).Tax_Zone_1!FieldValTrim, v.DataTable.dtQuote(v.Local.i1).Tax_1!FieldValTrim, v.Local.sSQL)
'				f.ODBC.Connection!con.ExecuteAndReturn(v.Local.sSQL,v.Local.fRate)
'				f.Intrinsic.Math.Mult(v.DataTable.dtQuote(v.Local.i1).Extension!FieldValFloat,v.Local.fRate,v.Local.fTax)
'				f.Intrinsic.Math.Round(v.Local.fTax,2,v.Local.fTax)
'				f.Intrinsic.Math.Add(v.Local.fTotal, v.Local.fTax, v.Local.fTotal)
'			f.Intrinsic.Control.EndIf
'			
'			'Get Tax 2 Amount
'			f.Intrinsic.Control.If(v.DataTable.dtQuote(v.Local.i1).Tax_Apply_2!FieldValTrim,=,"Y")
'				f.Intrinsic.String.Build("SELECT RATE FROM V_AR_TAX_TABLES WHERE ZONE = '{0}' AND AUTH = '{1}'",v.DataTable.dtQuote(v.Local.i1).Tax_Zone_2!FieldValTrim, v.DataTable.dtQuote(v.Local.i1).Tax_2!FieldValTrim, v.Local.sSQL)
'				f.ODBC.Connection!con.ExecuteAndReturn(v.Local.sSQL,v.Local.fRate)
'				f.Intrinsic.Math.Mult(v.DataTable.dtQuote(v.Local.i1).Extension!FieldValFloat,v.Local.fRate,v.Local.fTax)
'				f.Intrinsic.Math.Round(v.Local.fTax,2,v.Local.fTax)
'				f.Intrinsic.Math.Add(v.Local.fTotal, v.Local.fTax, v.Local.fTotal)
'			f.Intrinsic.Control.EndIf
'			
'			'Get Tax 3 Amount
'			f.Intrinsic.Control.If(v.DataTable.dtQuote(v.Local.i1).Tax_Apply_3!FieldValTrim,=,"Y")
'				f.Intrinsic.String.Build("SELECT RATE FROM V_AR_TAX_TABLES WHERE ZONE = '{0}' AND AUTH = '{1}'",v.DataTable.dtQuote(v.Local.i1).Tax_Zone_3!FieldValTrim, v.DataTable.dtQuote(v.Local.i1).Tax_3!FieldValTrim, v.Local.sSQL)
'				f.ODBC.Connection!con.ExecuteAndReturn(v.Local.sSQL,v.Local.fRate)
'				f.Intrinsic.Math.Mult(v.DataTable.dtQuote(v.Local.i1).Extension!FieldValFloat,v.Local.fRate,v.Local.fTax)
'				f.Intrinsic.Math.Round(v.Local.fTax,2,v.Local.fTax)
'				f.Intrinsic.Math.Add(v.Local.fTotal, v.Local.fTax, v.Local.fTotal)
'			f.Intrinsic.Control.EndIf
'	
'			'Get Tax 4 Amount
'			f.Intrinsic.Control.If(v.DataTable.dtQuote(v.Local.i1).Tax_Apply_4!FieldValTrim,=,"Y")
'				f.Intrinsic.String.Build("SELECT RATE FROM V_AR_TAX_TABLES WHERE ZONE = '{0}' AND AUTH = '{1}'",v.DataTable.dtQuote(v.Local.i1).Tax_Zone_4!FieldValTrim, v.DataTable.dtQuote(v.Local.i1).Tax_4!FieldValTrim, v.Local.sSQL)
'				f.ODBC.Connection!con.ExecuteAndReturn(v.Local.sSQL,v.Local.fRate)
'				f.Intrinsic.Math.Mult(v.DataTable.dtQuote(v.Local.i1).Extension!FieldValFloat,v.Local.fRate,v.Local.fTax)
'				f.Intrinsic.Math.Round(v.Local.fTax,2,v.Local.fTax)
'				f.Intrinsic.Math.Add(v.Local.fTotal, v.Local.fTax, v.Local.fTotal)
'			f.Intrinsic.Control.EndIf
'			
'			'Get Tax 5 Amount
'			f.Intrinsic.Control.If(v.DataTable.dtQuote(v.Local.i1).Tax_Apply_5!FieldValTrim,=,"Y")
'				f.Intrinsic.String.Build("SELECT RATE FROM V_AR_TAX_TABLES WHERE ZONE = '{0}' AND AUTH = '{1}'",v.DataTable.dtQuote(v.Local.i1).Tax_Zone_5!FieldValTrim, v.DataTable.dtQuote(v.Local.i1).Tax_5!FieldValTrim, v.Local.sSQL)
'				f.ODBC.Connection!con.ExecuteAndReturn(v.Local.sSQL,v.Local.fRate)
'				f.Intrinsic.Math.Mult(v.DataTable.dtQuote(v.Local.i1).Extension!FieldValFloat,v.Local.fRate,v.Local.fTax)
'				f.Intrinsic.Math.Round(v.Local.fTax,2,v.Local.fTax)
'				f.Intrinsic.Math.Add(v.Local.fTotal, v.Local.fTax, v.Local.fTotal)
'			f.Intrinsic.Control.EndIf
'			
'			'Get Tax 6 Amount
'			f.Intrinsic.Control.If(v.DataTable.dtQuote(v.Local.i1).Tax_Apply_6!FieldValTrim,=,"Y")
'				f.Intrinsic.String.Build("SELECT RATE FROM V_AR_TAX_TABLES WHERE ZONE = '{0}' AND AUTH = '{1}'",v.DataTable.dtQuote(v.Local.i1).Tax_Zone_6!FieldValTrim, v.DataTable.dtQuote(v.Local.i1).Tax_6!FieldValTrim, v.Local.sSQL)
'				f.ODBC.Connection!con.ExecuteAndReturn(v.Local.sSQL,v.Local.fRate)
'				f.Intrinsic.Math.Mult(v.DataTable.dtQuote(v.Local.i1).Extension!FieldValFloat,v.Local.fRate,v.Local.fTax)
'				f.Intrinsic.Math.Round(v.Local.fTax,2,v.Local.fTax)
'				f.Intrinsic.Math.Add(v.Local.fTotal, v.Local.fTax, v.Local.fTotal)
'			f.Intrinsic.Control.EndIf
'			
'			'Get Tax 7 Amount
'			f.Intrinsic.Control.If(v.DataTable.dtQuote(v.Local.i1).Tax_Apply_7!FieldValTrim,=,"Y")
'				f.Intrinsic.String.Build("SELECT RATE FROM V_AR_TAX_TABLES WHERE ZONE = '{0}' AND AUTH = '{1}'",v.DataTable.dtQuote(v.Local.i1).Tax_Zone_7!FieldValTrim, v.DataTable.dtQuote(v.Local.i1).Tax_7!FieldValTrim, v.Local.sSQL)
'				f.ODBC.Connection!con.ExecuteAndReturn(v.Local.sSQL,v.Local.fRate)
'				f.Intrinsic.Math.Mult(v.DataTable.dtQuote(v.Local.i1).Extension!FieldValFloat,v.Local.fRate,v.Local.fTax)
'				f.Intrinsic.Math.Round(v.Local.fTax,2,v.Local.fTax)
'				f.Intrinsic.Math.Add(v.Local.fTotal, v.Local.fTax, v.Local.fTotal)
'			f.Intrinsic.Control.EndIf
'			
'			'Get Tax 8 Amount
'			f.Intrinsic.Control.If(v.DataTable.dtQuote(v.Local.i1).Tax_Apply_8!FieldValTrim,=,"Y")
'				f.Intrinsic.String.Build("SELECT RATE FROM V_AR_TAX_TABLES WHERE ZONE = '{0}' AND AUTH = '{1}'",v.DataTable.dtQuote(v.Local.i1).Tax_Zone_8!FieldValTrim, v.DataTable.dtQuote(v.Local.i1).Tax_8!FieldValTrim, v.Local.sSQL)
'				f.ODBC.Connection!con.ExecuteAndReturn(v.Local.sSQL,v.Local.fRate)
'				f.Intrinsic.Math.Mult(v.DataTable.dtQuote(v.Local.i1).Extension!FieldValFloat,v.Local.fRate,v.Local.fTax)
'				f.Intrinsic.Math.Round(v.Local.fTax,2,v.Local.fTax)
'				f.Intrinsic.Math.Add(v.Local.fTotal, v.Local.fTax, v.Local.fTotal)
'			f.Intrinsic.Control.EndIf
'			
'			'Get Tax 9 Amount
'			f.Intrinsic.Control.If(v.DataTable.dtQuote(v.Local.i1).Tax_Apply_9!FieldValTrim,=,"Y")
'				f.Intrinsic.String.Build("SELECT RATE FROM V_AR_TAX_TABLES WHERE ZONE = '{0}' AND AUTH = '{1}'",v.DataTable.dtQuote(v.Local.i1).Tax_Zone_9!FieldValTrim, v.DataTable.dtQuote(v.Local.i1).Tax_9!FieldValTrim, v.Local.sSQL)
'				f.ODBC.Connection!con.ExecuteAndReturn(v.Local.sSQL,v.Local.fRate)
'				f.Intrinsic.Math.Mult(v.DataTable.dtQuote(v.Local.i1).Extension!FieldValFloat,v.Local.fRate,v.Local.fTax)
'				f.Intrinsic.Math.Round(v.Local.fTax,2,v.Local.fTax)
'				f.Intrinsic.Math.Add(v.Local.fTotal, v.Local.fTax, v.Local.fTotal)
'			f.Intrinsic.Control.EndIf
'			
'			'Get Tax 10 Amount
'			f.Intrinsic.Control.If(v.DataTable.dtQuote(v.Local.i1).Tax_Apply_10!FieldValTrim,=,"Y")
'				f.Intrinsic.String.Build("SELECT RATE FROM V_AR_TAX_TABLES WHERE ZONE = '{0}' AND AUTH = '{1}'",v.DataTable.dtQuote(v.Local.i1).Tax_Zone_10!FieldValTrim, v.DataTable.dtQuote(v.Local.i1).Tax_10!FieldValTrim, v.Local.sSQL)
'				f.ODBC.Connection!con.ExecuteAndReturn(v.Local.sSQL,v.Local.fRate)
'				f.Intrinsic.Math.Mult(v.DataTable.dtQuote(v.Local.i1).Extension!FieldValFloat,v.Local.fRate,v.Local.fTax)
'				f.Intrinsic.Math.Round(v.Local.fTax,2,v.Local.fTax)
'				f.Intrinsic.Math.Add(v.Local.fTotal, v.Local.fTax, v.Local.fTotal)
'			f.Intrinsic.Control.EndIf
'			
'			f.Intrinsic.Math.Add(v.DataTable.dtQuote(v.Local.i1).Extension!FieldValFloat, v.Local.fTotal, v.Local.fTotal)
'			
'			'Write the QuoteLine information to file
'			'Write the QuoteLine Column Title if it is the first line
'			f.Intrinsic.Control.If(v.Local.i1,=,0)
'				f.Intrinsic.String.Build("{0}#!#{1}",v.Global.sQuoteLineColumnTitle,v.Ambient.NewLine,v.Local.sFile)		
'			f.Intrinsic.Control.EndIf
'			
'			f.Intrinsic.String.Build("{1}{0}{2}{0}{3}{0}{4}{0}{5}{0}{6}","*!*",v.Global.sQuote,v.DataTable.dtQuote(v.Local.i1).RECORD_NO!FieldValTrim,v.DataTable.dtQuote(v.Local.i1).PART!FieldValTrim,v.DataTable.dtQuote(v.Local.i1).QTY_QUOTED!FieldValFloat,v.DataTable.dtQuote(v.Local.i1).PRICE!FieldValFloat,v.DataTable.dtQuote(v.Local.i1).AMT_DISCOUNT!FieldValFloat,v.Local.sTempValue)
'			f.Intrinsic.String.Build("{0}{1}{2}",v.Local.sFile,v.Local.sTempValue,v.Ambient.NewLine,v.Local.sFile)				
'		f.Intrinsic.Control.Next(v.Local.i1)
'		
'		'Write the QuoteHeader information to file
'		f.Intrinsic.String.Build("&!&{0}#!#{1}",v.Global.sQuoteHeaderColumnTitle,v.Ambient.NewLine,v.Local.sTempValue)		
'		f.Intrinsic.String.Build("{0}{1}",v.Local.sFile,v.Local.sTempValue,v.Local.sFile)		
'		f.Intrinsic.String.Build("{0}{1}*!*{2}",v.Local.sFile,v.Global.sQuote,v.Local.fTotal,v.Local.sFile)
'		
'	f.Intrinsic.Control.Else
'		'Write the Empty QuoteLine information to file
'		f.Intrinsic.String.Build("{0}#!#{1}{1}",v.Global.sQuoteLineColumnTitle,v.Ambient.NewLine,v.Local.sFile)
'	
'		'Write the QuoteHeader information to file
'		f.Intrinsic.String.Build("&!&{0}#!#{1}",v.Global.sQuoteHeaderColumnTitle,v.Ambient.NewLine,v.Local.sTempValue)		
'		f.Intrinsic.String.Build("{0}{1}",v.Local.sFile,v.Local.sTempValue,v.Local.sFile)		
'		f.Intrinsic.String.Build("{0}{1}*!*{2}",v.Local.sFile,v.Global.sQuote,0,v.Local.sFile)
'	f.Intrinsic.Control.EndIf
'	
'	f.Intrinsic.File.String2File(v.Local.sFileName,v.Local.sFile)
'	f.Intrinsic.Control.If(v.DataTable.dtQuote.Exists)
'		f.Data.DataTable.Close("dtQuote")
'	f.Intrinsic.Control.EndIf
'F.Intrinsic.Control.EndIf
'Program.Sub.Hook10532.End

Program.Sub.Hook10532.Start
v.Local.sSQL.Declare
v.Local.sDate.Declare
v.Local.sFileName.Declare
v.Local.sFile.Declare
v.Local.fAmount.Declare
v.Local.sTemp.Declare
v.Local.i1.Declare
v.Local.fRate.Declare
v.Local.fTax.Declare
v.Local.fTotal.Declare
v.Local.fTotalCust.Declare
v.Local.sSplitString.Declare
v.Local.sQuoteHeader.Declare
v.Local.sQuoteHeaderInfo.Declare
v.Local.sQuoteLine.Declare
v.Local.sQuoteLineInfo.Declare
v.Local.bQuoteChanged.Declare
v.Local.sFilter.Declare
v.Local.sRet.Declare
v.Local.iRowIndex.Declare
v.Local.fMaxDiscPct.Declare
v.Local.fDiscPct.Declare
v.Local.fTotalAmtQuoteLine.Declare
v.Local.sCurrCo.Declare
V.Local.sTempValue.Declare

f.Intrinsic.String.LPad(v.Passed.000060,"0",7,v.Global.sQuote)
f.Intrinsic.String.Format(v.Ambient.Date,"YYYYMMDD",v.Local.sDate)
f.Intrinsic.String.Concat(v.System.Temp,"\GSS\GAB_6555_",v.Caller.User.Trim,"_",v.Local.sDate,".txt",v.Local.sFileName)
f.Intrinsic.File.File2String(v.Local.sFileName,v.Local.sFile)

'The temp file will look like this
'QUOTE_NO*!*RECORD_NO*!*PART*!*QTY*!*PRICE*!*AMT_DISCOUNT#!#
'0000017*!*0010*!*3000-A*!*10*!*9.0909*!*-27.27
'0000017*!*0020*!*8X10STGNK*!*2*!*90.909*!*-18.18
'&!&QUOTE_NO*!*AMT_TOTAL#!#
'0000017*!*243.18

'Split the Quote Header and Quote Line
f.Intrinsic.String.Build("{0}{1}",v.Ambient.NewLine,"&!&",v.Local.sSplitString)
f.Intrinsic.String.Split(v.Local.sFile,v.Local.sSplitString,v.Local.sFile)

'0 is Quote Line, 1 is Quote Header
'Process Quote Header
f.Intrinsic.String.Build("{0}{1}","#!#",v.Ambient.NewLine,v.Local.sSplitString)
f.Intrinsic.String.Split(v.Local.sFile(1),v.Local.sSplitString,v.Local.sQuoteHeader)
'The first line is the Quote Header Column Title
'The second line is the Quote Header information
f.Intrinsic.String.Split(v.Local.sQuoteHeader(1),"*!*",v.Local.sQuoteHeaderInfo)
f.Intrinsic.Math.ConvertToFloat(v.Local.sQuoteHeaderInfo(1),v.Local.fAmount)

'Process Quote Line
f.Intrinsic.String.Build("{0}{1}","#!#",v.Ambient.NewLine,v.Local.sSplitString)
f.Intrinsic.String.Split(v.Local.sFile(0),v.Local.sSplitString,v.Local.sQuoteLine)

'Convert to Datatable if the Quote Line exists
f.Intrinsic.Control.If(v.Local.sQuoteLine(1).Trim,<>,"")
	f.Data.DataTable.CreateFromString("dtOriginalQuoteLines",v.Local.sQuoteLine(1),v.Local.sQuoteLine(0),"String*!*String*!*String*!*Float*!*Float*!*Float","*!*",v.Ambient.NewLine,True)
f.Intrinsic.Control.Else
	f.Data.DataTable.Create("dtOriginalQuoteLines",True)
f.Intrinsic.Control.EndIf

'f.Intrinsic.String.Build("SELECT A.CUSTOMER, B.DATE_QUOTE, B.DATE_DUE, A.RECORD_NO, A.PART, A.QTY_QUOTED, A.PRICE, A.AMT_DISCOUNT, A.Extension, A.Extension_Quote, A.Tax_1, A.Tax_2, A.Tax_3, A.Tax_4, A.Tax_5, A.Tax_6, A.Tax_7, A.Tax_8, A.Tax_9, A.Tax_10, A.Tax_Apply_1, A.Tax_Apply_2, A.Tax_Apply_3, A.Tax_Apply_4, A.Tax_Apply_5, A.Tax_Apply_6, A.Tax_Apply_7, A.Tax_Apply_8, A.Tax_Apply_9, A.Tax_Apply_10, A.Tax_Zone_1, A.Tax_Zone_2, A.Tax_Zone_3, A.Tax_Zone_4, A.Tax_Zone_5, A.Tax_Zone_6, A.Tax_Zone_7, A.Tax_Zone_8, A.Tax_Zone_9, A.Tax_Zone_10 FROM V_QUOTE_LINES A LEFT JOIN V_QUOTE_HEADER B ON A.QUOTE_NO = B.QUOTE_NO WHERE A.QUOTE_NO='{0}' order by A.QUOTE_NO, A.RECORD_NO;",v.Global.sQuote,v.Local.sSQL)
f.Intrinsic.String.Build("SELECT A.QUOTE_CURR_CD, A.CUSTOMER, B.DATE_QUOTE, B.DATE_DUE, A.RECORD_NO, A.PART, A.QTY_QUOTED, A.PRICE, A.AMT_DISCOUNT, A.Extension, A.Extension_Quote, A.Tax_1, A.Tax_2, A.Tax_3, A.Tax_4, A.Tax_5, A.Tax_6, A.Tax_7, A.Tax_8, A.Tax_9, A.Tax_10, A.Tax_Apply_1, A.Tax_Apply_2, A.Tax_Apply_3, A.Tax_Apply_4, A.Tax_Apply_5, A.Tax_Apply_6, A.Tax_Apply_7, A.Tax_Apply_8, A.Tax_Apply_9, A.Tax_Apply_10, A.Tax_Zone_1, A.Tax_Zone_2, A.Tax_Zone_3, A.Tax_Zone_4, A.Tax_Zone_5, A.Tax_Zone_6, A.Tax_Zone_7, A.Tax_Zone_8, A.Tax_Zone_9, A.Tax_Zone_10 FROM V_QUOTE_LINES A LEFT JOIN V_QUOTE_HEADER B ON A.QUOTE_NO = B.QUOTE_NO WHERE A.QUOTE_NO='{0}' order by A.QUOTE_NO, A.RECORD_NO;",v.Global.sQuote,v.Local.sSQL)
f.Data.DataTable.CreateFromSQL("dtQuote","con",v.Local.sSQL,True)

'Get Base Currency
F.Global.General.ReadOption("000000",1,"","0000",V.Local.sCurrCo)

v.Local.bQuoteChanged.Set(False)

'If the total quote lines are different then there are changes to the Quote Lines
f.Intrinsic.Control.If(v.DataTable.dtOriginalQuoteLines.Exists)
	f.Intrinsic.Control.If(v.DataTable.dtOriginalQuoteLines.RowCount,<>,v.DataTable.dtQuote.RowCount)
		v.Local.bQuoteChanged.Set(True)
	f.Intrinsic.Control.EndIf
f.Intrinsic.Control.EndIf

f.Intrinsic.Control.If(v.DataTable.dtQuote.RowCount,>,0)
	V.Local.fTotal.Set(0)
	V.Local.fTotalCust.Set(0)
	f.Intrinsic.Control.For(v.Local.i1,0,v.DataTable.dtQuote.RowCount--,1)
		'Get Tax 1 Amount
		f.Intrinsic.Control.If(v.DataTable.dtQuote(v.Local.i1).Tax_Apply_1!FieldValTrim,=,"Y")
			f.Intrinsic.String.Build("SELECT RATE FROM V_AR_TAX_TABLES WHERE ZONE = '{0}' AND AUTH = '{1}'",v.DataTable.dtQuote(v.Local.i1).Tax_Zone_1!FieldValTrim, v.DataTable.dtQuote(v.Local.i1).Tax_1!FieldValTrim, v.Local.sSQL)
			f.ODBC.Connection!con.ExecuteAndReturn(v.Local.sSQL,v.Local.fRate)
			f.Intrinsic.Math.Mult(v.DataTable.dtQuote(v.Local.i1).Extension!FieldValFloat,v.Local.fRate,v.Local.fTax)
			f.Intrinsic.Math.Round(v.Local.fTax,2,v.Local.fTax)
			f.Intrinsic.Math.Add(v.Local.fTotal, v.Local.fTax, v.Local.fTotal)
			f.Intrinsic.Math.Mult(v.DataTable.dtQuote(v.Local.i1).Extension_Quote!FieldValFloat,v.Local.fRate,v.Local.fTax)
			f.Intrinsic.Math.Round(v.Local.fTax,2,v.Local.fTax)
			f.Intrinsic.Math.Add(v.Local.fTotalCust, v.Local.fTax, v.Local.fTotalCust)			
		f.Intrinsic.Control.EndIf
		
		'Get Tax 2 Amount
		f.Intrinsic.Control.If(v.DataTable.dtQuote(v.Local.i1).Tax_Apply_2!FieldValTrim,=,"Y")
			f.Intrinsic.String.Build("SELECT RATE FROM V_AR_TAX_TABLES WHERE ZONE = '{0}' AND AUTH = '{1}'",v.DataTable.dtQuote(v.Local.i1).Tax_Zone_2!FieldValTrim, v.DataTable.dtQuote(v.Local.i1).Tax_2!FieldValTrim, v.Local.sSQL)
			f.ODBC.Connection!con.ExecuteAndReturn(v.Local.sSQL,v.Local.fRate)
			f.Intrinsic.Math.Mult(v.DataTable.dtQuote(v.Local.i1).Extension!FieldValFloat,v.Local.fRate,v.Local.fTax)
			f.Intrinsic.Math.Round(v.Local.fTax,2,v.Local.fTax)
			f.Intrinsic.Math.Add(v.Local.fTotal, v.Local.fTax, v.Local.fTotal)
			f.Intrinsic.Math.Mult(v.DataTable.dtQuote(v.Local.i1).Extension_Quote!FieldValFloat,v.Local.fRate,v.Local.fTax)
			f.Intrinsic.Math.Round(v.Local.fTax,2,v.Local.fTax)
			f.Intrinsic.Math.Add(v.Local.fTotalCust, v.Local.fTax, v.Local.fTotalCust)			
		f.Intrinsic.Control.EndIf
		
		'Get Tax 3 Amount
		f.Intrinsic.Control.If(v.DataTable.dtQuote(v.Local.i1).Tax_Apply_3!FieldValTrim,=,"Y")
			f.Intrinsic.String.Build("SELECT RATE FROM V_AR_TAX_TABLES WHERE ZONE = '{0}' AND AUTH = '{1}'",v.DataTable.dtQuote(v.Local.i1).Tax_Zone_3!FieldValTrim, v.DataTable.dtQuote(v.Local.i1).Tax_3!FieldValTrim, v.Local.sSQL)
			f.ODBC.Connection!con.ExecuteAndReturn(v.Local.sSQL,v.Local.fRate)
			f.Intrinsic.Math.Mult(v.DataTable.dtQuote(v.Local.i1).Extension!FieldValFloat,v.Local.fRate,v.Local.fTax)
			f.Intrinsic.Math.Round(v.Local.fTax,2,v.Local.fTax)
			f.Intrinsic.Math.Add(v.Local.fTotal, v.Local.fTax, v.Local.fTotal)
			f.Intrinsic.Math.Mult(v.DataTable.dtQuote(v.Local.i1).Extension_Quote!FieldValFloat,v.Local.fRate,v.Local.fTax)
			f.Intrinsic.Math.Round(v.Local.fTax,2,v.Local.fTax)
			f.Intrinsic.Math.Add(v.Local.fTotalCust, v.Local.fTax, v.Local.fTotalCust)			
		f.Intrinsic.Control.EndIf

		'Get Tax 4 Amount
		f.Intrinsic.Control.If(v.DataTable.dtQuote(v.Local.i1).Tax_Apply_4!FieldValTrim,=,"Y")
			f.Intrinsic.String.Build("SELECT RATE FROM V_AR_TAX_TABLES WHERE ZONE = '{0}' AND AUTH = '{1}'",v.DataTable.dtQuote(v.Local.i1).Tax_Zone_4!FieldValTrim, v.DataTable.dtQuote(v.Local.i1).Tax_4!FieldValTrim, v.Local.sSQL)
			f.ODBC.Connection!con.ExecuteAndReturn(v.Local.sSQL,v.Local.fRate)
			f.Intrinsic.Math.Mult(v.DataTable.dtQuote(v.Local.i1).Extension!FieldValFloat,v.Local.fRate,v.Local.fTax)
			f.Intrinsic.Math.Round(v.Local.fTax,2,v.Local.fTax)
			f.Intrinsic.Math.Add(v.Local.fTotal, v.Local.fTax, v.Local.fTotal)
			f.Intrinsic.Math.Mult(v.DataTable.dtQuote(v.Local.i1).Extension_Quote!FieldValFloat,v.Local.fRate,v.Local.fTax)
			f.Intrinsic.Math.Round(v.Local.fTax,2,v.Local.fTax)
			f.Intrinsic.Math.Add(v.Local.fTotalCust, v.Local.fTax, v.Local.fTotalCust)			
		f.Intrinsic.Control.EndIf
		
		'Get Tax 5 Amount
		f.Intrinsic.Control.If(v.DataTable.dtQuote(v.Local.i1).Tax_Apply_5!FieldValTrim,=,"Y")
			f.Intrinsic.String.Build("SELECT RATE FROM V_AR_TAX_TABLES WHERE ZONE = '{0}' AND AUTH = '{1}'",v.DataTable.dtQuote(v.Local.i1).Tax_Zone_5!FieldValTrim, v.DataTable.dtQuote(v.Local.i1).Tax_5!FieldValTrim, v.Local.sSQL)
			f.ODBC.Connection!con.ExecuteAndReturn(v.Local.sSQL,v.Local.fRate)
			f.Intrinsic.Math.Mult(v.DataTable.dtQuote(v.Local.i1).Extension!FieldValFloat,v.Local.fRate,v.Local.fTax)
			f.Intrinsic.Math.Round(v.Local.fTax,2,v.Local.fTax)
			f.Intrinsic.Math.Add(v.Local.fTotal, v.Local.fTax, v.Local.fTotal)
			f.Intrinsic.Math.Mult(v.DataTable.dtQuote(v.Local.i1).Extension_Quote!FieldValFloat,v.Local.fRate,v.Local.fTax)
			f.Intrinsic.Math.Round(v.Local.fTax,2,v.Local.fTax)
			f.Intrinsic.Math.Add(v.Local.fTotalCust, v.Local.fTax, v.Local.fTotalCust)			
		f.Intrinsic.Control.EndIf
		
		'Get Tax 6 Amount
		f.Intrinsic.Control.If(v.DataTable.dtQuote(v.Local.i1).Tax_Apply_6!FieldValTrim,=,"Y")
			f.Intrinsic.String.Build("SELECT RATE FROM V_AR_TAX_TABLES WHERE ZONE = '{0}' AND AUTH = '{1}'",v.DataTable.dtQuote(v.Local.i1).Tax_Zone_6!FieldValTrim, v.DataTable.dtQuote(v.Local.i1).Tax_6!FieldValTrim, v.Local.sSQL)
			f.ODBC.Connection!con.ExecuteAndReturn(v.Local.sSQL,v.Local.fRate)
			f.Intrinsic.Math.Mult(v.DataTable.dtQuote(v.Local.i1).Extension!FieldValFloat,v.Local.fRate,v.Local.fTax)
			f.Intrinsic.Math.Round(v.Local.fTax,2,v.Local.fTax)
			f.Intrinsic.Math.Add(v.Local.fTotal, v.Local.fTax, v.Local.fTotal)
			f.Intrinsic.Math.Mult(v.DataTable.dtQuote(v.Local.i1).Extension_Quote!FieldValFloat,v.Local.fRate,v.Local.fTax)
			f.Intrinsic.Math.Round(v.Local.fTax,2,v.Local.fTax)
			f.Intrinsic.Math.Add(v.Local.fTotalCust, v.Local.fTax, v.Local.fTotalCust)			
		f.Intrinsic.Control.EndIf
		
		'Get Tax 7 Amount
		f.Intrinsic.Control.If(v.DataTable.dtQuote(v.Local.i1).Tax_Apply_7!FieldValTrim,=,"Y")
			f.Intrinsic.String.Build("SELECT RATE FROM V_AR_TAX_TABLES WHERE ZONE = '{0}' AND AUTH = '{1}'",v.DataTable.dtQuote(v.Local.i1).Tax_Zone_7!FieldValTrim, v.DataTable.dtQuote(v.Local.i1).Tax_7!FieldValTrim, v.Local.sSQL)
			f.ODBC.Connection!con.ExecuteAndReturn(v.Local.sSQL,v.Local.fRate)
			f.Intrinsic.Math.Mult(v.DataTable.dtQuote(v.Local.i1).Extension!FieldValFloat,v.Local.fRate,v.Local.fTax)
			f.Intrinsic.Math.Round(v.Local.fTax,2,v.Local.fTax)
			f.Intrinsic.Math.Add(v.Local.fTotal, v.Local.fTax, v.Local.fTotal)
			f.Intrinsic.Math.Mult(v.DataTable.dtQuote(v.Local.i1).Extension_Quote!FieldValFloat,v.Local.fRate,v.Local.fTax)
			f.Intrinsic.Math.Round(v.Local.fTax,2,v.Local.fTax)
			f.Intrinsic.Math.Add(v.Local.fTotalCust, v.Local.fTax, v.Local.fTotalCust)			
		f.Intrinsic.Control.EndIf
		
		'Get Tax 8 Amount
		f.Intrinsic.Control.If(v.DataTable.dtQuote(v.Local.i1).Tax_Apply_8!FieldValTrim,=,"Y")
			f.Intrinsic.String.Build("SELECT RATE FROM V_AR_TAX_TABLES WHERE ZONE = '{0}' AND AUTH = '{1}'",v.DataTable.dtQuote(v.Local.i1).Tax_Zone_8!FieldValTrim, v.DataTable.dtQuote(v.Local.i1).Tax_8!FieldValTrim, v.Local.sSQL)
			f.ODBC.Connection!con.ExecuteAndReturn(v.Local.sSQL,v.Local.fRate)
			f.Intrinsic.Math.Mult(v.DataTable.dtQuote(v.Local.i1).Extension!FieldValFloat,v.Local.fRate,v.Local.fTax)
			f.Intrinsic.Math.Round(v.Local.fTax,2,v.Local.fTax)
			f.Intrinsic.Math.Add(v.Local.fTotal, v.Local.fTax, v.Local.fTotal)
			f.Intrinsic.Math.Mult(v.DataTable.dtQuote(v.Local.i1).Extension_Quote!FieldValFloat,v.Local.fRate,v.Local.fTax)
			f.Intrinsic.Math.Round(v.Local.fTax,2,v.Local.fTax)
			f.Intrinsic.Math.Add(v.Local.fTotalCust, v.Local.fTax, v.Local.fTotalCust)			
		f.Intrinsic.Control.EndIf
		
		'Get Tax 9 Amount
		f.Intrinsic.Control.If(v.DataTable.dtQuote(v.Local.i1).Tax_Apply_9!FieldValTrim,=,"Y")
			f.Intrinsic.String.Build("SELECT RATE FROM V_AR_TAX_TABLES WHERE ZONE = '{0}' AND AUTH = '{1}'",v.DataTable.dtQuote(v.Local.i1).Tax_Zone_9!FieldValTrim, v.DataTable.dtQuote(v.Local.i1).Tax_9!FieldValTrim, v.Local.sSQL)
			f.ODBC.Connection!con.ExecuteAndReturn(v.Local.sSQL,v.Local.fRate)
			f.Intrinsic.Math.Mult(v.DataTable.dtQuote(v.Local.i1).Extension!FieldValFloat,v.Local.fRate,v.Local.fTax)
			f.Intrinsic.Math.Round(v.Local.fTax,2,v.Local.fTax)
			f.Intrinsic.Math.Add(v.Local.fTotal, v.Local.fTax, v.Local.fTotal)
			f.Intrinsic.Math.Mult(v.DataTable.dtQuote(v.Local.i1).Extension_Quote!FieldValFloat,v.Local.fRate,v.Local.fTax)
			f.Intrinsic.Math.Round(v.Local.fTax,2,v.Local.fTax)
			f.Intrinsic.Math.Add(v.Local.fTotalCust, v.Local.fTax, v.Local.fTotalCust)			
		f.Intrinsic.Control.EndIf
		
		'Get Tax 10 Amount
		f.Intrinsic.Control.If(v.DataTable.dtQuote(v.Local.i1).Tax_Apply_10!FieldValTrim,=,"Y")
			f.Intrinsic.String.Build("SELECT RATE FROM V_AR_TAX_TABLES WHERE ZONE = '{0}' AND AUTH = '{1}'",v.DataTable.dtQuote(v.Local.i1).Tax_Zone_10!FieldValTrim, v.DataTable.dtQuote(v.Local.i1).Tax_10!FieldValTrim, v.Local.sSQL)
			f.ODBC.Connection!con.ExecuteAndReturn(v.Local.sSQL,v.Local.fRate)
			f.Intrinsic.Math.Mult(v.DataTable.dtQuote(v.Local.i1).Extension!FieldValFloat,v.Local.fRate,v.Local.fTax)
			f.Intrinsic.Math.Round(v.Local.fTax,2,v.Local.fTax)
			f.Intrinsic.Math.Add(v.Local.fTotal, v.Local.fTax, v.Local.fTotal)
			f.Intrinsic.Math.Mult(v.DataTable.dtQuote(v.Local.i1).Extension_Quote!FieldValFloat,v.Local.fRate,v.Local.fTax)
			f.Intrinsic.Math.Round(v.Local.fTax,2,v.Local.fTax)
			f.Intrinsic.Math.Add(v.Local.fTotalCust, v.Local.fTax, v.Local.fTotalCust)			
		f.Intrinsic.Control.EndIf
		
		f.Intrinsic.Math.Add(v.DataTable.dtQuote(v.Local.i1).Extension!FieldValFloat, v.Local.fTotal, v.Local.fTotal)
		f.Intrinsic.Control.If(v.DataTable.dtQuote(v.Local.i1).QUOTE_CURR_CD!FieldValTrim,=,v.Local.sCurrCo)
			v.Local.fTotalCust.Set(0.00)
		f.Intrinsic.Control.Else
			f.Intrinsic.Math.Add(v.DataTable.dtQuote(v.Local.i1).Extension_Quote!FieldValFloat, v.Local.fTotalCust, v.Local.fTotalCust)
		f.Intrinsic.Control.EndIf
		
		'Checked & Compare the Quote Line data if no change is detected yet
		f.Intrinsic.Control.If(v.Local.bQuoteChanged.Not)
			f.Intrinsic.Control.If(v.DataTable.dtOriginalQuoteLines.Exists)
				f.Intrinsic.String.Build("RECORD_NO = '{0}'",v.DataTable.dtQuote(v.Local.i1).RECORD_NO!FieldValTrim,v.Local.sFilter)
				f.Data.DataTable.Select("dtOriginalQuoteLines",v.Local.sFilter,v.Local.sRet)
				f.Intrinsic.Control.If(v.Local.sRet,=,"***NORETURN***")
					v.Local.bQuoteChanged.Set(True)
				f.Intrinsic.Control.Else
					f.Intrinsic.String.Split(v.Local.sRet,"*!*",v.Local.sRet)
					v.Local.iRowIndex.Set(v.Local.sRet(0).Long)
					f.Intrinsic.Control.If(v.DataTable.dtQuote(v.Local.i1).PART!FieldValTrim,<>,v.DataTable.dtOriginalQuoteLines(v.Local.iRowIndex).PART!FieldValTrim)
						v.Local.bQuoteChanged.Set(True)
					f.Intrinsic.Control.ElseIf(v.DataTable.dtQuote(v.Local.i1).QTY_QUOTED!FieldValFloat,<>,v.DataTable.dtOriginalQuoteLines(v.Local.iRowIndex).QTY_QUOTED!FieldValFloat)
						v.Local.bQuoteChanged.Set(True)
					f.Intrinsic.Control.ElseIf(v.DataTable.dtQuote(v.Local.i1).PRICE!FieldValFloat,<>,v.DataTable.dtOriginalQuoteLines(v.Local.iRowIndex).PRICE!FieldValFloat)
						v.Local.bQuoteChanged.Set(True)
					f.Intrinsic.Control.ElseIf(v.DataTable.dtQuote(v.Local.i1).AMT_DISCOUNT!FieldValFloat,<>,v.DataTable.dtOriginalQuoteLines(v.Local.iRowIndex).AMT_DISCOUNT!FieldValFloat)
						v.Local.bQuoteChanged.Set(True)
					f.Intrinsic.Control.EndIf
				f.Intrinsic.Control.EndIf
			f.Intrinsic.Control.EndIf
		f.Intrinsic.Control.EndIf
		
		'Calculate the Disc Pct for the Quote Line
		'Set it as the Max Disc Pct for the Quote if it is greater than the Max Disc Pct
		f.Intrinsic.Math.Mult(v.DataTable.dtQuote(v.Local.i1).QTY_QUOTED!FieldValFloat,v.DataTable.dtQuote(v.Local.i1).PRICE!FieldValFloat,v.Local.fTotalAmtQuoteLine)
		f.Intrinsic.Control.If(v.Local.fTotalAmtQuoteLine,>,0)
			f.Intrinsic.Math.Div(v.DataTable.dtQuote(v.Local.i1).AMT_DISCOUNT!FieldValFloat,v.Local.fTotalAmtQuoteLine,v.Local.fDiscPct)
			f.Intrinsic.Math.Round(v.Local.fDiscPct,4,v.Local.fDiscPct)
			f.Intrinsic.Math.Abs(v.Local.fDiscPct,v.Local.fDiscPct)
			f.Intrinsic.Control.If(v.Local.fMaxDiscPct,<,v.Local.fDiscPct)
				v.Local.fMaxDiscPct.Set(v.Local.fDiscPct)
			f.Intrinsic.Control.EndIf
		f.Intrinsic.Control.EndIf
	f.Intrinsic.Control.Next(v.Local.i1)
	
f.Intrinsic.Control.Else
	f.Intrinsic.Control.ExitSub
f.Intrinsic.Control.EndIf

f.Intrinsic.String.Build("SELECT * FROM GAB_6555_APRVL WHERE QUOTE_NO = '{0}';",v.Global.sQuote,v.Local.sSQL)
f.Data.DataTable.CreateFromSQL("dtGAB","con",v.Local.sSQL,True)
f.Intrinsic.Control.If(v.DataTable.dtGAB.RowCount,=,0)
	f.Intrinsic.Control.If(v.Local.fMaxDiscPct,=,0)
		'Automatically approved the Quote because there is no Discount in the Quote lines
		f.Intrinsic.String.Build("insert into GAB_6555_APRVL(QUOTE_NO, DATE_QUOTE, CUSTOMER, CUST_AMOUNT, AMOUNT, MAX_DISCOUNT, DATE_DUE, ORIGINATOR, APPROVER, APPROVED_DATE) values('{0}', '{1}', '{2}', {3}, {4}, {5}, '{6}', '{7}', 'SYSTEM', NOW());",v.Global.sQuote, v.DataTable.dtQuote(0).Date_Quote!FieldValPervasiveDate, v.DataTable.dtQuote(0).Customer!FieldValTrim, v.Local.fTotalCust, v.Local.fTotal, v.Local.fMaxDiscPct, v.DataTable.dtQuote(0).Date_Due!FieldValPervasiveDate, v.Caller.User.Trim,  v.Local.sSQL)
	f.Intrinsic.Control.Else
		f.Intrinsic.String.Build("insert into GAB_6555_APRVL(QUOTE_NO, DATE_QUOTE, CUSTOMER, CUST_AMOUNT, AMOUNT, MAX_DISCOUNT, DATE_DUE, ORIGINATOR) values('{0}', '{1}', '{2}', {3}, {4}, {5}, '{6}', '{7}');",v.Global.sQuote, v.DataTable.dtQuote(0).Date_Quote!FieldValPervasiveDate, v.DataTable.dtQuote(0).Customer!FieldValTrim, v.Local.fTotalCust, v.Local.fTotal, v.Local.fMaxDiscPct, v.DataTable.dtQuote(0).Date_Due!FieldValPervasiveDate, v.Caller.User.Trim, v.Local.sSQL)
		'Send email to approvers
'		f.Intrinsic.Control.CallSub(SendEmail,"Customer",v.DataTable.dtQuote(0).Customer!FieldValTrim,"MaxDiscPct",v.Local.fMaxDiscPct)
	f.Intrinsic.Control.EndIf
f.Intrinsic.Control.ElseIf(v.DataTable.dtGAB.RowCount,>,0)
	f.Intrinsic.Control.If(v.Local.bQuoteChanged)		
		f.Intrinsic.Control.If(v.Local.fMaxDiscPct,=,0)
			'Automatically approved the Quote because there is no Discount in the Quote lines
			f.Intrinsic.String.Build("update GAB_6555_APRVL set DATE_QUOTE = '{1}', Cust_Amount = {2}, Amount = {3}, MAX_DISCOUNT = {4}, DATE_DUE = '{5}', Approver = 'SYSTEM', APPROVED_DATE = NOW() where Quote_No = '{0}'",v.Global.sQuote, v.DataTable.dtQuote(0).Date_Quote!FieldValPervasiveDate, v.Local.fTotalCust, v.Local.fTotal, v.Local.fMaxDiscPct, v.DataTable.dtQuote(0).Date_Due!FieldValPervasiveDate, v.Local.sSQL)
		f.Intrinsic.Control.Else
			f.Intrinsic.String.Build("update GAB_6555_APRVL set DATE_QUOTE = '{1}', Cust_Amount = {2}, Amount = {3}, MAX_DISCOUNT = {4}, DATE_DUE = '{5}', Approver = '*REVISE*', APPROVED_DATE = NULL where Quote_No = '{0}'",v.Global.sQuote, v.DataTable.dtQuote(0).Date_Quote!FieldValPervasiveDate, v.Local.fTotalCust, v.Local.fTotal, v.Local.fMaxDiscPct, v.DataTable.dtQuote(0).Date_Due!FieldValPervasiveDate, v.Local.sSQL)
			'Send email to approvers
'			f.Intrinsic.Control.CallSub(SendEmail,"Customer",v.DataTable.dtQuote(0).Customer!FieldValTrim,"MaxDiscPct",v.Local.fMaxDiscPct)
		f.Intrinsic.Control.EndIf
	f.Intrinsic.Control.EndIf
f.Intrinsic.Control.EndIf
f.ODBC.Connection!con.Execute(v.Local.sSQL)

f.Intrinsic.Control.If(v.DataTable.dtOriginalQuoteLines.Exists)
	f.Data.DataTable.Close("dtOriginalQuoteLines")
f.Intrinsic.Control.EndIf

f.Intrinsic.Control.If(v.DataTable.dtQuote.Exists)
	f.Data.DataTable.Close("dtQuote")
f.Intrinsic.Control.EndIf

f.Intrinsic.Control.If(v.DataTable.dtGAB.Exists)
	f.Data.DataTable.Close("dtGAB")
f.Intrinsic.Control.EndIf

Program.Sub.Hook10532.End

Program.Sub.Hook10950.Start
v.Local.sSQL.Declare
v.Local.sDate.Declare
v.Local.sFileName.Declare
v.Local.sFile.Declare
v.Local.fAmount.Declare
v.Local.sTemp.Declare
v.Local.i1.Declare
v.Local.fRate.Declare
v.Local.fTax.Declare
v.Local.fTotal.Declare
v.Local.fTotalCust.Declare
v.Local.sSplitString.Declare
v.Local.sQuoteHeader.Declare
v.Local.sQuoteHeaderInfo.Declare
v.Local.sQuoteLine.Declare
v.Local.sQuoteLineInfo.Declare
v.Local.bQuoteChanged.Declare
v.Local.sFilter.Declare
v.Local.sRet.Declare
v.Local.iRowIndex.Declare
v.Local.fMaxDiscPct.Declare
v.Local.fDiscPct.Declare
v.Local.fTotalAmtQuoteLine.Declare
v.Local.sCurrCo.Declare
V.Local.sTempValue.Declare
v.Local.bExists.Declare

f.Intrinsic.String.LPad(v.Passed.000003,"0",7,v.Global.sQuote)
f.Intrinsic.String.Format(v.Ambient.Date,"YYYYMMDD",v.Local.sDate)
f.Intrinsic.String.Concat(v.System.Temp,"\GSS\GAB_6555_",v.Caller.User.Trim,"_",v.Local.sDate,".txt",v.Local.sFileName)
f.Intrinsic.File.Exists(v.Local.sFileName,v.Local.bExists)
f.Intrinsic.Control.If(v.Local.bExists)
	f.Intrinsic.File.File2String(v.Local.sFileName,v.Local.sFile)
	
	'The temp file will look like this
	'QUOTE_NO*!*RECORD_NO*!*PART*!*QTY*!*PRICE*!*AMT_DISCOUNT#!#
	'0000017*!*0010*!*3000-A*!*10*!*9.0909*!*-27.27
	'0000017*!*0020*!*8X10STGNK*!*2*!*90.909*!*-18.18
	'&!&QUOTE_NO*!*AMT_TOTAL#!#
	'0000017*!*243.18
	
	'Split the Quote Header and Quote Line
	f.Intrinsic.String.Build("{0}{1}",v.Ambient.NewLine,"&!&",v.Local.sSplitString)
	f.Intrinsic.String.Split(v.Local.sFile,v.Local.sSplitString,v.Local.sFile)
	
	'0 is Quote Line, 1 is Quote Header
	'Process Quote Header
	f.Intrinsic.String.Build("{0}{1}","#!#",v.Ambient.NewLine,v.Local.sSplitString)
	f.Intrinsic.String.Split(v.Local.sFile(1),v.Local.sSplitString,v.Local.sQuoteHeader)
	'The first line is the Quote Header Column Title
	'The second line is the Quote Header information
	f.Intrinsic.String.Split(v.Local.sQuoteHeader(1),"*!*",v.Local.sQuoteHeaderInfo)
	f.Intrinsic.Math.ConvertToFloat(v.Local.sQuoteHeaderInfo(1),v.Local.fAmount)
	
	'Process Quote Line
	f.Intrinsic.String.Build("{0}{1}","#!#",v.Ambient.NewLine,v.Local.sSplitString)
	f.Intrinsic.String.Split(v.Local.sFile(0),v.Local.sSplitString,v.Local.sQuoteLine)
	
	'Convert to Datatable if the Quote Line exists
	f.Intrinsic.Control.If(v.Local.sQuoteLine(1).Trim,<>,"")
		f.Data.DataTable.CreateFromString("dtOriginalQuoteLines",v.Local.sQuoteLine(1),v.Local.sQuoteLine(0),"String*!*String*!*String*!*Float*!*Float*!*Float","*!*",v.Ambient.NewLine,True)
	f.Intrinsic.Control.Else
		f.Data.DataTable.Create("dtOriginalQuoteLines",True)
	f.Intrinsic.Control.EndIf
f.Intrinsic.Control.EndIf

'f.Intrinsic.String.Build("SELECT A.CUSTOMER, B.DATE_QUOTE, B.DATE_DUE, A.RECORD_NO, A.PART, A.QTY_QUOTED, A.PRICE, A.AMT_DISCOUNT, A.Extension, A.Extension_Quote, A.Tax_1, A.Tax_2, A.Tax_3, A.Tax_4, A.Tax_5, A.Tax_6, A.Tax_7, A.Tax_8, A.Tax_9, A.Tax_10, A.Tax_Apply_1, A.Tax_Apply_2, A.Tax_Apply_3, A.Tax_Apply_4, A.Tax_Apply_5, A.Tax_Apply_6, A.Tax_Apply_7, A.Tax_Apply_8, A.Tax_Apply_9, A.Tax_Apply_10, A.Tax_Zone_1, A.Tax_Zone_2, A.Tax_Zone_3, A.Tax_Zone_4, A.Tax_Zone_5, A.Tax_Zone_6, A.Tax_Zone_7, A.Tax_Zone_8, A.Tax_Zone_9, A.Tax_Zone_10 FROM V_QUOTE_LINES A LEFT JOIN V_QUOTE_HEADER B ON A.QUOTE_NO = B.QUOTE_NO WHERE A.QUOTE_NO='{0}' order by A.QUOTE_NO, A.RECORD_NO;",v.Global.sQuote,v.Local.sSQL)
f.Intrinsic.String.Build("SELECT A.QUOTE_CURR_CD, A.CUSTOMER, B.DATE_QUOTE, B.DATE_DUE, A.RECORD_NO, A.PART, A.QTY_QUOTED, A.PRICE, A.AMT_DISCOUNT, A.Extension, A.Extension_Quote, A.Tax_1, A.Tax_2, A.Tax_3, A.Tax_4, A.Tax_5, A.Tax_6, A.Tax_7, A.Tax_8, A.Tax_9, A.Tax_10, A.Tax_Apply_1, A.Tax_Apply_2, A.Tax_Apply_3, A.Tax_Apply_4, A.Tax_Apply_5, A.Tax_Apply_6, A.Tax_Apply_7, A.Tax_Apply_8, A.Tax_Apply_9, A.Tax_Apply_10, A.Tax_Zone_1, A.Tax_Zone_2, A.Tax_Zone_3, A.Tax_Zone_4, A.Tax_Zone_5, A.Tax_Zone_6, A.Tax_Zone_7, A.Tax_Zone_8, A.Tax_Zone_9, A.Tax_Zone_10 FROM V_QUOTE_LINES A LEFT JOIN V_QUOTE_HEADER B ON A.QUOTE_NO = B.QUOTE_NO WHERE A.QUOTE_NO='{0}' order by A.QUOTE_NO, A.RECORD_NO;",v.Global.sQuote,v.Local.sSQL)
f.Data.DataTable.CreateFromSQL("dtQuote","con",v.Local.sSQL,True)

'Get Base Currency
F.Global.General.ReadOption("000000",1,"","0000",V.Local.sCurrCo)

v.Local.bQuoteChanged.Set(False)

'If the total quote lines are different then there are changes to the Quote Lines
f.Intrinsic.Control.If(v.DataTable.dtOriginalQuoteLines.Exists)
	f.Intrinsic.Control.If(v.DataTable.dtOriginalQuoteLines.RowCount,<>,v.DataTable.dtQuote.RowCount)
		v.Local.bQuoteChanged.Set(True)
	f.Intrinsic.Control.EndIf
f.Intrinsic.Control.EndIf

f.Intrinsic.Control.If(v.DataTable.dtQuote.RowCount,>,0)
	V.Local.fTotal.Set(0)
	V.Local.fTotalCust.Set(0)
	f.Intrinsic.Control.For(v.Local.i1,0,v.DataTable.dtQuote.RowCount--,1)
		'Get Tax 1 Amount
		f.Intrinsic.Control.If(v.DataTable.dtQuote(v.Local.i1).Tax_Apply_1!FieldValTrim,=,"Y")
			f.Intrinsic.String.Build("SELECT RATE FROM V_AR_TAX_TABLES WHERE ZONE = '{0}' AND AUTH = '{1}'",v.DataTable.dtQuote(v.Local.i1).Tax_Zone_1!FieldValTrim, v.DataTable.dtQuote(v.Local.i1).Tax_1!FieldValTrim, v.Local.sSQL)
			f.ODBC.Connection!con.ExecuteAndReturn(v.Local.sSQL,v.Local.fRate)
			f.Intrinsic.Math.Mult(v.DataTable.dtQuote(v.Local.i1).Extension!FieldValFloat,v.Local.fRate,v.Local.fTax)
			f.Intrinsic.Math.Round(v.Local.fTax,2,v.Local.fTax)
			f.Intrinsic.Math.Add(v.Local.fTotal, v.Local.fTax, v.Local.fTotal)
			f.Intrinsic.Math.Mult(v.DataTable.dtQuote(v.Local.i1).Extension_Quote!FieldValFloat,v.Local.fRate,v.Local.fTax)
			f.Intrinsic.Math.Round(v.Local.fTax,2,v.Local.fTax)
			f.Intrinsic.Math.Add(v.Local.fTotalCust, v.Local.fTax, v.Local.fTotalCust)			
		f.Intrinsic.Control.EndIf
		
		'Get Tax 2 Amount
		f.Intrinsic.Control.If(v.DataTable.dtQuote(v.Local.i1).Tax_Apply_2!FieldValTrim,=,"Y")
			f.Intrinsic.String.Build("SELECT RATE FROM V_AR_TAX_TABLES WHERE ZONE = '{0}' AND AUTH = '{1}'",v.DataTable.dtQuote(v.Local.i1).Tax_Zone_2!FieldValTrim, v.DataTable.dtQuote(v.Local.i1).Tax_2!FieldValTrim, v.Local.sSQL)
			f.ODBC.Connection!con.ExecuteAndReturn(v.Local.sSQL,v.Local.fRate)
			f.Intrinsic.Math.Mult(v.DataTable.dtQuote(v.Local.i1).Extension!FieldValFloat,v.Local.fRate,v.Local.fTax)
			f.Intrinsic.Math.Round(v.Local.fTax,2,v.Local.fTax)
			f.Intrinsic.Math.Add(v.Local.fTotal, v.Local.fTax, v.Local.fTotal)
			f.Intrinsic.Math.Mult(v.DataTable.dtQuote(v.Local.i1).Extension_Quote!FieldValFloat,v.Local.fRate,v.Local.fTax)
			f.Intrinsic.Math.Round(v.Local.fTax,2,v.Local.fTax)
			f.Intrinsic.Math.Add(v.Local.fTotalCust, v.Local.fTax, v.Local.fTotalCust)			
		f.Intrinsic.Control.EndIf
		
		'Get Tax 3 Amount
		f.Intrinsic.Control.If(v.DataTable.dtQuote(v.Local.i1).Tax_Apply_3!FieldValTrim,=,"Y")
			f.Intrinsic.String.Build("SELECT RATE FROM V_AR_TAX_TABLES WHERE ZONE = '{0}' AND AUTH = '{1}'",v.DataTable.dtQuote(v.Local.i1).Tax_Zone_3!FieldValTrim, v.DataTable.dtQuote(v.Local.i1).Tax_3!FieldValTrim, v.Local.sSQL)
			f.ODBC.Connection!con.ExecuteAndReturn(v.Local.sSQL,v.Local.fRate)
			f.Intrinsic.Math.Mult(v.DataTable.dtQuote(v.Local.i1).Extension!FieldValFloat,v.Local.fRate,v.Local.fTax)
			f.Intrinsic.Math.Round(v.Local.fTax,2,v.Local.fTax)
			f.Intrinsic.Math.Add(v.Local.fTotal, v.Local.fTax, v.Local.fTotal)
			f.Intrinsic.Math.Mult(v.DataTable.dtQuote(v.Local.i1).Extension_Quote!FieldValFloat,v.Local.fRate,v.Local.fTax)
			f.Intrinsic.Math.Round(v.Local.fTax,2,v.Local.fTax)
			f.Intrinsic.Math.Add(v.Local.fTotalCust, v.Local.fTax, v.Local.fTotalCust)			
		f.Intrinsic.Control.EndIf

		'Get Tax 4 Amount
		f.Intrinsic.Control.If(v.DataTable.dtQuote(v.Local.i1).Tax_Apply_4!FieldValTrim,=,"Y")
			f.Intrinsic.String.Build("SELECT RATE FROM V_AR_TAX_TABLES WHERE ZONE = '{0}' AND AUTH = '{1}'",v.DataTable.dtQuote(v.Local.i1).Tax_Zone_4!FieldValTrim, v.DataTable.dtQuote(v.Local.i1).Tax_4!FieldValTrim, v.Local.sSQL)
			f.ODBC.Connection!con.ExecuteAndReturn(v.Local.sSQL,v.Local.fRate)
			f.Intrinsic.Math.Mult(v.DataTable.dtQuote(v.Local.i1).Extension!FieldValFloat,v.Local.fRate,v.Local.fTax)
			f.Intrinsic.Math.Round(v.Local.fTax,2,v.Local.fTax)
			f.Intrinsic.Math.Add(v.Local.fTotal, v.Local.fTax, v.Local.fTotal)
			f.Intrinsic.Math.Mult(v.DataTable.dtQuote(v.Local.i1).Extension_Quote!FieldValFloat,v.Local.fRate,v.Local.fTax)
			f.Intrinsic.Math.Round(v.Local.fTax,2,v.Local.fTax)
			f.Intrinsic.Math.Add(v.Local.fTotalCust, v.Local.fTax, v.Local.fTotalCust)			
		f.Intrinsic.Control.EndIf
		
		'Get Tax 5 Amount
		f.Intrinsic.Control.If(v.DataTable.dtQuote(v.Local.i1).Tax_Apply_5!FieldValTrim,=,"Y")
			f.Intrinsic.String.Build("SELECT RATE FROM V_AR_TAX_TABLES WHERE ZONE = '{0}' AND AUTH = '{1}'",v.DataTable.dtQuote(v.Local.i1).Tax_Zone_5!FieldValTrim, v.DataTable.dtQuote(v.Local.i1).Tax_5!FieldValTrim, v.Local.sSQL)
			f.ODBC.Connection!con.ExecuteAndReturn(v.Local.sSQL,v.Local.fRate)
			f.Intrinsic.Math.Mult(v.DataTable.dtQuote(v.Local.i1).Extension!FieldValFloat,v.Local.fRate,v.Local.fTax)
			f.Intrinsic.Math.Round(v.Local.fTax,2,v.Local.fTax)
			f.Intrinsic.Math.Add(v.Local.fTotal, v.Local.fTax, v.Local.fTotal)
			f.Intrinsic.Math.Mult(v.DataTable.dtQuote(v.Local.i1).Extension_Quote!FieldValFloat,v.Local.fRate,v.Local.fTax)
			f.Intrinsic.Math.Round(v.Local.fTax,2,v.Local.fTax)
			f.Intrinsic.Math.Add(v.Local.fTotalCust, v.Local.fTax, v.Local.fTotalCust)			
		f.Intrinsic.Control.EndIf
		
		'Get Tax 6 Amount
		f.Intrinsic.Control.If(v.DataTable.dtQuote(v.Local.i1).Tax_Apply_6!FieldValTrim,=,"Y")
			f.Intrinsic.String.Build("SELECT RATE FROM V_AR_TAX_TABLES WHERE ZONE = '{0}' AND AUTH = '{1}'",v.DataTable.dtQuote(v.Local.i1).Tax_Zone_6!FieldValTrim, v.DataTable.dtQuote(v.Local.i1).Tax_6!FieldValTrim, v.Local.sSQL)
			f.ODBC.Connection!con.ExecuteAndReturn(v.Local.sSQL,v.Local.fRate)
			f.Intrinsic.Math.Mult(v.DataTable.dtQuote(v.Local.i1).Extension!FieldValFloat,v.Local.fRate,v.Local.fTax)
			f.Intrinsic.Math.Round(v.Local.fTax,2,v.Local.fTax)
			f.Intrinsic.Math.Add(v.Local.fTotal, v.Local.fTax, v.Local.fTotal)
			f.Intrinsic.Math.Mult(v.DataTable.dtQuote(v.Local.i1).Extension_Quote!FieldValFloat,v.Local.fRate,v.Local.fTax)
			f.Intrinsic.Math.Round(v.Local.fTax,2,v.Local.fTax)
			f.Intrinsic.Math.Add(v.Local.fTotalCust, v.Local.fTax, v.Local.fTotalCust)			
		f.Intrinsic.Control.EndIf
		
		'Get Tax 7 Amount
		f.Intrinsic.Control.If(v.DataTable.dtQuote(v.Local.i1).Tax_Apply_7!FieldValTrim,=,"Y")
			f.Intrinsic.String.Build("SELECT RATE FROM V_AR_TAX_TABLES WHERE ZONE = '{0}' AND AUTH = '{1}'",v.DataTable.dtQuote(v.Local.i1).Tax_Zone_7!FieldValTrim, v.DataTable.dtQuote(v.Local.i1).Tax_7!FieldValTrim, v.Local.sSQL)
			f.ODBC.Connection!con.ExecuteAndReturn(v.Local.sSQL,v.Local.fRate)
			f.Intrinsic.Math.Mult(v.DataTable.dtQuote(v.Local.i1).Extension!FieldValFloat,v.Local.fRate,v.Local.fTax)
			f.Intrinsic.Math.Round(v.Local.fTax,2,v.Local.fTax)
			f.Intrinsic.Math.Add(v.Local.fTotal, v.Local.fTax, v.Local.fTotal)
			f.Intrinsic.Math.Mult(v.DataTable.dtQuote(v.Local.i1).Extension_Quote!FieldValFloat,v.Local.fRate,v.Local.fTax)
			f.Intrinsic.Math.Round(v.Local.fTax,2,v.Local.fTax)
			f.Intrinsic.Math.Add(v.Local.fTotalCust, v.Local.fTax, v.Local.fTotalCust)			
		f.Intrinsic.Control.EndIf
		
		'Get Tax 8 Amount
		f.Intrinsic.Control.If(v.DataTable.dtQuote(v.Local.i1).Tax_Apply_8!FieldValTrim,=,"Y")
			f.Intrinsic.String.Build("SELECT RATE FROM V_AR_TAX_TABLES WHERE ZONE = '{0}' AND AUTH = '{1}'",v.DataTable.dtQuote(v.Local.i1).Tax_Zone_8!FieldValTrim, v.DataTable.dtQuote(v.Local.i1).Tax_8!FieldValTrim, v.Local.sSQL)
			f.ODBC.Connection!con.ExecuteAndReturn(v.Local.sSQL,v.Local.fRate)
			f.Intrinsic.Math.Mult(v.DataTable.dtQuote(v.Local.i1).Extension!FieldValFloat,v.Local.fRate,v.Local.fTax)
			f.Intrinsic.Math.Round(v.Local.fTax,2,v.Local.fTax)
			f.Intrinsic.Math.Add(v.Local.fTotal, v.Local.fTax, v.Local.fTotal)
			f.Intrinsic.Math.Mult(v.DataTable.dtQuote(v.Local.i1).Extension_Quote!FieldValFloat,v.Local.fRate,v.Local.fTax)
			f.Intrinsic.Math.Round(v.Local.fTax,2,v.Local.fTax)
			f.Intrinsic.Math.Add(v.Local.fTotalCust, v.Local.fTax, v.Local.fTotalCust)			
		f.Intrinsic.Control.EndIf
		
		'Get Tax 9 Amount
		f.Intrinsic.Control.If(v.DataTable.dtQuote(v.Local.i1).Tax_Apply_9!FieldValTrim,=,"Y")
			f.Intrinsic.String.Build("SELECT RATE FROM V_AR_TAX_TABLES WHERE ZONE = '{0}' AND AUTH = '{1}'",v.DataTable.dtQuote(v.Local.i1).Tax_Zone_9!FieldValTrim, v.DataTable.dtQuote(v.Local.i1).Tax_9!FieldValTrim, v.Local.sSQL)
			f.ODBC.Connection!con.ExecuteAndReturn(v.Local.sSQL,v.Local.fRate)
			f.Intrinsic.Math.Mult(v.DataTable.dtQuote(v.Local.i1).Extension!FieldValFloat,v.Local.fRate,v.Local.fTax)
			f.Intrinsic.Math.Round(v.Local.fTax,2,v.Local.fTax)
			f.Intrinsic.Math.Add(v.Local.fTotal, v.Local.fTax, v.Local.fTotal)
			f.Intrinsic.Math.Mult(v.DataTable.dtQuote(v.Local.i1).Extension_Quote!FieldValFloat,v.Local.fRate,v.Local.fTax)
			f.Intrinsic.Math.Round(v.Local.fTax,2,v.Local.fTax)
			f.Intrinsic.Math.Add(v.Local.fTotalCust, v.Local.fTax, v.Local.fTotalCust)			
		f.Intrinsic.Control.EndIf
		
		'Get Tax 10 Amount
		f.Intrinsic.Control.If(v.DataTable.dtQuote(v.Local.i1).Tax_Apply_10!FieldValTrim,=,"Y")
			f.Intrinsic.String.Build("SELECT RATE FROM V_AR_TAX_TABLES WHERE ZONE = '{0}' AND AUTH = '{1}'",v.DataTable.dtQuote(v.Local.i1).Tax_Zone_10!FieldValTrim, v.DataTable.dtQuote(v.Local.i1).Tax_10!FieldValTrim, v.Local.sSQL)
			f.ODBC.Connection!con.ExecuteAndReturn(v.Local.sSQL,v.Local.fRate)
			f.Intrinsic.Math.Mult(v.DataTable.dtQuote(v.Local.i1).Extension!FieldValFloat,v.Local.fRate,v.Local.fTax)
			f.Intrinsic.Math.Round(v.Local.fTax,2,v.Local.fTax)
			f.Intrinsic.Math.Add(v.Local.fTotal, v.Local.fTax, v.Local.fTotal)
			f.Intrinsic.Math.Mult(v.DataTable.dtQuote(v.Local.i1).Extension_Quote!FieldValFloat,v.Local.fRate,v.Local.fTax)
			f.Intrinsic.Math.Round(v.Local.fTax,2,v.Local.fTax)
			f.Intrinsic.Math.Add(v.Local.fTotalCust, v.Local.fTax, v.Local.fTotalCust)			
		f.Intrinsic.Control.EndIf
		
		f.Intrinsic.Math.Add(v.DataTable.dtQuote(v.Local.i1).Extension!FieldValFloat, v.Local.fTotal, v.Local.fTotal)
		f.Intrinsic.Control.If(v.DataTable.dtQuote(v.Local.i1).QUOTE_CURR_CD!FieldValTrim,=,v.Local.sCurrCo)
			v.Local.fTotalCust.Set(0.00)
		f.Intrinsic.Control.Else
			f.Intrinsic.Math.Add(v.DataTable.dtQuote(v.Local.i1).Extension_Quote!FieldValFloat, v.Local.fTotalCust, v.Local.fTotalCust)
		f.Intrinsic.Control.EndIf
		
		'Checked & Compare the Quote Line data if no change is detected yet
		f.Intrinsic.Control.If(v.Local.bQuoteChanged.Not)
			f.Intrinsic.Control.If(v.DataTable.dtOriginalQuoteLines.Exists)
				f.Intrinsic.String.Build("RECORD_NO = '{0}'",v.DataTable.dtQuote(v.Local.i1).RECORD_NO!FieldValTrim,v.Local.sFilter)
				f.Data.DataTable.Select("dtOriginalQuoteLines",v.Local.sFilter,v.Local.sRet)
				f.Intrinsic.Control.If(v.Local.sRet,=,"***NORETURN***")
					v.Local.bQuoteChanged.Set(True)
				f.Intrinsic.Control.Else
					f.Intrinsic.String.Split(v.Local.sRet,"*!*",v.Local.sRet)
					v.Local.iRowIndex.Set(v.Local.sRet(0).Long)
					f.Intrinsic.Control.If(v.DataTable.dtQuote(v.Local.i1).PART!FieldValTrim,<>,v.DataTable.dtOriginalQuoteLines(v.Local.iRowIndex).PART!FieldValTrim)
						v.Local.bQuoteChanged.Set(True)
					f.Intrinsic.Control.ElseIf(v.DataTable.dtQuote(v.Local.i1).QTY_QUOTED!FieldValFloat,<>,v.DataTable.dtOriginalQuoteLines(v.Local.iRowIndex).QTY_QUOTED!FieldValFloat)
						v.Local.bQuoteChanged.Set(True)
					f.Intrinsic.Control.ElseIf(v.DataTable.dtQuote(v.Local.i1).PRICE!FieldValFloat,<>,v.DataTable.dtOriginalQuoteLines(v.Local.iRowIndex).PRICE!FieldValFloat)
						v.Local.bQuoteChanged.Set(True)
					f.Intrinsic.Control.ElseIf(v.DataTable.dtQuote(v.Local.i1).AMT_DISCOUNT!FieldValFloat,<>,v.DataTable.dtOriginalQuoteLines(v.Local.iRowIndex).AMT_DISCOUNT!FieldValFloat)
						v.Local.bQuoteChanged.Set(True)
					f.Intrinsic.Control.EndIf
				f.Intrinsic.Control.EndIf
			f.Intrinsic.Control.EndIf
		f.Intrinsic.Control.EndIf
		
		'Calculate the Disc Pct for the Quote Line
		'Set it as the Max Disc Pct for the Quote if it is greater than the Max Disc Pct
		f.Intrinsic.Math.Mult(v.DataTable.dtQuote(v.Local.i1).QTY_QUOTED!FieldValFloat,v.DataTable.dtQuote(v.Local.i1).PRICE!FieldValFloat,v.Local.fTotalAmtQuoteLine)
		f.Intrinsic.Control.If(v.Local.fTotalAmtQuoteLine,>,0)
			f.Intrinsic.Math.Div(v.DataTable.dtQuote(v.Local.i1).AMT_DISCOUNT!FieldValFloat,v.Local.fTotalAmtQuoteLine,v.Local.fDiscPct)
			f.Intrinsic.Math.Round(v.Local.fDiscPct,4,v.Local.fDiscPct)
			f.Intrinsic.Math.Abs(v.Local.fDiscPct,v.Local.fDiscPct)
			f.Intrinsic.Control.If(v.Local.fMaxDiscPct,<,v.Local.fDiscPct)
				v.Local.fMaxDiscPct.Set(v.Local.fDiscPct)
			f.Intrinsic.Control.EndIf
		f.Intrinsic.Control.EndIf
	f.Intrinsic.Control.Next(v.Local.i1)
f.Intrinsic.Control.Else
'	f.Intrinsic.UI.Msgbox("This Quote is not added into quote approval. Please add at least one quote line.","Quote Approval (6555)")
	f.Intrinsic.Control.If(V.Local.bQuoteChanged)
		f.Intrinsic.File.Exists(v.Local.sFileName,v.Local.bExists)
		f.Intrinsic.Control.If(v.Local.bExists,=,True)
			f.Intrinsic.File.DeleteFile(v.Local.sFileName)
		f.Intrinsic.Control.EndIf
		
		f.Intrinsic.Control.If(v.DataTable.dtQuote.Exists)
			f.Data.DataTable.Close("dtQuote")
		f.Intrinsic.Control.EndIf
		
		f.Intrinsic.String.Build("SELECT A.CUSTOMER, B.DATE_QUOTE, B.DATE_DUE, A.RECORD_NO, A.PART, A.QTY_QUOTED, A.PRICE, A.AMT_DISCOUNT, A.Extension, A.Extension_Quote, A.Tax_1, A.Tax_2, A.Tax_3, A.Tax_4, A.Tax_5, A.Tax_6, A.Tax_7, A.Tax_8, A.Tax_9, A.Tax_10, A.Tax_Apply_1, A.Tax_Apply_2, A.Tax_Apply_3, A.Tax_Apply_4, A.Tax_Apply_5, A.Tax_Apply_6, A.Tax_Apply_7, A.Tax_Apply_8, A.Tax_Apply_9, A.Tax_Apply_10, A.Tax_Zone_1, A.Tax_Zone_2, A.Tax_Zone_3, A.Tax_Zone_4, A.Tax_Zone_5, A.Tax_Zone_6, A.Tax_Zone_7, A.Tax_Zone_8, A.Tax_Zone_9, A.Tax_Zone_10 FROM V_QUOTE_LINES A LEFT JOIN V_QUOTE_HEADER B ON A.QUOTE_NO = B.QUOTE_NO WHERE A.QUOTE_NO='{0}' ORDER BY A.QUOTE_NO, A.RECORD_NO;",v.Global.sQuote,v.Local.sSQL)
		f.Data.DataTable.CreateFromSQL("dtQuote","con",v.Local.sSQL,True)
		f.Intrinsic.Control.If(v.DataTable.dtQuote.RowCount,>,0)
			V.Local.fTotal.Set(0)
			f.Intrinsic.Control.For(v.Local.i1,0,v.DataTable.dtQuote.RowCount--,1)
				'Get Tax 1 Amount
				f.Intrinsic.Control.If(v.DataTable.dtQuote(v.Local.i1).Tax_Apply_1!FieldValTrim,=,"Y")
					f.Intrinsic.String.Build("SELECT RATE FROM V_AR_TAX_TABLES WHERE ZONE = '{0}' AND AUTH = '{1}'",v.DataTable.dtQuote(v.Local.i1).Tax_Zone_1!FieldValTrim, v.DataTable.dtQuote(v.Local.i1).Tax_1!FieldValTrim, v.Local.sSQL)
					f.ODBC.Connection!con.ExecuteAndReturn(v.Local.sSQL,v.Local.fRate)
					f.Intrinsic.Math.Mult(v.DataTable.dtQuote(v.Local.i1).Extension!FieldValFloat,v.Local.fRate,v.Local.fTax)
					f.Intrinsic.Math.Round(v.Local.fTax,2,v.Local.fTax)
					f.Intrinsic.Math.Add(v.Local.fTotal, v.Local.fTax, v.Local.fTotal)
				f.Intrinsic.Control.EndIf
				
				'Get Tax 2 Amount
				f.Intrinsic.Control.If(v.DataTable.dtQuote(v.Local.i1).Tax_Apply_2!FieldValTrim,=,"Y")
					f.Intrinsic.String.Build("SELECT RATE FROM V_AR_TAX_TABLES WHERE ZONE = '{0}' AND AUTH = '{1}'",v.DataTable.dtQuote(v.Local.i1).Tax_Zone_2!FieldValTrim, v.DataTable.dtQuote(v.Local.i1).Tax_2!FieldValTrim, v.Local.sSQL)
					f.ODBC.Connection!con.ExecuteAndReturn(v.Local.sSQL,v.Local.fRate)
					f.Intrinsic.Math.Mult(v.DataTable.dtQuote(v.Local.i1).Extension!FieldValFloat,v.Local.fRate,v.Local.fTax)
					f.Intrinsic.Math.Round(v.Local.fTax,2,v.Local.fTax)
					f.Intrinsic.Math.Add(v.Local.fTotal, v.Local.fTax, v.Local.fTotal)
				f.Intrinsic.Control.EndIf
				
				'Get Tax 3 Amount
				f.Intrinsic.Control.If(v.DataTable.dtQuote(v.Local.i1).Tax_Apply_3!FieldValTrim,=,"Y")
					f.Intrinsic.String.Build("SELECT RATE FROM V_AR_TAX_TABLES WHERE ZONE = '{0}' AND AUTH = '{1}'",v.DataTable.dtQuote(v.Local.i1).Tax_Zone_3!FieldValTrim, v.DataTable.dtQuote(v.Local.i1).Tax_3!FieldValTrim, v.Local.sSQL)
					f.ODBC.Connection!con.ExecuteAndReturn(v.Local.sSQL,v.Local.fRate)
					f.Intrinsic.Math.Mult(v.DataTable.dtQuote(v.Local.i1).Extension!FieldValFloat,v.Local.fRate,v.Local.fTax)
					f.Intrinsic.Math.Round(v.Local.fTax,2,v.Local.fTax)
					f.Intrinsic.Math.Add(v.Local.fTotal, v.Local.fTax, v.Local.fTotal)
				f.Intrinsic.Control.EndIf
		
				'Get Tax 4 Amount
				f.Intrinsic.Control.If(v.DataTable.dtQuote(v.Local.i1).Tax_Apply_4!FieldValTrim,=,"Y")
					f.Intrinsic.String.Build("SELECT RATE FROM V_AR_TAX_TABLES WHERE ZONE = '{0}' AND AUTH = '{1}'",v.DataTable.dtQuote(v.Local.i1).Tax_Zone_4!FieldValTrim, v.DataTable.dtQuote(v.Local.i1).Tax_4!FieldValTrim, v.Local.sSQL)
					f.ODBC.Connection!con.ExecuteAndReturn(v.Local.sSQL,v.Local.fRate)
					f.Intrinsic.Math.Mult(v.DataTable.dtQuote(v.Local.i1).Extension!FieldValFloat,v.Local.fRate,v.Local.fTax)
					f.Intrinsic.Math.Round(v.Local.fTax,2,v.Local.fTax)
					f.Intrinsic.Math.Add(v.Local.fTotal, v.Local.fTax, v.Local.fTotal)
				f.Intrinsic.Control.EndIf
				
				'Get Tax 5 Amount
				f.Intrinsic.Control.If(v.DataTable.dtQuote(v.Local.i1).Tax_Apply_5!FieldValTrim,=,"Y")
					f.Intrinsic.String.Build("SELECT RATE FROM V_AR_TAX_TABLES WHERE ZONE = '{0}' AND AUTH = '{1}'",v.DataTable.dtQuote(v.Local.i1).Tax_Zone_5!FieldValTrim, v.DataTable.dtQuote(v.Local.i1).Tax_5!FieldValTrim, v.Local.sSQL)
					f.ODBC.Connection!con.ExecuteAndReturn(v.Local.sSQL,v.Local.fRate)
					f.Intrinsic.Math.Mult(v.DataTable.dtQuote(v.Local.i1).Extension!FieldValFloat,v.Local.fRate,v.Local.fTax)
					f.Intrinsic.Math.Round(v.Local.fTax,2,v.Local.fTax)
					f.Intrinsic.Math.Add(v.Local.fTotal, v.Local.fTax, v.Local.fTotal)
				f.Intrinsic.Control.EndIf
				
				'Get Tax 6 Amount
				f.Intrinsic.Control.If(v.DataTable.dtQuote(v.Local.i1).Tax_Apply_6!FieldValTrim,=,"Y")
					f.Intrinsic.String.Build("SELECT RATE FROM V_AR_TAX_TABLES WHERE ZONE = '{0}' AND AUTH = '{1}'",v.DataTable.dtQuote(v.Local.i1).Tax_Zone_6!FieldValTrim, v.DataTable.dtQuote(v.Local.i1).Tax_6!FieldValTrim, v.Local.sSQL)
					f.ODBC.Connection!con.ExecuteAndReturn(v.Local.sSQL,v.Local.fRate)
					f.Intrinsic.Math.Mult(v.DataTable.dtQuote(v.Local.i1).Extension!FieldValFloat,v.Local.fRate,v.Local.fTax)
					f.Intrinsic.Math.Round(v.Local.fTax,2,v.Local.fTax)
					f.Intrinsic.Math.Add(v.Local.fTotal, v.Local.fTax, v.Local.fTotal)
				f.Intrinsic.Control.EndIf
				
				'Get Tax 7 Amount
				f.Intrinsic.Control.If(v.DataTable.dtQuote(v.Local.i1).Tax_Apply_7!FieldValTrim,=,"Y")
					f.Intrinsic.String.Build("SELECT RATE FROM V_AR_TAX_TABLES WHERE ZONE = '{0}' AND AUTH = '{1}'",v.DataTable.dtQuote(v.Local.i1).Tax_Zone_7!FieldValTrim, v.DataTable.dtQuote(v.Local.i1).Tax_7!FieldValTrim, v.Local.sSQL)
					f.ODBC.Connection!con.ExecuteAndReturn(v.Local.sSQL,v.Local.fRate)
					f.Intrinsic.Math.Mult(v.DataTable.dtQuote(v.Local.i1).Extension!FieldValFloat,v.Local.fRate,v.Local.fTax)
					f.Intrinsic.Math.Round(v.Local.fTax,2,v.Local.fTax)
					f.Intrinsic.Math.Add(v.Local.fTotal, v.Local.fTax, v.Local.fTotal)
				f.Intrinsic.Control.EndIf
				
				'Get Tax 8 Amount
				f.Intrinsic.Control.If(v.DataTable.dtQuote(v.Local.i1).Tax_Apply_8!FieldValTrim,=,"Y")
					f.Intrinsic.String.Build("SELECT RATE FROM V_AR_TAX_TABLES WHERE ZONE = '{0}' AND AUTH = '{1}'",v.DataTable.dtQuote(v.Local.i1).Tax_Zone_8!FieldValTrim, v.DataTable.dtQuote(v.Local.i1).Tax_8!FieldValTrim, v.Local.sSQL)
					f.ODBC.Connection!con.ExecuteAndReturn(v.Local.sSQL,v.Local.fRate)
					f.Intrinsic.Math.Mult(v.DataTable.dtQuote(v.Local.i1).Extension!FieldValFloat,v.Local.fRate,v.Local.fTax)
					f.Intrinsic.Math.Round(v.Local.fTax,2,v.Local.fTax)
					f.Intrinsic.Math.Add(v.Local.fTotal, v.Local.fTax, v.Local.fTotal)
				f.Intrinsic.Control.EndIf
				
				'Get Tax 9 Amount
				f.Intrinsic.Control.If(v.DataTable.dtQuote(v.Local.i1).Tax_Apply_9!FieldValTrim,=,"Y")
					f.Intrinsic.String.Build("SELECT RATE FROM V_AR_TAX_TABLES WHERE ZONE = '{0}' AND AUTH = '{1}'",v.DataTable.dtQuote(v.Local.i1).Tax_Zone_9!FieldValTrim, v.DataTable.dtQuote(v.Local.i1).Tax_9!FieldValTrim, v.Local.sSQL)
					f.ODBC.Connection!con.ExecuteAndReturn(v.Local.sSQL,v.Local.fRate)
					f.Intrinsic.Math.Mult(v.DataTable.dtQuote(v.Local.i1).Extension!FieldValFloat,v.Local.fRate,v.Local.fTax)
					f.Intrinsic.Math.Round(v.Local.fTax,2,v.Local.fTax)
					f.Intrinsic.Math.Add(v.Local.fTotal, v.Local.fTax, v.Local.fTotal)
				f.Intrinsic.Control.EndIf
				
				'Get Tax 10 Amount
				f.Intrinsic.Control.If(v.DataTable.dtQuote(v.Local.i1).Tax_Apply_10!FieldValTrim,=,"Y")
					f.Intrinsic.String.Build("SELECT RATE FROM V_AR_TAX_TABLES WHERE ZONE = '{0}' AND AUTH = '{1}'",v.DataTable.dtQuote(v.Local.i1).Tax_Zone_10!FieldValTrim, v.DataTable.dtQuote(v.Local.i1).Tax_10!FieldValTrim, v.Local.sSQL)
					f.ODBC.Connection!con.ExecuteAndReturn(v.Local.sSQL,v.Local.fRate)
					f.Intrinsic.Math.Mult(v.DataTable.dtQuote(v.Local.i1).Extension!FieldValFloat,v.Local.fRate,v.Local.fTax)
					f.Intrinsic.Math.Round(v.Local.fTax,2,v.Local.fTax)
					f.Intrinsic.Math.Add(v.Local.fTotal, v.Local.fTax, v.Local.fTotal)
				f.Intrinsic.Control.EndIf
				
				f.Intrinsic.Math.Add(v.DataTable.dtQuote(v.Local.i1).Extension!FieldValFloat, v.Local.fTotal, v.Local.fTotal)
				
				'Write the QuoteLine information to file
				'Write the QuoteLine Column Title if it is the first line
				f.Intrinsic.Control.If(v.Local.i1,=,0)
					f.Intrinsic.String.Build("{0}#!#{1}",v.Global.sQuoteLineColumnTitle,v.Ambient.NewLine,v.Local.sFile)		
				f.Intrinsic.Control.EndIf
				
				f.Intrinsic.String.Build("{1}{0}{2}{0}{3}{0}{4}{0}{5}{0}{6}","*!*",v.Global.sQuote,v.DataTable.dtQuote(v.Local.i1).RECORD_NO!FieldValTrim,v.DataTable.dtQuote(v.Local.i1).PART!FieldValTrim,v.DataTable.dtQuote(v.Local.i1).QTY_QUOTED!FieldValFloat,v.DataTable.dtQuote(v.Local.i1).PRICE!FieldValFloat,v.DataTable.dtQuote(v.Local.i1).AMT_DISCOUNT!FieldValFloat,v.Local.sTempValue)
				f.Intrinsic.String.Build("{0}{1}{2}",v.Local.sFile,v.Local.sTempValue,v.Ambient.NewLine,v.Local.sFile)				
			f.Intrinsic.Control.Next(v.Local.i1)
			
			'Write the QuoteHeader information to file
			f.Intrinsic.String.Build("&!&{0}#!#{1}",v.Global.sQuoteHeaderColumnTitle,v.Ambient.NewLine,v.Local.sTempValue)		
			f.Intrinsic.String.Build("{0}{1}",v.Local.sFile,v.Local.sTempValue,v.Local.sFile)		
			f.Intrinsic.String.Build("{0}{1}*!*{2}",v.Local.sFile,v.Global.sQuote,v.Local.fTotal,v.Local.sFile)
			
		f.Intrinsic.Control.Else
			'Write the Empty QuoteLine information to file
			f.Intrinsic.String.Build("{0}#!#{1}{1}",v.Global.sQuoteLineColumnTitle,v.Ambient.NewLine,v.Local.sFile)
		
			'Write the QuoteHeader information to file
			f.Intrinsic.String.Build("&!&{0}#!#{1}",v.Global.sQuoteHeaderColumnTitle,v.Ambient.NewLine,v.Local.sTempValue)		
			f.Intrinsic.String.Build("{0}{1}",v.Local.sFile,v.Local.sTempValue,v.Local.sFile)		
			f.Intrinsic.String.Build("{0}{1}*!*{2}",v.Local.sFile,v.Global.sQuote,0,v.Local.sFile)
		f.Intrinsic.Control.EndIf
		
		f.Intrinsic.File.String2File(v.Local.sFileName,v.Local.sFile)
		f.Intrinsic.Control.If(v.DataTable.dtQuote.Exists)
			f.Data.DataTable.Close("dtQuote")
		f.Intrinsic.Control.EndIf
	F.Intrinsic.Control.EndIf
	
	f.Intrinsic.String.Build("update GAB_6555_APRVL set Cust_Amount = 0, Amount = 0, MAX_DISCOUNT = 0, Approver = '*REVISE*', APPROVED_DATE = NULL where Quote_No = '{0}'",v.Global.sQuote,v.Local.sSQL)
	f.ODBC.Connection!con.Execute(v.Local.sSQL)
	f.Intrinsic.Control.ExitSub
f.Intrinsic.Control.EndIf

f.Intrinsic.String.Build("SELECT * FROM GAB_6555_APRVL WHERE QUOTE_NO = '{0}';",v.Global.sQuote,v.Local.sSQL)
f.Data.DataTable.CreateFromSQL("dtGAB","con",v.Local.sSQL,True)
f.Intrinsic.Control.If(v.DataTable.dtGAB.RowCount,=,0)
	f.Intrinsic.Control.If(v.Local.fMaxDiscPct,=,0)
		'Automatically approved the Quote because there is no Discount in the Quote lines
		f.Intrinsic.String.Build("insert into GAB_6555_APRVL(QUOTE_NO, DATE_QUOTE, CUSTOMER, CUST_AMOUNT, AMOUNT, MAX_DISCOUNT, DATE_DUE, ORIGINATOR, APPROVER, APPROVED_DATE) values('{0}', '{1}', '{2}', {3}, {4}, {5}, '{6}', '{7}', 'SYSTEM', NOW());",v.Global.sQuote, v.DataTable.dtQuote(0).Date_Quote!FieldValPervasiveDate, v.DataTable.dtQuote(0).Customer!FieldValTrim, v.Local.fTotalCust, v.Local.fTotal, v.Local.fMaxDiscPct, v.DataTable.dtQuote(0).Date_Due!FieldValPervasiveDate, v.Caller.User.Trim,  v.Local.sSQL)
	f.Intrinsic.Control.Else
		f.Intrinsic.String.Build("insert into GAB_6555_APRVL(QUOTE_NO, DATE_QUOTE, CUSTOMER, CUST_AMOUNT, AMOUNT, MAX_DISCOUNT, DATE_DUE, ORIGINATOR) values('{0}', '{1}', '{2}', {3}, {4}, {5}, '{6}', '{7}');",v.Global.sQuote, v.DataTable.dtQuote(0).Date_Quote!FieldValPervasiveDate, v.DataTable.dtQuote(0).Customer!FieldValTrim, v.Local.fTotalCust, v.Local.fTotal, v.Local.fMaxDiscPct, v.DataTable.dtQuote(0).Date_Due!FieldValPervasiveDate, v.Caller.User.Trim, v.Local.sSQL)
		'Send email to approvers
		f.Intrinsic.Control.CallSub(SendEmail,"Customer",v.DataTable.dtQuote(0).Customer!FieldValTrim,"MaxDiscPct",v.Local.fMaxDiscPct)
	f.Intrinsic.Control.EndIf
f.Intrinsic.Control.ElseIf(v.DataTable.dtGAB.RowCount,>,0)
	f.Intrinsic.Control.If(v.Local.bQuoteChanged)		
		f.Intrinsic.Control.If(v.Local.fMaxDiscPct,=,0)
			'Automatically approved the Quote because there is no Discount in the Quote lines
			f.Intrinsic.String.Build("update GAB_6555_APRVL set DATE_QUOTE = '{1}', Cust_Amount = {2}, Amount = {3}, MAX_DISCOUNT = {4}, DATE_DUE = '{5}', Approver = 'SYSTEM', APPROVED_DATE = NOW() where Quote_No = '{0}'",v.Global.sQuote, v.DataTable.dtQuote(0).Date_Quote!FieldValPervasiveDate, v.Local.fTotalCust, v.Local.fTotal, v.Local.fMaxDiscPct, v.DataTable.dtQuote(0).Date_Due!FieldValPervasiveDate, v.Local.sSQL)
		f.Intrinsic.Control.Else
			f.Intrinsic.String.Build("update GAB_6555_APRVL set DATE_QUOTE = '{1}', Cust_Amount = {2}, Amount = {3}, MAX_DISCOUNT = {4}, DATE_DUE = '{5}', Approver = '*REVISE*', APPROVED_DATE = NULL where Quote_No = '{0}'",v.Global.sQuote, v.DataTable.dtQuote(0).Date_Quote!FieldValPervasiveDate, v.Local.fTotalCust, v.Local.fTotal, v.Local.fMaxDiscPct, v.DataTable.dtQuote(0).Date_Due!FieldValPervasiveDate, v.Local.sSQL)
			'Send email to approvers
			f.Intrinsic.Control.CallSub(SendEmail,"Customer",v.DataTable.dtQuote(0).Customer!FieldValTrim,"MaxDiscPct",v.Local.fMaxDiscPct)
		f.Intrinsic.Control.EndIf
	f.Intrinsic.Control.EndIf
f.Intrinsic.Control.EndIf
f.ODBC.Connection!con.Execute(v.Local.sSQL)

f.Intrinsic.Control.If(v.DataTable.dtOriginalQuoteLines.Exists)
	f.Data.DataTable.Close("dtOriginalQuoteLines")
f.Intrinsic.Control.EndIf

f.Intrinsic.Control.If(v.DataTable.dtQuote.Exists)
	f.Data.DataTable.Close("dtQuote")
f.Intrinsic.Control.EndIf

f.Intrinsic.Control.If(v.DataTable.dtGAB.Exists)
	f.Data.DataTable.Close("dtGAB")
f.Intrinsic.Control.EndIf

'f.Intrinsic.File.Exists(v.Local.sFileName,v.Local.bExists)
'f.Intrinsic.Control.If(v.Local.bExists,=,True)
'	f.Intrinsic.File.DeleteFile(v.Local.sFileName)
'f.Intrinsic.Control.EndIf

Program.Sub.Hook10950.End

Program.Sub.End.Start
	f.ODBC.Connection!con.Close
	f.Intrinsic.Control.End
Program.Sub.End.End

Program.Sub.Comments.Start
${$5$}$20.1.8347.18428$}$1
${$6$}$tdjohan$}$20221128151020535$}$8rAQhOSvlohpQhMDm1j544LwmwXnRbkhtIRgsTU7Gt0fXVwPWr/8J+e8pZisXGmcXc1V6VagUvA=
Program.Sub.Comments.End